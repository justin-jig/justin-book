---
title: "NestJS ë¹„ë™ê¸° ì•„í‚¤í…ì²˜ (Asynchronous Architecture in NestJS)"
date: 2025-10-26
---


#### ìš”ì•½

- **NestJS**ëŠ” Node.js ê¸°ë°˜ì´ì§€ë§Œ,  
  Expressë³´ë‹¤ í•œ ë‹¨ê³„ ë†’ì€ ì¶”ìƒí™” ê³„ì¸µì„ ê°€ì§„ **ë¹„ë™ê¸° í”„ë ˆì„ì›Œí¬**ë¡œ,  
  ë‚´ë¶€ì ìœ¼ë¡œ **RxJS(Reactive Extensions)** ì™€ **DI(ì˜ì¡´ì„± ì£¼ì…)** êµ¬ì¡°ë¥¼ ê²°í•©í•´  
  ë³µì¡í•œ ë¹„ë™ê¸° íë¦„ì„ ì•ˆì •ì ìœ¼ë¡œ ì œì–´í•œë‹¤.  
- í•µì‹¬ êµ¬ì„±ìš”ì†Œ:
  1. **Async Provider & Service** â€” ì˜ì¡´ì„± ì£¼ì… ê¸°ë°˜ ë¹„ë™ê¸° ì„œë¹„ìŠ¤ êµ¬ì¡°  
  2. **EventEmitter** â€” ë‚´ë¶€ ì´ë²¤íŠ¸ ê¸°ë°˜ ë¹„ë™ê¸° ì²˜ë¦¬  
  3. **RxJS** â€” ë¹„ë™ê¸° ìŠ¤íŠ¸ë¦¼(Observable) ì²˜ë¦¬  
  4. **BullMQ** â€” Redis ê¸°ë°˜ ë¹„ë™ê¸° Job Queue ì²˜ë¦¬  
- NestJSì˜ ê°•ì ì€ â€œ**ë¹„ë™ê¸° ì½”ë“œì˜ ì²´ê³„ì  ê´€ë¦¬**â€ì´ë©°,  
  ë‹¨ìˆœ ì½œë°±ì´ ì•„ë‹Œ **ë¹„ë™ê¸° íë¦„(Flow)ì„ ì„¤ê³„í•˜ëŠ” í”„ë ˆì„ì›Œí¬**ë¼ëŠ” ì ì— ìˆë‹¤.

> NestJSì˜ ë¹„ë™ê¸° ì•„í‚¤í…ì²˜ëŠ”
> `DI(ì˜ì¡´ì„± ì£¼ì…)` + `EventEmitter` + `RxJS` + `BullMQ`
> ë¡œ êµ¬ì„±ëœ **Reactive ë¹„ë™ê¸° ìƒíƒœê³„**ì´ë‹¤.
> ê° ê³„ì¸µì€ ë…ë¦½ì ìœ¼ë¡œ ë™ì‘í•˜ë©°,
> **ì„œë¹„ìŠ¤ ê°„ ê²°í•©ë„ë¥¼ ë‚®ì¶”ë©´ì„œë„ í™•ì¥ì„±ê³¼ ì•ˆì •ì„±ì„ ê·¹ëŒ€í™”**í•  ìˆ˜ ìˆë‹¤.
> NestJSì˜ ë¹„ë™ê¸° ì•„í‚¤í…ì²˜ëŠ” â€œì„œë¹„ìŠ¤ ì¤‘ì‹¬ì˜ ë¹„ë™ê¸° íŒŒì´í”„ë¼ì¸â€ì´ë‹¤.  
> RxJS ìŠ¤íŠ¸ë¦¼ê³¼ ì´ë²¤íŠ¸ ì‹œìŠ¤í…œì„ í†µí•´ ëŒ€ê·œëª¨ ë°±ì—”ë“œ ë¡œì§ì„ ì•ˆì •ì ìœ¼ë¡œ ë¶„ë¦¬Â·ì œì–´í•  ìˆ˜ ìˆë‹¤.

---

##### ì°¸ê³ ìë£Œ

- [NestJS ê³µì‹ ë¬¸ì„œ â€“ Asynchronous Providers](https://docs.nestjs.com/fundamentals/async-providers)  
- [RxJS ê³µì‹ ë¬¸ì„œ](https://rxjs.dev/guide/overview)  
- [BullMQ ê³µì‹ ë¬¸ì„œ](https://docs.bullmq.io/)  
- [nestjs/event-emitter íŒ¨í‚¤ì§€](https://docs.nestjs.com/techniques/events)

---

#### 1. ë¹„ë™ê¸° ì„œë¹„ìŠ¤ êµ¬ì¡°

| ê°œë… | ì„¤ëª… |
|------|------|
| **Async Provider** | `useFactory`, `useAsyncClass` ë“± ë¹„ë™ê¸° DI ì£¼ì… ê°€ëŠ¥ |
| **Async Service** | ì™¸ë¶€ API/DB ë“± ë¹„ë™ê¸° I/O ì¤‘ì‹¬ ì„œë¹„ìŠ¤ ê³„ì¸µ |
| **EventEmitter** | ë¹„ë™ê¸° ì´ë²¤íŠ¸ë¥¼ ë°œí–‰í•˜ê³  ë‹¤ë¥¸ ëª¨ë“ˆì—ì„œ êµ¬ë… |
| **RxJS Observable** | ìŠ¤íŠ¸ë¦¼ ë°ì´í„° ê¸°ë°˜ ë¹„ë™ê¸° ì‘ë‹µ ì²˜ë¦¬ |

```typescript
// app.module.ts
@Module({
  imports: [EventEmitterModule.forRoot()],
  providers: [UserService],
})
export class AppModule {}
```

---

#### 2. ë¹„ë™ê¸° Provider ì˜ˆì‹œ

```typescript
// database.provider.ts
export const DatabaseProvider = {
  provide: 'ASYNC_DB_CONNECTION',
  useFactory: async (): Promise<Database> => {
    const db = await connectToDatabase(); // ë¹„ë™ê¸° ì—°ê²°
    return db;
  },
};
```

```typescript
// app.module.ts
@Module({
  providers: [DatabaseProvider],
  exports: ['ASYNC_DB_CONNECTION'],
})
export class DatabaseModule {}
```

> ğŸ’¡ **í¬ì¸íŠ¸:**
>
> * `useFactory`ë¡œ ë¹„ë™ê¸° ì£¼ì… ê°€ëŠ¥
> * AppModule ë¡œë”© ì‹œ DB ì—°ê²°ì„ `await`ìœ¼ë¡œ ë³´ì¥
> * NestJSëŠ” ëª¨ë“  providerë¥¼ Promiseë¡œ resolve ê°€ëŠ¥

---

#### 3. RxJS ê¸°ë°˜ ë¹„ë™ê¸° ìŠ¤íŠ¸ë¦¼ ì²˜ë¦¬

```typescript
// user.service.ts
@Injectable()
export class UserService {
  constructor(private readonly http: HttpService) {}

  getUserStream(): Observable<User> {
    return this.http.get<User[]>('https://api.example.com/users').pipe(
      map((res) => res.data),
      mergeMap((users) => from(users)),  // ë°°ì—´ â†’ ìŠ¤íŠ¸ë¦¼ ë³€í™˜
      filter((user) => user.active),
      toArray()
    );
  }
}
```

| ì—°ì‚°ì        | ì„¤ëª…                 |
| ---------- | ------------------ |
| `map`      | ë°ì´í„° ë³€í™˜             |
| `mergeMap` | ë‚´ë¶€ Observableì„ í‰íƒ„í™” |
| `filter`   | ì¡°ê±´ í•„í„°ë§             |
| `toArray`  | ìŠ¤íŠ¸ë¦¼ ê²°ê³¼ë¥¼ ë°°ì—´ë¡œ ë³€í™˜     |

> âš™ï¸ **ì¥ì :**
>
> * ë¹„ë™ê¸° ë°ì´í„° íë¦„ì„ ì„ ì–¸ì ìœ¼ë¡œ êµ¬ì„± ê°€ëŠ¥
> * ì½œë°± ì¤‘ì²© ì—†ì´ ì²´ì¸ ê¸°ë°˜ íë¦„ ì œì–´

---

#### 4. EventEmitter ê¸°ë°˜ ë¹„ë™ê¸° ì´ë²¤íŠ¸ ì²˜ë¦¬

```typescript
// user.events.ts
export class UserCreatedEvent {
  constructor(public readonly userId: string) {}
}
```

```typescript
// user.service.ts
@Injectable()
export class UserService {
  constructor(private eventEmitter: EventEmitter2) {}

  async createUser(data: CreateUserDto) {
    const user = await this.userRepo.save(data);
    this.eventEmitter.emit('user.created', new UserCreatedEvent(user.id));
    return user;
  }
}
```

```typescript
// notification.listener.ts
@OnEvent('user.created')
handleUserCreated(event: UserCreatedEvent) {
  console.log(`[EVENT] New user created: ${event.userId}`);
}
```

> ğŸ’¡ **í•µì‹¬ ìš”ì•½:**
>
> * `EventEmitter2`ë¥¼ í†µí•´ ë‚´ë¶€ ì´ë²¤íŠ¸ ë°œí–‰
> * `@OnEvent()` ë°ì½”ë ˆì´í„°ë¡œ êµ¬ë…ì ì •ì˜
> * ì„œë¹„ìŠ¤ ê°„ ê²°í•©ë„ ìµœì†Œí™” + ë¹„ë™ê¸° í™•ì¥ì„± í™•ë³´

---

#### 5. BullMQ ê¸°ë°˜ ë¹„ë™ê¸° Job Queue

```typescript
// mail.processor.ts
@Processor('mail-queue')
export class MailProcessor {
  @Process('sendMail')
  async handleSendMail(job: Job) {
    const { to, subject, body } = job.data;
    await mailService.send(to, subject, body);
    console.log(`âœ… Mail sent to ${to}`);
  }
}
```

```typescript
// mail.service.ts
@Injectable()
export class MailService {
  constructor(@InjectQueue('mail-queue') private queue: Queue) {}

  async enqueueMail(data: any) {
    await this.queue.add('sendMail', data, { attempts: 3 });
  }
}
```

| í•­ëª©                          | ì„¤ëª…                     |
| --------------------------- | ---------------------- |
| **Queue ìƒì„±**                | `@InjectQueue('name')` |
| **Processor ë“±ë¡**            | `@Processor('name')`   |
| **Retry / Delay / Backoff** | BullMQ ì˜µì…˜ìœ¼ë¡œ ì„¤ì • ê°€ëŠ¥      |
| **ì£¼ìš” ì¥ì **                   | API ì‘ë‹µ ì†ë„ ë‹¨ì¶•, ì‘ì—… ë¶„ë¦¬    |

---

#### 6. ì‹¤ë¬´ ìš´ì˜ íŒ

| í•­ëª©            | ê¶Œì¥ ì„¤ì • / ë°©ë²•                   | ì„¤ëª…             |
| ------------- | ---------------------------- | -------------- |
| **ë¹„ë™ê¸° ì—ëŸ¬ ë¡œê¹…** | `@Catch()` í•„í„° ì‚¬ìš©             | ì „ì—­ ì—ëŸ¬ ê°ì§€       |
| **ìŠ¤ì¼€ì¤„ë§**      | `@Cron()`, `@Interval()`     | ë¹„ë™ê¸° ë°˜ë³µ ì‘ì—…      |
| **Queue ê´€ì°°**  | Bull Board / RedisInsight    | ì‘ì—… ìƒíƒœ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ |
| **ìŠ¤íŠ¸ë¦¼ ë””ë²„ê¹…**   | RxJS `tap()`                 | ë°ì´í„° íë¦„ ê²€ì¦      |
| **í…ŒìŠ¤íŠ¸**       | `jest.spyOn()` + async mocks | ë¹„ë™ê¸° ì„œë¹„ìŠ¤ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ |

---

