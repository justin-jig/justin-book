---
title: "Kafka ê¸°ë°˜ ë¹„ë™ê¸° ì²˜ë¦¬ (Kafka-based Asynchronous Processing)"
date: 2025-10-26
---


#### ìš”ì•½

- **Apache Kafka**ëŠ” ê³ ì„±ëŠ¥ ë¶„ì‚° ë©”ì‹œì§• í”Œë«í¼ìœ¼ë¡œ,  
  ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ê°„ **ë¹„ë™ê¸° ì´ë²¤íŠ¸ ìŠ¤íŠ¸ë¦¬ë°**ì„ ì§€ì›í•œë‹¤.  
- KafkaëŠ” **í† í”½(Topic)** ì„ ì¤‘ì‹¬ìœ¼ë¡œ ë©”ì‹œì§€ë¥¼ íŒŒí‹°ì…˜ ë‹¨ìœ„ë¡œ ì €ì¥í•˜ê³ ,  
  **Producer-Consumer ëª¨ë¸**ì„ í†µí•´ ë°ì´í„°ë¥¼ **ë¹„ë™ê¸°ì ìœ¼ë¡œ ì†¡ìˆ˜ì‹ **í•œë‹¤.  
- ì£¼ìš” ëª©ì :
  1. ì„œë¹„ìŠ¤ ê°„ ê²°í•©ë„ ê°ì†Œ (Decoupling)  
  2. ì¥ì•  ë³µì›ë ¥ í–¥ìƒ (Replay, Partition Replication)  
  3. ëŒ€ëŸ‰ ë°ì´í„° ë¹„ë™ê¸° ì²˜ë¦¬ (Stream Processing)
- ì´ ë¬¸ì„œëŠ” ì–¸ì–´ë³„ Kafka í™œìš© êµ¬ì¡°ë¥¼ í†µí•© ë¹„êµí•œë‹¤:
  - **Spring Boot (Java)** â€” Spring Kafka ê¸°ë°˜ ë¹„ë™ê¸° ë©”ì‹œì§•  
  - **FastAPI (Python)** â€” aiokafka ê¸°ë°˜ ë…¼ë¸”ë¡œí‚¹ ì´ë²¤íŠ¸ ì²˜ë¦¬  
  - **Express / NestJS (Node.js)** â€” kafkajs ê¸°ë°˜ ë¹„ë™ê¸° Producer/Consumer êµ¬ì¡°

> KafkaëŠ” ì–¸ì–´ì— ìƒê´€ì—†ì´ **ë¹„ë™ê¸° ì´ë²¤íŠ¸ ì¤‘ì‹¬ ì•„í‚¤í…ì²˜ì˜ í•µì‹¬ ì¶•**ì´ë‹¤.
> Spring BootëŠ” íŠ¸ëœì­ì…˜ ì•ˆì •ì„±ê³¼ ìš´ì˜ì„±,
> FastAPIëŠ” ìˆœìˆ˜ ë¹„ë™ê¸° ì²˜ë¦¬ì™€ ê²½ëŸ‰ì„±,
> Express/NestJSëŠ” í™•ì¥ì„±ê³¼ ì†ë„ë¥¼ ê°•ì ìœ¼ë¡œ ê°€ì§„ë‹¤.
> ì¦‰, KafkaëŠ” **ëª¨ë“  ë°±ì—”ë“œ ì–¸ì–´ë¥¼ í•˜ë‚˜ì˜ ë¹„ë™ê¸° ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ ì—°ê²°í•˜ëŠ” ê³µí†µ ê¸°ë°˜**ì´ë‹¤.
> KafkaëŠ” â€œì´ë²¤íŠ¸ ì¤‘ì‹¬(Event-driven)â€ ì•„í‚¤í…ì²˜ë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•œ í•µì‹¬ ë©”ì‹œì§€ ë¸Œë¡œì»¤ì´ë©°,  
> ì–¸ì–´ë³„ í´ë¼ì´ì–¸íŠ¸ SDKë¥¼ í†µí•´ ë™ì¼í•œ Pub/Sub ëª¨ë¸ì„ ì œê³µí•œë‹¤.

##### í”„ë ˆì„ì›Œí¬ë³„ ë¹„êµí‘œ

| í•­ëª©              | Spring Boot           | FastAPI              | Express / NestJS     |
| --------------- | --------------------- | -------------------- | -------------------- |
| **ì–¸ì–´**          | Java                  | Python               | Node.js / TypeScript |
| **í´ë¼ì´ì–¸íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬** | `spring-kafka`        | `aiokafka`           | `kafkajs`            |
| **ì‹¤í–‰ ëª¨ë¸**       | Thread Pool + Reactor | asyncio (Event Loop) | Event Loop (Node.js) |
| **ì£¼ìš” ê°•ì **       | íŠ¸ëœì­ì…˜ ì—°ë™, ì•ˆì •ì„±          | ë¹„ë™ê¸° ìˆœìˆ˜ êµ¬ì¡°, ê²½ëŸ‰ì„±       | ë¹ ë¥¸ ê°œë°œ, ì„œë²„ë¦¬ìŠ¤ ì í•©       |
| **ê¶Œì¥ ìš©ë„**       | ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì´ë²¤íŠ¸ ë²„ìŠ¤        | AI/ë°ì´í„° íŒŒì´í”„ë¼ì¸         | Gateway / ì‹¤ì‹œê°„ ì•Œë¦¼     |


---

##### ì°¸ê³ ìë£Œ

- [Apache Kafka Docs](https://kafka.apache.org/documentation/)
- [Spring for Apache Kafka](https://docs.spring.io/spring-kafka/reference/html/)
- [aiokafka (Python)](https://aiokafka.readthedocs.io/en/stable/)
- [KafkaJS (Node.js)](https://kafka.js.org/docs/getting-started)

---

### 1. Kafka ì•„í‚¤í…ì²˜ ê°œìš”

```mermaid
flowchart TD
  subgraph ProducerService
    A[Producer] -->|Publish| B[(Kafka Topic)]
  end
  subgraph BrokerCluster
    B --> C[(Partition 0)]
    B --> D[(Partition 1)]
  end
  subgraph ConsumerService
    C --> E[Consumer Group A]
    D --> E
  end
```

| êµ¬ì„±ìš”ì†Œ               | ì„¤ëª…                        |
| ------------------ | ------------------------- |
| **Producer**       | ì´ë²¤íŠ¸(ë©”ì‹œì§€)ë¥¼ ë°œí–‰í•˜ëŠ” ì„œë¹„ìŠ¤        |
| **Broker**         | ë©”ì‹œì§€ë¥¼ ì €ì¥Â·ë¶„ë°°í•˜ëŠ” Kafka ì„œë²„     |
| **Topic**          | ë©”ì‹œì§€ê°€ ê¸°ë¡ë˜ëŠ” ë…¼ë¦¬ì  ì±„ë„          |
| **Partition**      | ë³‘ë ¬ ì²˜ë¦¬ë¥¼ ìœ„í•œ Topic ë‚´ë¶€ ë‹¨ìœ„     |
| **Consumer Group** | ë©”ì‹œì§€ë¥¼ ë³‘ë ¬ë¡œ ì²˜ë¦¬í•˜ëŠ” Consumer ë¬¶ìŒ |

---

## 2. Spring Boot â€” `spring-kafka`

### 2.1 ì„¤ì •

```xml
<!-- pom.xml -->
<dependency>
  <groupId>org.springframework.kafka</groupId>
  <artifactId>spring-kafka</artifactId>
</dependency>
```

```yaml
# application.yml
spring:
  kafka:
    bootstrap-servers: localhost:9092
    consumer:
      group-id: user-service
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.apache.kafka.common.serialization.StringDeserializer
    producer:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.apache.kafka.common.serialization.StringSerializer
```

---

### 2.2 Producer

```java
@Service
@RequiredArgsConstructor
public class KafkaProducerService {

    private final KafkaTemplate<String, String> kafkaTemplate;

    public void send(String topic, String message) {
        kafkaTemplate.send(topic, message)
            .thenAccept(result -> System.out.println("âœ… Sent: " + message))
            .exceptionally(ex -> { 
                System.err.println("âŒ Send error: " + ex.getMessage());
                return null;
            });
    }
}
```

---

### 2.3 Consumer

```java
@Service
public class KafkaConsumerService {

    @KafkaListener(topics = "user-topic", groupId = "user-service")
    public void consume(String message, Acknowledgment ack) {
        System.out.println("ğŸ“¥ Received: " + message);
        ack.acknowledge();
    }
}
```

> ğŸ’¡ **íŠ¹ì§•**
>
> * `@KafkaListener` ê¸°ë°˜ Consumer êµ¬ì„±
> * `Acknowledgment`ë¡œ ìˆ˜ë™ ì»¤ë°‹ ê°€ëŠ¥
> * Outbox + DLQ íŒ¨í„´ê³¼ ê²°í•© ì‹œ ê³ ì‹ ë¢°ì„± êµ¬ì¡° ì™„ì„±

---


## 2. Spring Boot (Gradle ê¸°ë°˜) â€” `spring-kafka`

### 2.1 Gradle ì„¤ì •

```kotlin
// build.gradle.kts
plugins {
    id("org.springframework.boot") version "3.3.4"
    id("io.spring.dependency-management") version "1.1.5"
    kotlin("jvm") version "1.9.25"
    kotlin("plugin.spring") version "1.9.25"
}

group = "com.example.kafka"
version = "1.0.0"
java.sourceCompatibility = JavaVersion.VERSION_17

repositories {
    mavenCentral()
}

dependencies {
    implementation("org.springframework.boot:spring-boot-starter-web")
    implementation("org.springframework.kafka:spring-kafka")
    testImplementation("org.springframework.boot:spring-boot-starter-test")
    testImplementation("org.springframework.kafka:spring-kafka-test")
}
```

> ğŸ’¡ **ì„¤ëª…**
>
> * `spring-kafka` : Kafka Producer/Consumer êµ¬í˜„ì²´
> * `spring-kafka-test` : í…ŒìŠ¤íŠ¸ ì»¨ìŠˆë¨¸ ì‹œë®¬ë ˆì´ì…˜
> * `Java 17` ê¸°ë°˜ ìµœì‹  Gradle í™˜ê²½ ëŒ€ì‘

---

### 2.2 Kafka ì„¤ì • (YAML)

```yaml
# application.yml
spring:
  kafka:
    bootstrap-servers: localhost:9092
    consumer:
      group-id: user-service
      auto-offset-reset: earliest
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.apache.kafka.common.serialization.StringDeserializer
    producer:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.apache.kafka.common.serialization.StringSerializer
    listener:
      ack-mode: manual
```

---

### 2.3 Producer

```kotlin
// KafkaProducerService.kt
package com.example.kafka.service

import org.springframework.kafka.core.KafkaTemplate
import org.springframework.stereotype.Service

@Service
class KafkaProducerService(
    private val kafkaTemplate: KafkaTemplate<String, String>
) {
    fun send(topic: String, message: String) {
        kafkaTemplate.send(topic, message)
            .thenAccept { println("ğŸ“¨ Sent: $message") }
            .exceptionally { ex ->
                println("âŒ Send failed: ${ex.message}")
                null
            }
    }
}
```

---

### 2.4 Consumer

```kotlin
// KafkaConsumerService.kt
package com.example.kafka.service

import org.springframework.kafka.annotation.KafkaListener
import org.springframework.kafka.support.Acknowledgment
import org.springframework.stereotype.Service

@Service
class KafkaConsumerService {

    @KafkaListener(topics = ["user-topic"], groupId = "user-service")
    fun consume(message: String, ack: Acknowledgment) {
        println("ğŸ“¥ Received: $message")
        ack.acknowledge() // ìˆ˜ë™ ì˜¤í”„ì…‹ ì»¤ë°‹
    }
}
```

> âœ… **í•µì‹¬ ìš”ì•½**
>
> * `KafkaTemplate` â†’ ë¹„ë™ê¸° ë©”ì‹œì§€ ë°œí–‰
> * `@KafkaListener` â†’ ìë™ Consumer ë“±ë¡
> * `Acknowledgment` â†’ ì»¤ë°‹ ì œì–´ë¡œ ì•ˆì •ì„± í™•ë³´

---

### 2.5 íŠ¸ëœì­ì…˜ Outbox íŒ¨í„´

```mermaid
flowchart LR
  A[Spring Boot Service] -->|Insert| B[Outbox Table]
  B -->|CDC Debezium| C[Kafka Topic]
  C --> D[Consumer Service]
```

```sql
CREATE TABLE outbox_event (
  id UUID PRIMARY KEY,
  event_type VARCHAR(255),
  payload JSONB,
  created_at TIMESTAMP DEFAULT NOW()
);
```

> ğŸ’¡ **í•µì‹¬ í¬ì¸íŠ¸**
>
> * DB íŠ¸ëœì­ì…˜ê³¼ Kafka ë©”ì‹œì§€ ë°œí–‰ì„ ë¶„ë¦¬í•˜ì§€ ì•Šê³  ì¼ê´€ì„± ìœ ì§€
> * Debezium ë˜ëŠ” Kafka Connect CDCë¥¼ ì´ìš©í•´ Outbox ë°ì´í„°ë¥¼ ìë™ ë°œí–‰

---

### 2.6 DLQ êµ¬ì„± ë° ëª¨ë‹ˆí„°ë§

```kotlin
// KafkaErrorHandler.kt
package com.example.kafka.config

import org.springframework.kafka.listener.DeadLetterPublishingRecoverer
import org.springframework.stereotype.Component

@Component
class KafkaErrorHandler : DeadLetterPublishingRecoverer() {
    override fun accept(record: org.apache.kafka.clients.consumer.ConsumerRecord<*, *>, ex: Exception) {
        println("ğŸ’€ DLQ message: ${record.value()} | error: ${ex.message}")
    }
}
```

| í•­ëª©                           | ì„¤ëª…                 |
| ---------------------------- | ------------------ |
| **DLQ (Dead Letter Queue)**  | ì²˜ë¦¬ ì‹¤íŒ¨ ë©”ì‹œì§€ ì „ìš© í† í”½    |
| **ìš´ì˜ í™œìš©**                    | ì‹¤íŒ¨ ë©”ì‹œì§€ ì¬ì²˜ë¦¬ ë° ì¥ì•  ë¶„ì„ |
| **Kafka Streams / Debezium** | CDCì™€ DLQë¥¼ í•¨ê»˜ ìš´ì˜ ê°€ëŠ¥ |

---

### 2.7 ìš´ì˜ ë° ê´€ì°° ì§€í‘œ

| í•­ëª©           | ë„êµ¬ / ë°©ë²•                     | ì„¤ëª…               |
| ------------ | --------------------------- | ---------------- |
| **Lag ëª¨ë‹ˆí„°ë§** | Prometheus + Kafka Exporter | Consumer Lag ì‹œê°í™” |
| **í† í”½ ê´€ë¦¬**    | `kafka-topics.sh` CLI       | íŒŒí‹°ì…˜ ë° ë¦¬í”Œë¦¬ì¹´ í™•ì¸    |
| **ìŠ¤í‚¤ë§ˆ ê´€ë¦¬**   | Confluent Schema Registry   | Avro/JSON ìŠ¤í‚¤ë§ˆ ê²€ì¦ |
| **ë¡œê·¸ ìˆ˜ì§‘**    | ELK Stack / Loki            | ì¥ì•  ë¶„ì„ìš© ë¡œê·¸ ì¤‘ì•™í™”    |

---

> âœ… **Spring Boot ê²°ë¡  ìš”ì•½:**
> Gradle í™˜ê²½ì˜ Spring BootëŠ” `spring-kafka`ë¥¼ í†µí•´
> **@KafkaListener + KafkaTemplate** ì¡°í•©ìœ¼ë¡œ ë¹„ë™ê¸° ì´ë²¤íŠ¸ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•œë‹¤.
> Outbox + DLQ êµ¬ì¡°ë¥¼ ë³‘í–‰í•˜ë©´ **ì‹ ë¢°ì„± ìˆëŠ” ì´ë²¤íŠ¸ ìŠ¤íŠ¸ë¦¼ ì•„í‚¤í…ì²˜**ë¥¼ ì™„ì„±í•  ìˆ˜ ìˆë‹¤.

---


## 3. FastAPI â€” `aiokafka`

### 3.1 ì„¤ì¹˜ ë° êµ¬ì„±

```bash
pip install aiokafka
```

```python
# kafka_config.py
from aiokafka import AIOKafkaProducer, AIOKafkaConsumer
from asyncio import get_event_loop

loop = get_event_loop()
producer = AIOKafkaProducer(loop=loop, bootstrap_servers="localhost:9092")
consumer = AIOKafkaConsumer("user-topic", group_id="user-service", loop=loop, bootstrap_servers="localhost:9092")
```

---

### 3.2 Producer

```python
import asyncio, json
from fastapi import FastAPI
from kafka_config import producer

app = FastAPI()

@app.on_event("startup")
async def startup_event():
    await producer.start()

@app.on_event("shutdown")
async def shutdown_event():
    await producer.stop()

@app.post("/publish")
async def publish_message(data: dict):
    await producer.send_and_wait("user-topic", json.dumps(data).encode("utf-8"))
    return {"status": "sent"}
```

---

### 3.3 Consumer

```python
@app.on_event("startup")
async def consume():
    asyncio.create_task(consume_messages())

async def consume_messages():
    from kafka_config import consumer
    await consumer.start()
    try:
        async for msg in consumer:
            print(f"ğŸ“¥ Received: {msg.value.decode()}")
    finally:
        await consumer.stop()
```

> ğŸ’¡ **íŠ¹ì§•**
>
> * ì™„ì „í•œ `asyncio` ê¸°ë°˜ ë…¼ë¸”ë¡œí‚¹ ì´ë²¤íŠ¸ ë£¨í”„
> * `send_and_wait()`ë¡œ í”„ë¡œë“€ì„œ ê²°ê³¼ í™•ì¸
> * FastAPIì˜ ASGI ì´ë²¤íŠ¸ ë£¨í”„ì™€ ìì—°ìŠ¤ëŸ½ê²Œ í†µí•©

---

## 4. Express / NestJS â€” `kafkajs`

### 4.1 ì„¤ì¹˜ ë° êµ¬ì„±

```bash
npm install kafkajs
```

```typescript
// kafka.ts
import { Kafka } from "kafkajs";

export const kafka = new Kafka({
  clientId: "user-service",
  brokers: ["localhost:9092"],
});
export const producer = kafka.producer();
export const consumer = kafka.consumer({ groupId: "user-service" });
```

---

### 4.2 Producer (Express ì˜ˆì‹œ)

```typescript
// producer.js
import express from "express";
import { producer } from "./kafka.js";

const app = express();
app.use(express.json());

app.post("/publish", async (req, res) => {
  await producer.connect();
  await producer.send({
    topic: "user-topic",
    messages: [{ value: JSON.stringify(req.body) }],
  });
  await producer.disconnect();
  res.json({ status: "sent" });
});

app.listen(3000, () => console.log("ğŸš€ Express Kafka Producer running"));
```

---

### 4.3 Consumer (NestJS ì˜ˆì‹œ)

```typescript
// kafka.consumer.ts
import { Injectable, OnModuleInit } from "@nestjs/common";
import { consumer } from "./kafka";

@Injectable()
export class KafkaConsumer implements OnModuleInit {
  async onModuleInit() {
    await consumer.connect();
    await consumer.subscribe({ topic: "user-topic", fromBeginning: true });

    await consumer.run({
      eachMessage: async ({ topic, partition, message }) => {
        console.log(`ğŸ“¥ [${topic}] ${message.value?.toString()}`);
      },
    });
  }
}
```

> ğŸ’¡ **íŠ¹ì§•**
>
> * Node.js ëŸ°íƒ€ì„ì—ì„œ ê°€ì¥ ì•ˆì •ì ì¸ Kafka í´ë¼ì´ì–¸íŠ¸ (`kafkajs`)
> * NestJSì˜ DI êµ¬ì¡°ì™€ ê²°í•© ì‹œ ëŒ€ê·œëª¨ ì´ë²¤íŠ¸ ê¸°ë°˜ ì„œë¹„ìŠ¤ì— ì í•©
> * ë©”ì‹œì§€ ì¬ì²˜ë¦¬(`fromBeginning`), DLQ ì²˜ë¦¬ ë“± ëª¨ë‘ ì§€ì›

---

## 5. Outbox + DLQ + ëª¨ë‹ˆí„°ë§ ê³µí†µ ì „ëµ

| ì „ëµ                          | ì„¤ëª…                           | ì–¸ì–´ë³„ êµ¬í˜„ ìœ„ì¹˜                                                |
| --------------------------- | ---------------------------- | -------------------------------------------------------- |
| **Outbox Pattern**          | DB íŠ¸ëœì­ì…˜ê³¼ Kafka ë°œí–‰ì„ ì¼ê´€ì„± ìˆê²Œ ì—°ê²° | Spring Boot: JPA Event / FastAPI: SQLAlchemy Commit Hook |
| **DLQ (Dead Letter Queue)** | ì²˜ë¦¬ ì‹¤íŒ¨ ë©”ì‹œì§€ë¥¼ ë³„ë„ í† í”½ì— ì €ì¥         | Kafka DLQ Topic ê³µí†µ                                       |
| **Consumer Lag ëª¨ë‹ˆí„°ë§**       | ë©”ì‹œì§€ ì§€ì—°ë¥  í™•ì¸                   | Prometheus + Kafka Exporter                              |
| **Schema Registry**         | ë©”ì‹œì§€ ìŠ¤í‚¤ë§ˆ ê´€ë¦¬                   | Avro / JSON Schema (Confluent)                           |

---

