---
title: "Redis Stream ê¸°ë°˜ ë¹„ë™ê¸° ì²˜ë¦¬ (Redis Stream-based Asynchronous Processing)"
date: 2025-10-26
---

#### ìš”ì•½

- **Redis Stream**ì€ Redis 5.0 ì´í›„ ì¶”ê°€ëœ **ì´ë²¤íŠ¸ ìŠ¤íŠ¸ë¦¬ë° ë°ì´í„° êµ¬ì¡°**ë¡œ,  
  KafkaÂ·RabbitMQì²˜ëŸ¼ **ë¹„ë™ê¸° ë©”ì‹œì§€ í** ì—­í• ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.  
- ì£¼ìš” íŠ¹ì§•:
  1. **Append-only êµ¬ì¡° (XADD)**  
  2. **Consumer Group ê¸°ë°˜ ë³‘ë ¬ ì²˜ë¦¬**  
  3. **Ack ê¸°ë°˜ ì‹ ë¢°ì„± ì „ë‹¬ (XACK)**  
  4. **ë©”ëª¨ë¦¬ ì¤‘ì‹¬ ì´ˆê³ ì† ì²˜ë¦¬ ì†ë„**
- Redis Streamì€ **ì‹¤ì‹œê°„ ì´ë²¤íŠ¸, ë¡œê·¸, ì•Œë¦¼ ì²˜ë¦¬** ë“±ì— ì í•©í•˜ë©°  
  **ì €ì§€ì—° ë¹„ë™ê¸° íŒŒì´í”„ë¼ì¸** êµ¬ì¶•ì— ë§¤ìš° íš¨ê³¼ì ì´ë‹¤.

> Redis Streamì€ ë©”ëª¨ë¦¬ ê¸°ë°˜ì˜ ì´ˆì €ì§€ì—° ë¹„ë™ê¸° ë©”ì‹œì§€ íë¡œ,
> Kafkaë³´ë‹¤ ê°€ë³ê³  RabbitMQë³´ë‹¤ ë¹ ë¥´ë©°,
> **ë‹¨ì¼ Redis ì¸í”„ë¼ ë‚´ì—ì„œ ì´ë²¤íŠ¸ ìŠ¤íŠ¸ë¦¼Â·íÂ·ìºì‹œë¥¼ í†µí•© ìš´ì˜í•  ìˆ˜ ìˆëŠ” ì¥ì **ì´ ìˆë‹¤.
> ê° ì–¸ì–´ëŠ” Redis Streamì˜ ë‹¨ìˆœ ëª…ë ¹(XADD, XREADGROUP, XACK)ì„ í†µí•´
> ë™ì¼í•œ ë¹„ë™ê¸° í†µì‹  êµ¬ì¡°ë¥¼ ì‰½ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.
> Redis Streamì€ Redisì˜ ì¸ë©”ëª¨ë¦¬ íŠ¹ì„±ê³¼ Kafkaì˜ ì´ë²¤íŠ¸ ìŠ¤íŠ¸ë¦¼ ëª¨ë¸ì„ ê²°í•©í•œ êµ¬ì¡°ë¡œ,  
> ë¹ ë¥¸ ì‘ë‹µê³¼ ì‹¤ì‹œê°„ ì²˜ë¦¬ê°€ í•„ìš”í•œ í™˜ê²½ì—ì„œ ë¹„ë™ê¸° ë©”ì‹œì§• ì†”ë£¨ì…˜ìœ¼ë¡œ ì‚¬ìš©ëœë‹¤.

#### í”„ë ˆì„ì›Œí¬ë³„ ë¹„êµí‘œ

| í•­ëª©        | Spring Boot          | FastAPI          | Express / NestJS           |
| --------- | -------------------- | ---------------- | -------------------------- |
| **ì–¸ì–´**    | Kotlin / Java        | Python           | Node.js / TypeScript       |
| **ë¼ì´ë¸ŒëŸ¬ë¦¬** | spring-data-redis    | aioredis         | node-redis                 |
| **ì²˜ë¦¬ ë°©ì‹** | Polling / @Scheduled | async event loop | while-loop with xReadGroup |
| **ì¥ì **    | ì•ˆì •ì  í†µí•© / ì„¤ì • ê°„ê²°       | ê²½ëŸ‰ / ì™„ì „ ë¹„ë™ê¸°      | ë¹ ë¥¸ ì‹¤í–‰ / ì‹¤ì‹œê°„ ëŒ€ì‘             |
| **ê¶Œì¥ ìš©ë„** | ë°ì´í„° íŒŒì´í”„ë¼ì¸ / ë¡œê·¸ ìˆ˜ì§‘    | ì‹¤ì‹œê°„ ì•Œë¦¼ / IoT     | Gateway / ì‹¤ì‹œê°„ ì±„íŒ…           |


##### ì°¸ê³ ìë£Œ

- [Redis Stream ê³µì‹ ë¬¸ì„œ](https://redis.io/docs/latest/data-types/streams/)
- [Spring Data Redis Stream](https://docs.spring.io/spring-data/redis/docs/current/reference/html/#redis.streams)
- [aioredis Docs](https://aioredis.readthedocs.io/)
- [node-redis Streams](https://github.com/redis/node-redis)

---

### 1. Redis Stream ê¸°ë³¸ ì•„í‚¤í…ì²˜

```mermaid
flowchart TD
  A[Producer] -->|XADD| B[(Redis Stream)]
  B -->|XREADGROUP| C[Consumer Group]
  C -->|XACK| B
```

| ëª…ë ¹             | ì„¤ëª…                           |
| -------------- | ---------------------------- |
| **XADD**       | Streamì— ë©”ì‹œì§€ ì¶”ê°€               |
| **XREADGROUP** | Consumer Group ë‹¨ìœ„ë¡œ ë©”ì‹œì§€ ì½ê¸°    |
| **XACK**       | ë©”ì‹œì§€ ì²˜ë¦¬ ì™„ë£Œ í›„ í™•ì¸ (acknowledge) |
| **XGROUP**     | Consumer Group ìƒì„±            |
| **XDEL**       | ì²˜ë¦¬ëœ ë©”ì‹œì§€ ì‚­ì œ                   |

---

##  2. Spring Boot (Gradle ê¸°ë°˜) â€” `spring-data-redis`

### 2.1 Gradle ì„¤ì •

```kotlin
// build.gradle.kts
plugins {
    id("org.springframework.boot") version "3.3.4"
    id("io.spring.dependency-management") version "1.1.5"
    kotlin("jvm") version "1.9.25"
    kotlin("plugin.spring") version "1.9.25"
}

dependencies {
    implementation("org.springframework.boot:spring-boot-starter-data-redis")
    implementation("org.springframework.boot:spring-boot-starter-web")
}
```

---

### 2.2 Redis Stream êµ¬ì„±

```kotlin
// RedisStreamConfig.kt
@Configuration
class RedisStreamConfig {
    @Bean
    fun redisTemplate(factory: RedisConnectionFactory): RedisTemplate<String, Any> {
        val template = RedisTemplate<String, Any>()
        template.setConnectionFactory(factory)
        return template
    }
}
```

---

### 2.3 Producer

```kotlin
// StreamProducer.kt
@Service
class StreamProducer(private val redisTemplate: RedisTemplate<String, Any>) {
    fun publish(stream: String, message: String) {
        val record = MapRecord.create(stream, "message", message)
        redisTemplate.opsForStream<String, String>().add(record)
        println("ğŸ“¨ Published: $message")
    }
}
```

---

### 2.4 Consumer

```kotlin
// StreamConsumer.kt
@Component
class StreamConsumer(private val redisTemplate: RedisTemplate<String, Any>) {

    @Scheduled(fixedDelay = 2000)
    fun consume() {
        val records = redisTemplate.opsForStream<String, String>()
            .read(StreamReadOptions.empty().count(10),
                  StreamOffset.create("user-stream", ReadOffset.lastConsumed()))
        records?.forEach {
            println("ğŸ“¥ Consumed: ${it.value["message"]}")
        }
    }
}
```

> âœ… **íŠ¹ì§•**
>
> * `opsForStream()` APIë¡œ XADD/XREADGROUP ê¸°ëŠ¥ êµ¬í˜„
> * `@Scheduled`ë¡œ ì£¼ê¸°ì  Pull ë°©ì‹ ì²˜ë¦¬
> * Spring Boot 3.xì—ì„œ `StreamListener` ëŒ€ì²´ êµ¬ì¡° ì§€ì›

---

## 3. FastAPI â€” `aioredis`

### 3.1 ì„¤ì¹˜ ë° ì„¤ì •

```bash
pip install redis
```

```python
from fastapi import FastAPI
import asyncio
import redis.asyncio as aioredis

app = FastAPI()
redis = aioredis.from_url("redis://localhost")
```

---

### 3.2 Producer

```python
@app.post("/publish")
async def publish_message(payload: dict):
    msg_id = await redis.xadd("user-stream", {"data": str(payload)})
    return {"id": msg_id}
```

---

### 3.3 Consumer

```python
@app.on_event("startup")
async def consume_stream():
    asyncio.create_task(read_stream())

async def read_stream():
    group, consumer = "user-group", "consumer-1"
    try:
        await redis.xgroup_create("user-stream", group, id="$", mkstream=True)
    except Exception:
        pass  # ê·¸ë£¹ì´ ì´ë¯¸ ìˆìœ¼ë©´ ìƒëµ

    while True:
        resp = await redis.xreadgroup(group, consumer, {"user-stream": ">"}, count=1, block=5000)
        if resp:
            for _, messages in resp:
                for msg_id, msg in messages:
                    print(f"ğŸ“¥ Received: {msg}")
                    await redis.xack("user-stream", group, msg_id)
```

> ğŸ’¡ **í•µì‹¬ ìš”ì•½**
>
> * `xgroup_create` : Consumer Group ìƒì„±
> * `xreadgroup` : ë©”ì‹œì§€ ì½ê¸° (ë¸”ë¡ ëŒ€ê¸° ì§€ì›)
> * `xack` : ì„±ê³µ ì²˜ë¦¬ í›„ ë©”ì‹œì§€ ì œê±°

---

## 4. Express / NestJS â€” `node-redis`

### 4.1 ì„¤ì¹˜ ë° ì„¤ì •

```bash
npm install redis
```

```typescript
// redis-client.ts
import { createClient } from "redis";
export const redis = createClient({ url: "redis://localhost:6379" });
redis.connect();
```

---

### 4.2 Producer (Express ì˜ˆì‹œ)

```typescript
// producer.ts
import express from "express";
import { redis } from "./redis-client.js";

const app = express();
app.use(express.json());

app.post("/publish", async (req, res) => {
  const id = await redis.xAdd("user-stream", "*", { data: JSON.stringify(req.body) });
  res.json({ id });
});

app.listen(3000, () => console.log("ğŸš€ Redis Stream Producer running"));
```

---

### 4.3 Consumer (NestJS ì˜ˆì‹œ)

```typescript
// redis.consumer.ts
import { Injectable, OnModuleInit } from "@nestjs/common";
import { redis } from "./redis-client";

@Injectable()
export class RedisStreamConsumer implements OnModuleInit {
  async onModuleInit() {
    const group = "user-group";
    try {
      await redis.xGroupCreate("user-stream", group, "$", { MKSTREAM: true });
    } catch {}
    this.listen(group);
  }

  async listen(group: string) {
    while (true) {
      const response = await redis.xReadGroup(group, "consumer-1", {
        key: "user-stream",
        id: ">",
        COUNT: 1,
        BLOCK: 5000,
      });
      if (response) {
        for (const stream of response) {
          for (const message of stream.messages) {
            console.log("ğŸ“¥ Received:", message.message);
            await redis.xAck("user-stream", group, message.id);
          }
        }
      }
    }
  }
}
```

> âœ… **íŠ¹ì§•**
>
> * `xReadGroup`ìœ¼ë¡œ ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¼ ì†Œë¹„
> * NestJSì˜ ì˜ì¡´ì„± ì£¼ì…(DI)ê³¼ ê²°í•©
> * Consumer Group ê¸°ë°˜ ë©€í‹° ì›Œì»¤ êµ¬ì„± ê°€ëŠ¥

---

## 5. ìš´ì˜ / ëª¨ë‹ˆí„°ë§ ì „ëµ

| í•­ëª©                     | ì„¤ëª…                     | ë„êµ¬                             |
| ---------------------- | ---------------------- | ------------------------------ |
| **ë°±í”„ë ˆì…”(Backpressure)** | ì†Œë¹„ì ì†ë„ê°€ ëŠë¦´ ë•Œ ìŠ¤íŠ¸ë¦¼ í¬ê¸° ì œì–´ | `XTRIM`                        |
| **Retry / DLQ**        | ì²˜ë¦¬ ì‹¤íŒ¨ ë©”ì‹œì§€ ì¬ì²˜ë¦¬          | `XPENDING`, `XCLAIM`           |
| **Stream ëª¨ë‹ˆí„°ë§**        | ë©”ì‹œì§€ ìˆ˜, ì†Œë¹„ì ìƒíƒœ í™•ì¸       | `XINFO STREAM`, `XINFO GROUPS` |
| **ëª¨ë‹ˆí„°ë§ ë„êµ¬**            | RedisInsight, Grafana  | ì‹œê°ì  ê´€ë¦¬                         |
| **ì„±ëŠ¥ ì§€í‘œ**              | ì²˜ë¦¬ìœ¨, ì§€ì—° ì‹œê°„             | Prometheus + Redis Exporter    |

---


