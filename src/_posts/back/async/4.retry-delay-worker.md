---
title: "Retry / Delay / Worker 구조 이해"
date: 2025-10-25
---

**version: NestJS v10.x / BullMQ v4.x / Redis v7.x 기준**

---

#### 요약

Retry / Delay / Worker 구조는 **비동기 시스템의 신뢰성과 안정성을 확보**하기 위한 핵심 메커니즘이다.  
BullMQ는 Job 실패 시 재시도(backoff), 지연(delay), 병렬(concurrency) 옵션을 기본 제공한다.

Retry / Delay / Worker 구조는 **비동기 시스템의 복원력**을 만든다.
재시도 로직과 DLQ 설계를 통해, 장애 상황에서도 **데이터 손실 없이 안정적인 운영**이 가능하다.

> *“비동기 시스템의 품질은 실패를 어떻게 다루는가로 결정된다.”*

---

##### 참고자료
- [BullMQ Retry Docs](https://docs.bullmq.io/patterns/retry)
- [NestJS Queue 공식 문서](https://docs.nestjs.com/techniques/queues)

---

#### 1. Retry & Delay 옵션

```ts
await this.emailQueue.add('send', jobData, {
  delay: 3000,
  attempts: 5,
  backoff: { type: 'exponential', delay: 2000 },
});
```

| 옵션         | 설명                  |
| ---------- | ------------------- |
| `delay`    | 작업 시작 전 대기 시간       |
| `attempts` | 재시도 횟수              |
| `backoff`  | 재시도 간격 (지수형, 고정형 등) |

---

#### 2. Worker 병렬 처리

```ts
new Worker('email', async (job) => {
  console.log('Processing:', job.name);
}, { concurrency: 5 });
```

> `concurrency` 옵션을 통해 여러 Worker가 동시에 작업을 병렬로 처리한다.

---

#### 3. QueueScheduler & DLQ

```ts
import { QueueScheduler } from 'bullmq';
new QueueScheduler('email');
```

* **QueueScheduler**: 작업 상태 모니터링 및 재시도 스케줄 관리
* **DLQ(Dead Letter Queue)**: 실패한 Job을 별도 큐에 보관하여 복구 가능

---

#### 4. 모니터링 도구

| 항목         | 도구             | 설명                |
| ---------- | -------------- | ----------------- |
| Bull Board | Dashboard      | Job 진행 상태 시각화     |
| Sentry     | Error Tracking | Worker 실패 알림      |
| Prometheus | Metrics        | Job 처리율, 지연률 모니터링 |

---
