---
title: "ë¹„ë™ê¸° ì‹œìŠ¤í…œì˜ ì—ëŸ¬ ë³µêµ¬ ë° ì¥ì•  ëŒ€ì‘ ì „ëµ (Error Recovery & Fault Tolerance in Async Systems)"
date: 2025-10-26
---

**version: 1.0.0**

#### ìš”ì•½

- ë¹„ë™ê¸° ì‹œìŠ¤í…œì€ ë³‘ë ¬ì„±ê³¼ í™•ì¥ì„±ì€ ë†’ì§€ë§Œ,  
  ë©”ì‹œì§€ ì†ì‹¤Â·ì¤‘ë³µ ì²˜ë¦¬Â·íŠ¸ëœì­ì…˜ ë¶ˆì¼ì¹˜ ë“±ì˜ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ê¸° ì‰½ë‹¤.  
- ë³¸ ë¬¸ì„œëŠ” ë¹„ë™ê¸° ì‹œìŠ¤í…œì—ì„œì˜ **ì˜¤ë¥˜ ê°ì§€, ì¬ì‹œë„, ì¥ì•  ê²©ë¦¬, ë³µêµ¬ ì„¤ê³„ íŒ¨í„´**ì„ ì •ë¦¬í•œë‹¤.  
- ì£¼ìš” ë³µêµ¬ ì „ëµ:
  1. Retry / Delay Queue ê¸°ë°˜ ì¬ì²˜ë¦¬  
  2. Circuit Breaker(íšŒë¡œ ì°¨ë‹¨ê¸°)  
  3. DLQ(Dead Letter Queue)  
  4. ë³´ìƒ íŠ¸ëœì­ì…˜(Saga Pattern)  

> ë¹„ë™ê¸° ì‹œìŠ¤í…œì˜ íšŒë³µë ¥(Resilience)ì€ ë‹¨ì¼ ì„œë¹„ìŠ¤ê°€ ì•„ë‹Œ **ì‹œìŠ¤í…œ ì „ì²´ì˜ ë³µì› ê²½ë¡œ ì„¤ê³„**ë¡œ ì™„ì„±ëœë‹¤.
>
> * **Retry / Backoff** â†’ ì¼ì‹œ ì¥ì•  ë³µêµ¬
> * **Circuit Breaker** â†’ ì‹œìŠ¤í…œ ë³´í˜¸
> * **DLQ / Replay** â†’ ë°ì´í„° ì†ì‹¤ ë°©ì§€
> * **Saga Compensation** â†’ íŠ¸ëœì­ì…˜ ì¼ê´€ì„± ë³µì›
>
> ì¦‰, â€œ**ì¥ì• ë¥¼ í”¼í•˜ëŠ” ì‹œìŠ¤í…œ**â€ì´ ì•„ë‹Œ â€œ**ì¥ì• ì—ì„œ ëŒì•„ì˜¬ ìˆ˜ ìˆëŠ” ì‹œìŠ¤í…œ**â€ì´ ì§„ì •í•œ ê³ ê°€ìš©ì„± ë¹„ë™ê¸° ì•„í‚¤í…ì²˜ì´ë‹¤.
 
> ë³µì›ë ¥(Resilience)ì€ ë‹¨ìˆœ ì˜ˆì™¸ ì²˜ë¦¬ ì½”ë“œê°€ ì•„ë‹ˆë¼  
> **ì‹œìŠ¤í…œì´ ì¥ì• ë¥¼ ê°ì§€í•˜ê³  ìŠ¤ìŠ¤ë¡œ ë³µêµ¬í•  ìˆ˜ ìˆëŠ” êµ¬ì¡°ì  ëŠ¥ë ¥**ì´ë‹¤.  
> ì¦‰, ì¥ì•  ë°œìƒì„ ì™„ì „íˆ ë§‰ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ â€œì •ìƒìœ¼ë¡œ ë˜ëŒì•„ì˜¬ ìˆ˜ ìˆê²Œ í•˜ëŠ” ê²ƒâ€ì´ í•µì‹¬ì´ë‹¤.

---

##### ì°¸ê³ ìë£Œ

- [Resilience4j Docs](https://resilience4j.readme.io/)
- [AWS Fault Tolerance Patterns](https://aws.amazon.com/architecture/)
- [Enterprise Integration Patterns](https://www.enterpriseintegrationpatterns.com/)
- [Google SRE Workbook - Handling Failures](https://sre.google/workbook/)

---

### 1. ì—ëŸ¬ ë³µêµ¬ ì•„í‚¤í…ì²˜ ê°œìš”

```mermaid
flowchart LR
  A[Producer Service] -->|Message| B[(Queue / Stream)]
  B -->|Consume| C[Consumer Service]
  C -->|Success| D[(DB/Result)]
  C -->|Fail| E[(Retry Queue)]
  E -->|Exceeded| F[(DLQ)]
  F --> G[Operator Alert / Reprocess]
```

| êµ¬ì„±ìš”ì†Œ                        | ì—­í•                           |
| --------------------------- | --------------------------- |
| **Retry Queue**             | ì¼ì‹œì  ì¥ì•  ë°œìƒ ì‹œ ì¬ì²˜ë¦¬ë¥¼ ìœ„í•œ ì„ì‹œ í    |
| **DLQ (Dead Letter Queue)** | ë°˜ë³µ ì‹¤íŒ¨ ë©”ì‹œì§€ ë³´ê´€                |
| **Circuit Breaker**         | ì¥ì•  êµ¬ê°„ì˜ í˜¸ì¶œ ì¤‘ë‹¨                |
| **Saga Orchestrator**       | ë³´ìƒ íŠ¸ëœì­ì…˜ ìˆ˜í–‰                  |
| **Alert System**            | ê´€ë¦¬ì ì•Œë¦¼ (Slack, PagerDuty ë“±) |

---

##  2. Retry ì „ëµ

### 2.1 Retry ê¸°ë³¸ ê°œë…

| í•­ëª©                      | ì„¤ëª…                             |
| ----------------------- | ------------------------------ |
| **Fixed Retry**         | ì¼ì • ê°„ê²©ìœ¼ë¡œ ì¬ì‹œë„ (ì˜ˆ: 3íšŒ, 5ì´ˆ ê°„ê²©)     |
| **Exponential Backoff** | ì‹œë„í• ìˆ˜ë¡ ê°„ê²©ì„ ëŠ˜ë¦¼ (2s â†’ 4s â†’ 8s)    |
| **Jitter**              | Backoff ê°„ê²©ì— ëœë¤ì„±ì„ ì¶”ê°€í•´ íŠ¸ë˜í”½ ì§‘ì¤‘ ì™„í™” |
| **Circuit Trigger**     | ë°˜ë³µ ì‹¤íŒ¨ ì‹œ íšŒë¡œ ì°¨ë‹¨ìœ¼ë¡œ ì„œë¹„ìŠ¤ ë³´í˜¸         |

---

### 2.2 Spring Boot â€” `@Retryable` / Resilience4j

```kotlin
@Service
class PaymentService {

    @Retryable(
        value = [IOException::class],
        maxAttempts = 3,
        backoff = Backoff(delay = 2000, multiplier = 2.0)
    )
    fun processPayment() {
        println("ğŸ’³ Processing payment...")
        if (Math.random() < 0.7) throw IOException("Temporary failure")
        println("âœ… Payment success")
    }

    @Recover
    fun recover(ex: IOException) {
        println("ğŸš¨ Payment failed after retries: ${ex.message}")
    }
}
```

> âœ… `@Retryable`ì€ Spring Retryì˜ ê¸°ë³¸ ì œê³µ ê¸°ëŠ¥ì´ë©°,
> `Resilience4j` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ CircuitBreaker, RateLimiterì™€ í•¨ê»˜ í†µí•© ê°€ëŠ¥.

---

### 2.3 Node.js (BullMQ) Retry

```typescript
await queue.add("job", data, {
  attempts: 3,
  backoff: { type: "exponential", delay: 1000 },
});
```

> âš™ï¸ **BullMQì˜ Retry**
>
> * `attempts`ë¡œ ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ ì§€ì •
> * `backoff`ë¡œ ì§€ì—° ì¦ê°€ìœ¨ ì„¤ì •
> * ì‹¤íŒ¨ ì‹œ `Failed Event` íŠ¸ë¦¬ê±° ë°œìƒ

---

## ğŸŸ© 3. Circuit Breaker (íšŒë¡œ ì°¨ë‹¨ê¸°)

### 3.1 ê°œë… ìš”ì•½

| ìƒíƒœ            | ì„¤ëª…                 |
| ------------- | ------------------ |
| **Closed**    | ì •ìƒ ìƒíƒœ, ìš”ì²­ í†µê³¼       |
| **Open**      | ì¥ì•  ê°ì§€ í›„ ìš”ì²­ ì°¨ë‹¨      |
| **Half-Open** | ë³µêµ¬ ì‹œë„ ì¤‘ (ì¼ë¶€ ìš”ì²­ í—ˆìš©) |

```mermaid
stateDiagram-v2
    [*] --> Closed
    Closed --> Open: Error Rate â†‘
    Open --> HalfOpen: Timeout
    HalfOpen --> Closed: Success
    HalfOpen --> Open: Fail Again
```

---

### 3.2 Spring Boot â€” Resilience4j CircuitBreaker

```yaml
resilience4j.circuitbreaker:
  instances:
    asyncService:
      slidingWindowSize: 10
      failureRateThreshold: 50
      waitDurationInOpenState: 10s
```

```kotlin
@Service
class AsyncClient {
    @CircuitBreaker(name = "asyncService", fallbackMethod = "fallback")
    fun callExternal() {
        println("ğŸ”— External call")
        if (Math.random() < 0.5) throw RuntimeException("Failure")
    }

    fun fallback(ex: Throwable) {
        println("âš ï¸ Circuit fallback: ${ex.message}")
    }
}
```

> âœ… ì¥ì•  êµ¬ê°„ì„ ìë™ìœ¼ë¡œ ê°ì§€í•˜ê³  íšŒë³µë˜ê¸° ì „ê¹Œì§€ íŠ¸ë˜í”½ ì°¨ë‹¨

---

### 3.3 Node.js â€” Opossum Circuit Breaker

```bash
npm install opossum
```

```javascript
import CircuitBreaker from "opossum";

async function unstableRequest() {
  if (Math.random() < 0.5) throw new Error("Fail");
  return "Success";
}

const breaker = new CircuitBreaker(unstableRequest, { timeout: 3000, errorThresholdPercentage: 50 });
breaker.fallback(() => "Fallback result");
breaker.on("open", () => console.log("âš¡ Circuit opened"));
breaker.on("close", () => console.log("âœ… Circuit closed"));
```

---

## ğŸŸ¨ 4. DLQ (Dead Letter Queue) & ë³´ìƒ íŠ¸ëœì­ì…˜ (Saga)

### 4.1 DLQ ì²˜ë¦¬ íë¦„

```mermaid
flowchart LR
  A[Consumer] -->|Fail after retry| B[(DLQ)]
  B --> C[Operator]
  C -->|Manual Replay| D[(Queue)]
```

| í•­ëª©         | ì„¤ëª…                                              |
| ---------- | ----------------------------------------------- |
| **DLQ ëª©ì ** | ì²˜ë¦¬ ì‹¤íŒ¨ ë©”ì‹œì§€ ê²©ë¦¬ ë° ë¶„ì„                               |
| **Replay** | ìˆ˜ë™ ì¬ì²˜ë¦¬ í˜¹ì€ ìë™ ì¬ì „ì†¡                                |
| **êµ¬í˜„ ìœ„ì¹˜**  | Kafka DLQ Topic / RabbitMQ Dead-Letter Exchange |

---

### 4.2 RabbitMQ DLX ì˜ˆì‹œ

```kotlin
@Bean
fun dlxQueue(): Queue = Queue("order.dlx.queue")

@Bean
fun dlxExchange(): DirectExchange = DirectExchange("order.dlx.exchange")

@Bean
fun dlxBinding(): Binding =
    BindingBuilder.bind(dlxQueue()).to(dlxExchange()).with("order.dlx.key")
```

---

### 4.3 ë³´ìƒ íŠ¸ëœì­ì…˜ (Saga Pattern)

```mermaid
sequenceDiagram
  participant Order
  participant Payment
  participant Inventory
  participant Compensation

  Order->>Payment: Try Pay
  Payment-->>Order: OK
  Order->>Inventory: Reserve Stock
  Inventory-->>Order: Fail
  Order->>Compensation: Cancel Payment
```

> âœ… **Saga í•µì‹¬:**
> íŠ¸ëœì­ì…˜ ì‹¤íŒ¨ ì‹œ â€œë³´ìƒ(Compensating)â€ ì‘ì—…ìœ¼ë¡œ ì‹œìŠ¤í…œ ì¼ê´€ì„± ìœ ì§€.
> ì˜ˆ: ê²°ì œ ì„±ê³µ â†’ ì¬ê³  ì‹¤íŒ¨ â†’ ê²°ì œ ì·¨ì†Œ

---

## ğŸ§© 5. ì¥ì•  íƒì§€ ë° ìš´ì˜ ì „ëµ

| í•­ëª©              | ë„êµ¬ / ë°©ë²•                     | ì„¤ëª…                    |
| --------------- | --------------------------- | --------------------- |
| **ì—ëŸ¬ìœ¨ ëª¨ë‹ˆí„°ë§**    | Prometheus + Grafana        | ìš”ì²­ ì‹¤íŒ¨ìœ¨, Circuit ìƒíƒœ ì§€í‘œ |
| **DLQ ì²˜ë¦¬ ëª¨ë‹ˆí„°ë§** | Kafka UI / RabbitMQ Console | ë©”ì‹œì§€ ëˆ„ì  ê°ì‹œ             |
| **Retry ë¡œê·¸ ì¶”ì ** | Loki / ELK Stack            | ì¬ì‹œë„ íˆìŠ¤í† ë¦¬ ë¶„ì„           |
| **Alert ì—°ë™**    | Slack / PagerDuty           | ì¥ì•  ì‹œ ê´€ë¦¬ì ì¦‰ì‹œ ì•Œë¦¼        |
| **ìë™ ë³µêµ¬**       | Cron Replay Script          | DLQ â†’ ì›ë³¸ í ë³µì›         |

---

## ğŸ§  6. í”„ë ˆì„ì›Œí¬ë³„ ë³µì› ì „ëµ ë¹„êµ

| í•­ëª©                  | Spring Boot                 | FastAPI                     | Express / NestJS         |
| ------------------- | --------------------------- | --------------------------- | ------------------------ |
| **Retry**           | `@Retryable` / Resilience4j | Retry middleware            | BullMQ attempts/backoff  |
| **Circuit Breaker** | Resilience4j                | aiohttp CircuitHandler      | Opossum                  |
| **DLQ ì§€ì›**          | Kafka / RabbitMQ DLX        | Celery Retry / DLQ          | BullMQ DLQ Queue         |
| **Saga ë³´ìƒ íŠ¸ëœì­ì…˜**    | StateMachine / Choreography | Celery Chain + Compensation | EventEmitter / CQRS Saga |

---

### ğŸ“Š ì¥ì•  ëŒ€ì‘ ì‹œë‚˜ë¦¬ì˜¤ ìš”ì•½

| ì‹œë‚˜ë¦¬ì˜¤            | ëŒ€ì‘ ì „ëµ                 |
| --------------- | --------------------- |
| **ì¼ì‹œì  ë„¤íŠ¸ì›Œí¬ ì‹¤íŒ¨** | Retry + Backoff       |
| **ì™¸ë¶€ API ê³¼ë¶€í•˜**  | Circuit Breaker       |
| **ì˜êµ¬ì  ë°ì´í„° ì˜¤ë¥˜**  | DLQ ê²©ë¦¬ í›„ ìˆ˜ë™ ë³µêµ¬        |
| **íŠ¸ëœì­ì…˜ ë¶ˆì¼ì¹˜**    | Saga Compensation     |
| **ì¥ì•  íŒ¨í„´ ë°˜ë³µ ë°œìƒ** | Alert â†’ Root Cause ë¶„ì„ |

---
