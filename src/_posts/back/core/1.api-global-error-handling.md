---
title: "ì „ì—­ ì—ëŸ¬ í•¸ë“¤ë§ (Global Error Handling)"
date: 2025-10-25
---

#### ìš”ì•½

- ëª¨ë“  ì˜ˆì™¸(Exception)ë¥¼ **ë‹¨ì¼ ì²˜ë¦¬ ì§€ì (Global Handler)** ì—ì„œ ê´€ë¦¬í•˜ëŠ” ë°©ë²•ì„ ì •ì˜í•œë‹¤.  
- í”„ë ˆì„ì›Œí¬ë³„ë¡œ ê³µí†µëœ ì²˜ë¦¬ ì›ì¹™(`ì˜ˆì™¸ ìº¡ì²˜ â†’ ë¡œê¹… â†’ í‘œì¤€ ì‘ë‹µ ë³€í™˜`)ì„ ì ìš©í•œë‹¤.  
- RFC 7807 ê¸°ë°˜ì˜ ì—ëŸ¬ í‘œí˜„ êµ¬ì¡°ì™€ `success/data/error` ì‘ë‹µ í¬ë§·ì„ í†µí•©í•œë‹¤.  
- **FastAPI / Spring Boot / Express / NestJS** ê³µìš© ì‹¤ë¬´ ì˜ˆì‹œ í¬í•¨.

> ì „ì—­ ì—ëŸ¬ í•¸ë“¤ëŸ¬ëŠ” â€œAPIì˜ ìµœí›„ ë³´ë£¨â€ì´ë©°,  
> ì„œë¹„ìŠ¤ ì¼ê´€ì„±ê³¼ ì•ˆì •ì„±ì„ ê²°ì •ì§“ëŠ” í•µì‹¬ ì¸í”„ë¼ ë ˆë²¨ ì»´í¬ë„ŒíŠ¸ë‹¤.
> ì „ì—­ ì—ëŸ¬ í•¸ë“¤ë§ì€ APIì˜ â€œë§ˆì§€ë§‰ ë°©ì–´ì„ â€ìœ¼ë¡œ,
> ëª¨ë“  ì„œë¹„ìŠ¤ ê³„ì¸µì˜ ì˜ˆì™¸ë¥¼ í‘œì¤€í™”ëœ ì‘ë‹µ êµ¬ì¡°ë¡œ ë³€í™˜í•˜ëŠ” í•µì‹¬ ì»´í¬ë„ŒíŠ¸ë‹¤.
>
> FastAPI, Spring Boot, Express, NestJS ëª¨ë‘
> `Exception â†’ Logging â†’ RFC7807 JSON ì‘ë‹µ` êµ¬ì¡°ë¥¼ ì¼ê´€ë˜ê²Œ ìœ ì§€í•´ì•¼ í•œë‹¤.


| ìš”ì•½         | ì„¤ëª…                                                                                        |
| ---------- | ----------------------------------------------------------------------------------------- |
| **í•µì‹¬ ëª©í‘œ**  | ì˜ˆì™¸ ë°œìƒ ì‹œ, ì˜ˆì¸¡ ê°€ëŠ¥í•œ JSON êµ¬ì¡°ë¡œ í´ë¼ì´ì–¸íŠ¸ ì‘ë‹µ                                                         |
| **í•¸ë“¤ë§ ë°©ì‹** | í”„ë ˆì„ì›Œí¬ë³„ ì „ì—­ í•¸ë“¤ëŸ¬ í†µí•© (`@ControllerAdvice`, `ExceptionFilter`, `app.use`, `exception_handler`) |
| **íš¨ê³¼**     | ì„œë¹„ìŠ¤ ì•ˆì •ì„±, ë¡œê¹… ì¼ê´€ì„±, í´ë¼ì´ì–¸íŠ¸ ì²˜ë¦¬ ë‹¨ìˆœí™”                                                             |
| **í™•ì¥ì„±**    | Sentry / Prometheus / Grafana ì—°ë™ ì‹œ ì†ì‰¬ìš´ ì¶”ì                                                  |
---

##### ì°¸ê³ ìë£Œ
- [RFC 7807 - Problem Details for HTTP APIs](https://datatracker.ietf.org/doc/html/rfc7807)
- [Spring Boot @ControllerAdvice](https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-ann-controller-advice)
- [FastAPI Exception Handling](https://fastapi.tiangolo.com/tutorial/handling-errors/)
- [NestJS Exception Filters](https://docs.nestjs.com/exception-filters)
- [Express Error Middleware Docs](https://expressjs.com/en/guide/error-handling.html)

---

#### 1. ì—ëŸ¬ í•¸ë“¤ë§ ê³„ì¸µ êµ¬ì¡°

```mermaid
flowchart TD
    A[Controller] --> B{ì˜ˆì™¸ ë°œìƒ}
    B -->|Checked / Validation| C[Custom Exception]
    B -->|Unhandled / Runtime| D[Global Error Handler]
    C --> D
    D --> E[Logger / APM]
    E --> F[Error Response RFC7807]
    F --> G[Client]
```

| ë‹¨ê³„          | ì„¤ëª…                                       |
| ----------- | ---------------------------------------- |
| â‘  ì˜ˆì™¸ ë°œìƒ     | Controller / Service / Repository ë“±ì—ì„œ ë°œìƒ |
| â‘¡ ì˜ˆì™¸ êµ¬ë¶„     | Validation, Business, System ì˜ˆì™¸ êµ¬ë¶„       |
| â‘¢ ì „ì—­ í•¸ë“¤ëŸ¬ ì§„ì… | CustomException ì™¸ì˜ ëª¨ë“  ì—ëŸ¬ í¬í•¨              |
| â‘£ ë¡œê¹… ë° ë¶„ì„   | TraceID, ìŠ¤íƒ, ì‚¬ìš©ì ì •ë³´ ë¡œê¹…                   |
| â‘¤ ì¼ê´€ëœ ì‘ë‹µ ë°˜í™˜ | `success=false`, RFC7807 ê¸°ë°˜ JSON ë³€í™˜      |

---

#### 2. í•µì‹¬ ì›ì¹™

| ì›ì¹™                | ì„¤ëª…                             |
| ----------------- | ------------------------------ |
| **1. ì¤‘ì•™ ì§‘ì¤‘ ì²˜ë¦¬**   | ëª¨ë“  ì—ëŸ¬ë¥¼ ë‹¨ì¼ í•¸ë“¤ëŸ¬ì—ì„œ ì²˜ë¦¬             |
| **2. í‘œì¤€ ì‘ë‹µ í¬ë§·**   | `success / data / error` êµ¬ì¡° ìœ ì§€ |
| **3. ìƒíƒœ ì½”ë“œ ë§¤í•‘**   | ì˜ˆì™¸ íƒ€ì…ë³„ HTTP Status ì¼ê´€ì„±         |
| **4. ë¡œê¹…/ëª¨ë‹ˆí„°ë§ ì—°ë™** | Sentry, Grafana, ELK ë“±ê³¼ í†µí•©     |
| **5. ê°œë°œ/ìš´ì˜ êµ¬ë¶„**   | DEBUG ëª¨ë“œì¼ ë•Œë§Œ ìƒì„¸ ìŠ¤íƒ ë…¸ì¶œ          |

---

#### 3. ì–¸ì–´ë³„ ì „ì—­ ì—ëŸ¬ í•¸ë“¤ë§ êµ¬í˜„

---

##### ğŸ FastAPI

```python
from fastapi import FastAPI, Request, HTTPException
from fastapi.responses import JSONResponse

app = FastAPI()

@app.exception_handler(Exception)
async def global_exception_handler(request: Request, exc: Exception):
    status_code = getattr(exc, "status_code", 500)
    error_response = {
        "success": False,
        "data": None,
        "error": {
            "type": "about:blank",
            "title": "Internal Server Error" if status_code == 500 else str(exc.__class__.__name__),
            "status": status_code,
            "detail": str(exc),
            "instance": str(request.url)
        }
    }
    return JSONResponse(status_code=status_code, content=error_response)
```

> âœ… `@app.exception_handler(Exception)`
> â†’ ëª¨ë“  ì˜ˆì™¸ë¥¼ í¬ì°©í•´ êµ¬ì¡°í™”ëœ JSON ë°˜í™˜
> â†’ ë¡œê·¸ ìˆ˜ì§‘ê¸°(Loguru, Sentry ë“±)ì™€ ì—°ê³„ ê°€ëŠ¥

---

##### â˜• Spring Boot

```java
@RestControllerAdvice
public class GlobalExceptionHandler {

    @ExceptionHandler(CustomException.class)
    public ResponseEntity<ApiResponse<Void>> handleCustom(CustomException e) {
        var error = Map.of(
            "type", "https://api.example.com/errors/" + e.getCode(),
            "title", e.getMessage(),
            "status", e.getStatus(),
            "detail", e.getDetail()
        );
        return ResponseEntity.status(e.getStatus())
            .body(ApiResponse.failure(error));
    }

    @ExceptionHandler(Exception.class)
    public ResponseEntity<ApiResponse<Void>> handleGeneral(Exception e) {
        var error = Map.of(
            "type", "about:blank",
            "title", "Internal Server Error",
            "status", 500,
            "detail", e.getMessage()
        );
        return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
            .body(ApiResponse.failure(error));
    }
}
```

> âœ… `@RestControllerAdvice`ë¥¼ í†µí•´ ì „ì—­ ì˜ˆì™¸ ì²˜ë¦¬
> âœ… `ApiResponse.failure()`ë¡œ ì‘ë‹µ í¬ë§· í†µì¼

---

##### ğŸŸ¦ Express

```javascript
// app.js
app.use((err, req, res, next) => {
  console.error(err.stack);
  const status = err.status || 500;
  res.status(status).json({
    success: false,
    data: null,
    error: {
      type: `https://api.example.com/errors/${status}`,
      title: err.name || "ServerError",
      status,
      detail: err.message || "Internal Server Error",
      instance: req.originalUrl
    }
  });
});
```

> âœ… `app.use((err, req, res, next))` ë¯¸ë“¤ì›¨ì–´ëŠ” Expressì˜ ì „ì—­ ì—ëŸ¬ ì²˜ë¦¬ í¬ì¸íŠ¸
> âœ… Error ê°ì²´ í™•ì¥(`err.code`, `err.status`)ìœ¼ë¡œ ì„¸ë¶„í™” ê°€ëŠ¥

---

##### ğŸ§± NestJS

```typescript
@Catch()
export class GlobalExceptionFilter implements ExceptionFilter {
  catch(exception: any, host: ArgumentsHost) {
    const ctx = host.switchToHttp();
    const response = ctx.getResponse<Response>();
    const request = ctx.getRequest<Request>();
    const status = exception.getStatus ? exception.getStatus() : 500;
    const message = exception.message || 'Unexpected Error';

    response.status(status).json({
      success: false,
      data: null,
      error: {
        type: `https://api.example.com/errors/${status}`,
        title: exception.name || 'Error',
        status,
        detail: message,
        instance: request.url,
      },
    });
  }
}
```

> âœ… NestJSëŠ” `@Catch()` ë°ì½”ë ˆì´í„°ë¥¼ í†µí•´ ExceptionFilter ë“±ë¡
> âœ… `main.ts`ì—ì„œ `app.useGlobalFilters(new GlobalExceptionFilter())` ë¡œ í™œì„±í™”

---

#### 4. ìƒíƒœ ì½”ë“œ ë§¤í•‘ ê°€ì´ë“œ

| ì˜ˆì™¸ ìœ í˜•                     | ì„¤ëª…         | HTTP Status |
| ------------------------- | ---------- | ----------- |
| `ValidationException`     | í•„ë“œ ê²€ì¦ ì‹¤íŒ¨   | 400         |
| `UnauthorizedException`   | ì¸ì¦ ì‹¤íŒ¨      | 401         |
| `ForbiddenException`      | ê¶Œí•œ ë¶€ì¡±      | 403         |
| `EntityNotFoundException` | ë¦¬ì†ŒìŠ¤ ì—†ìŒ     | 404         |
| `ConflictException`       | ë°ì´í„° ì¶©ëŒ     | 409         |
| `TimeoutException`        | ì™¸ë¶€ í˜¸ì¶œ íƒ€ì„ì•„ì›ƒ | 504         |
| `RuntimeException`        | ì‹œìŠ¤í…œ ì˜¤ë¥˜     | 500         |

---

#### 5. ë¡œê·¸ ë° íŠ¸ë ˆì´ì‹± ì—°ë™

> ì „ì—­ í•¸ë“¤ëŸ¬ëŠ” ëª¨ë“  ì˜ˆì™¸ ë°œìƒ ì‹œ **ë¡œê·¸ íŒŒì´í”„ë¼ì¸ì˜ ì‹œì‘ì **ì´ ëœë‹¤.

##### ê¶Œì¥ ë¡œê¹… í•„ë“œ

| í•„ë“œ          | ì„¤ëª…                   |
| ----------- | -------------------- |
| `timestamp` | ë°œìƒ ì‹œê°                |
| `traceId`   | ìš”ì²­ë³„ ê³ ìœ  ì‹ë³„ì (APM ì—°ë™ìš©) |
| `path`      | ìš”ì²­ URI               |
| `status`    | HTTP ìƒíƒœ ì½”ë“œ           |
| `errorCode` | ë‚´ë¶€ ì—ëŸ¬ ì½”ë“œ             |
| `detail`    | ì—ëŸ¬ ìƒì„¸ ë©”ì‹œì§€            |

##### ë¡œê·¸ ì˜ˆì‹œ (JSON)

```json
{
  "timestamp": "2025-10-25T13:00:00Z",
  "traceId": "9a32fd",
  "path": "/api/v1/users",
  "status": 404,
  "errorCode": "USER_NOT_FOUND",
  "detail": "User with ID=99 not found"
}
```

---

#### 6. ê°œë°œ/ìš´ì˜ ëª¨ë“œ ë¶„ë¦¬

| ëª¨ë“œ            | ì¶œë ¥ ë‚´ìš©                   | ì„¤ëª…         |
| ------------- | ----------------------- | ---------- |
| **ê°œë°œ(DEV)**   | ì—ëŸ¬ ìŠ¤íƒ, ì›ë¬¸ ë©”ì‹œì§€ í‘œì‹œ        | ë””ë²„ê¹… ì¤‘ì‹¬     |
| **ìš´ì˜(PROD)**  | ì‚¬ìš©ì ì¹œí™”ì  ë©”ì‹œì§€, traceId í‘œì‹œ | ë³´ì•ˆ ì¤‘ì‹¬      |
| **í…ŒìŠ¤íŠ¸(TEST)** | ëª¨ì˜ ë°ì´í„° / ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ìš© ì˜ˆì™¸     | ìë™í™” í…ŒìŠ¤íŠ¸ í™œìš© |

> `.env` ë˜ëŠ” `application.yml` ë“± í™˜ê²½ ë³€ìˆ˜ë¥¼ í†µí•´
> `APP_ENV=dev / prod / test` ë¡œ ì œì–´

---

#### 7. ì‹¤ë¬´ ì ìš© ì˜ˆì‹œ (FastAPI ê¸°ì¤€)

```python
import logging
logger = logging.getLogger("uvicorn.error")

@app.exception_handler(Exception)
async def handler(request: Request, exc: Exception):
    trace_id = str(uuid4())
    logger.error(f"[{trace_id}] {request.url} - {exc}")
    return JSONResponse(
        status_code=500,
        content={
            "success": False,
            "data": None,
            "error": {
                "type": "about:blank",
                "title": "Internal Server Error",
                "status": 500,
                "detail": str(exc),
                "traceId": trace_id,
                "instance": str(request.url)
            }
        }
    )
```

> âœ… ë¡œê·¸ì™€ traceIdë¥¼ ì—°ë™í•˜ì—¬ ìš´ì˜ í™˜ê²½ì—ì„œë„ ì¶”ì  ê°€ëŠ¥
> âœ… Sentry, Datadog, ELK ì—°ê³„ ì‹œ `traceId` ê¸°ë°˜ ì¶”ì  ê°€ëŠ¥

---

