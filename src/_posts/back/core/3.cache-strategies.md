---
title: "캐시 전략 및 무효화 (Cache Strategies & Invalidation)"
date: 2025-10-25
---

#### 요약

- 캐시 활용 방식(Lazy / Write-through / Write-behind / Read-through)을 비교한다.  
- 데이터 변경 시 캐시 무효화(Cache Invalidation) 정책을 명확히 정의한다.  
- Redis Pub/Sub 기반 실시간 캐시 갱신 구조 예시 포함.

---

##### 참고자료
- [Redis Patterns](https://redis.io/docs/latest/develop/use-cases/caching/)
- [Cache-Aside Pattern (MS Docs)](https://learn.microsoft.com/en-us/azure/architecture/patterns/cache-aside)
- [Spring Cache Abstraction](https://docs.spring.io/spring-framework/reference/integration/cache.html)
- [NestJS Cache Interceptor](https://docs.nestjs.com/techniques/caching)

---

#### 1. 캐시 전략 비교

| 전략 | 설명 | 장점 | 단점 |
|------|------|------|------|
| **Cache-Aside (Lazy Loading)** | 요청 시 캐시 확인 → DB 조회 → 캐시 업데이트 | 단순 | 초기 지연 |
| **Write-Through** | DB와 캐시 동시에 갱신 | 일관성 | 쓰기 부하 |
| **Write-Behind** | 캐시에 기록 후 비동기 DB 반영 | 빠름 | 장애 시 손실 위험 |
| **Read-Through** | 캐시 계층이 DB 프록시 역할 | 단순 API | 구성 복잡 |


- **Cache-Aside (Lazy Loading)**:  
  애플리케이션이 직접 캐시를 조회하고, 없으면 DB에서 가져와 캐시에 저장  
  → 캐시 미스 시 DB 접근, **직접 관리 방식**

- **Write-Through**:  
  데이터를 캐시에 쓰면서 동시에 DB에도 저장  
  → **쓰기 일관성 보장**, 읽기 성능 향상

- **Write-Behind (Write-Back)**:  
  데이터를 캐시에 먼저 저장하고, 일정 시간 후 또는 배치로 DB에 반영  
  → **쓰기 성능 향상**, DB 부하 감소 (단, 장애 시 데이터 유실 위험)

- **Read-Through**:  
  캐시가 DB를 대신 조회하여 데이터를 반환  
  → 애플리케이션은 캐시만 접근, **자동 로딩 방식**

---

#### 2. FastAPI 캐시 무효화 예시
```python
async def invalidate_user_cache(user_id: int):
    key = f"user:{user_id}"
    await redis.delete(key)
```

#### 3. Spring Boot — `@CacheEvict`

```java
@CacheEvict(value="users", key="#id")
public void updateUser(Long id, String name) {
    // DB update logic
}
```

#### 4. Express — 수동 무효화

```javascript
await redis.del(`user:${userId}`);
```

#### 5. NestJS — Pub/Sub 기반

```typescript
await redis.publish('cache.invalidate', `user:${userId}`);
```

```typescript
// Subscriber
await redis.subscribe('cache.invalidate');
redis.on('message', (ch, key) => redis.del(key));
```

---

#### 6. 캐시 일관성 관리

| 항목         | 전략                       |
| ---------- | ------------------------ |
| TTL        | 자동 갱신/만료                 |
| 버전 관리      | `user:v2:123` 형태 Key 버전화 |
| DB Trigger | Outbox 패턴과 연계            |
| 이벤트 기반     | Kafka / Redis Streams 활용 |

---

#### 7. 테스트 및 모니터링

* 캐시 Hit Ratio 확인
* TTL 만료 동작 검증 (`setex` → sleep → `get`)
* Pub/Sub 갱신 테스트
* RedisSlowLog로 느린 커맨드 추적