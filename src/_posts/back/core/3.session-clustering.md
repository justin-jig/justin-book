---
title: "세션 클러스터링 및 상태 관리 (Session Clustering & State Management)"
date: 2025-10-25
---

#### 요약

- 세션(Session)은 사용자 인증·상태 정보를 서버에 저장하는 메커니즘이다.  
- 서버 확장 시 세션을 분산/공유(Sticky, Shared, Stateless)하는 방법을 다룬다.  
- Redis 기반 세션 저장소 구성 및 보안, TTL 관리, 클러스터 확장 전략을 설명한다.

> 세션은 “사용자 상태의 단일 진실 원본(Single Source of Truth)”이다.
> Redis 기반의 분산 세션 저장소는 모든 언어 환경에서 동일하게 적용 가능하며,
> Stateless(JWT) 구조와 병행해 사용하면 보안성과 확장성을 모두 확보할 수 있다.

---

##### 참고자료
- [Spring Session Redis](https://docs.spring.io/spring-session/reference/)
- [Express-session](https://www.npmjs.com/package/express-session)
- [NestJS Session Integration](https://docs.nestjs.com/recipes/session)
- [Redis Sentinel / Cluster](https://redis.io/docs/latest/operate/oss_and_stack/management/scaling/)

---

#### 1. 세션 구조 개요

| 유형 | 특징 | 예시 |
|------|------|------|
| **Sticky Session** | 동일 사용자를 동일 서버에 고정 | 간단하나 확장성 낮음 |
| **Distributed (Shared)** | Redis 세션 저장소 공유 | 확장성 높음 |
| **Stateless (JWT)** | 세션 정보 없는 구조 | 캐시 필요 없음 |

---

#### 2. Express — Redis 세션 스토어
```javascript
import session from "express-session";
import RedisStore from "connect-redis";

app.use(session({
  store: new RedisStore({ client: redis }),
  secret: process.env.SESSION_SECRET,
  resave: false,
  saveUninitialized: false,
  cookie: { maxAge: 600000 }
}));
```

---

#### 3. Spring Boot — Spring Session Redis

```java
@Configuration
@EnableRedisHttpSession(maxInactiveIntervalInSeconds = 600)
public class RedisSessionConfig {}
```

---

#### 4. FastAPI — JWT 기반 세션

```python
from fastapi_jwt_auth import AuthJWT

@router.post("/login")
def login(user: User, Authorize: AuthJWT = Depends()):
    token = Authorize.create_access_token(subject=user.username)
    return {"access_token": token}
```

---

#### 5. NestJS — 세션 모듈 구성

```typescript
import * as session from 'express-session';
import * as RedisStore from 'connect-redis';

app.use(
  session({
    store: new (RedisStore(session))({ client: redis }),
    secret: process.env.SESSION_SECRET,
    saveUninitialized: false,
    resave: false,
  }),
);
```

---

#### 6. 세션 TTL / 만료 정책

| 항목           | 설명                  |
| ------------ | ------------------- |
| TTL          | 세션의 만료 시간 (ex. 30분) |
| Auto Extend  | 사용자 활동 시 TTL 갱신     |
| Force Logout | 관리자에 의한 강제 세션 종료    |

---

#### 7. 보안 강화

* HTTPS + Secure Cookie
* SameSite, HttpOnly 속성 설정
* 세션 고정(Session Fixation) 공격 방지
* Redis 데이터 암호화 (AES or TLS)

---

#### 8. 테스트 전략

* 로그인 후 Redis Key 존재 확인
* TTL 경과 후 세션 만료 검증
* 동시 로그인 제한 테스트
* 클러스터 노드 간 세션 공유 검증

```bash
redis-cli keys "session:*"
```

---

