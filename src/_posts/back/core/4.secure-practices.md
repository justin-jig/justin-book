---
title: "보안 정책 및 실무 적용 가이드 (Security Practices & Hardening Guide)"
date: 2025-10-25
---

#### 요약

- 서비스 환경에서 가장 중요한 보안 항목은 **비밀정보 보호(Secrets Management)** 이다.  
- Spring Boot에서는 **Jasypt**로 환경변수나 설정파일을 암호화할 수 있다.  
- Python, Node.js, NestJS 환경에서는 **dotenv + Vault + KMS** 조합으로 동일한 효과를 얻는다.  
- 본 문서는 **Jasypt 암호화 적용 예시 + Vault 연동 + 운영 환경별 관리 전략**까지 포함한다.


> Jasypt는 Spring Boot 생태계에서 가장 완성도 높은 설정 암호화 도구이며,
> FastAPI/Express/NestJS 환경에서는 동일 개념을
> **dotenv + crypto + Vault** 조합으로 구현하면 동일한 보안 효과를 얻을 수 있다.
>
> 운영환경 보안의 핵심은 **"비밀은 코드가 아닌 외부에서 관리되는 것"**,
> 즉, **환경 변수·Vault·Jasypt가 조화된 관리 체계**를 구축하는 것이다.
---

###  1. Jasypt 개요 (Spring Boot 환경)

**Jasypt(Java Simplified Encryption)**  
→ 환경 설정 파일(`application.yml`/`.properties`)의 민감정보(DB 패스워드, API Key 등)을 암호화하는 라이브러리.

| 항목 | 설명 |
|------|------|
| **암호화 알고리즘** | PBEWithMD5AndDES, PBEWithHMACSHA512AndAES_256 등 |
| **지원 버전** | Spring Boot 2.x / 3.x 이상 |
| **기본 형태** | `ENC(encrypted_text)` |
| **적용 영역** | `application.yml`, 환경 변수, Vault 연동 값 |

---

### 1.1 Maven/Gradle 의존성 추가

```xml
<dependency>
  <groupId>com.github.ulisesbocchio</groupId>
  <artifactId>jasypt-spring-boot-starter</artifactId>
  <version>3.0.5</version>
</dependency>
```

또는 Gradle

```groovy
implementation 'com.github.ulisesbocchio:jasypt-spring-boot-starter:3.0.5'
```

---

### 1.2 암호화 키 설정

```yaml
jasypt:
  encryptor:
    password: ${JASYPT_ENCRYPTOR_PASSWORD}
    algorithm: PBEWithHMACSHA512AndAES_256
    iv-generator-classname: org.jasypt.iv.RandomIvGenerator
```

환경 변수 예시:

```bash
export JASYPT_ENCRYPTOR_PASSWORD="myStrongSecretKey"
```

---

### 1.3 암호화 실행

```bash
# 암호화 명령 실행 (Linux)
java -cp myapp.jar com.ulisesbocchio.jasyptspringboot.encryptor.SimpleAsymmetricStringEncryptor "plainText"
```

또는 IDE/CLI에서:

```bash
$ mvn jasypt:encrypt-value -Djasypt.encryptor.password=myStrongSecretKey -Djasypt.plugin.value="myDbPass"
Encrypted: ENC(2aSDeuR2ezr5O7ZJ0==)
```

---

### 1.4 설정 예시 (`application.yml`)

```yaml
spring:
  datasource:
    url: jdbc:postgresql://localhost:5432/appdb
    username: ENC(G2plxZ4u8xTe1m4==)
    password: ENC(4hsk2Llw3ld/9s==)
```

애플리케이션 실행 시 `JASYPT_ENCRYPTOR_PASSWORD` 환경 변수를 통해 복호화 수행.

---

### 1.5 Vault + Jasypt 연동 (하이브리드 구성)

Jasypt로 암호화된 기본값을 유지하면서,
Vault를 통해 키를 주입받아 **중앙 관리형 키 교체(Secret Rotation)** 구현 가능.

```yaml
spring:
  cloud:
    vault:
      uri: http://vault.example.com:8200
      authentication: token
      token: ${VAULT_TOKEN}
  jasypt:
    encryptor:
      password: ${VAULT:JASYPT_KEY}
```

> Vault 내부 `secret/application` 경로에 `JASYPT_KEY` 등록

---

## 🐍 2. FastAPI / Python 환경 대응

> Python에서는 **python-jasypt** 대안이 없으므로,
> `cryptography`, `Fernet`, `python-dotenv`, `Vault`를 조합한다.

#### 암호화/복호화 예시

```python
from cryptography.fernet import Fernet
key = Fernet.generate_key()
cipher = Fernet(key)
encrypted = cipher.encrypt(b"my_password")
decrypted = cipher.decrypt(encrypted)
```

#### 환경 변수 관리

```bash
# .env 파일
DB_PASSWORD=ENC(gAAAAABn5t...)
SECRET_KEY=my_secret
```

#### FastAPI 연동

```python
from dotenv import load_dotenv
import os
load_dotenv()
DB_PASS = os.getenv("DB_PASSWORD")
```

Vault 또는 AWS Secrets Manager를 활용하여 `os.environ` 값 주입 가능.

---

## 🟩 3. Express / Node.js 환경 대응

> Node.js에서는 Jasypt 대신 **crypto** 또는 **dotenv + KMS/Vault** 조합을 사용한다.

#### crypto 기반 암호화 예시

```javascript
import crypto from "crypto";
const secret = process.env.SECRET_KEY;
const cipher = crypto.createCipher("aes-256-cbc", secret);
let encrypted = cipher.update("myPassword", "utf8", "base64");
encrypted += cipher.final("base64");
```

#### .env 파일

```
DB_USER=admin
DB_PASS=ENC(Y2phf2xqaXNzZ...)
```

복호화 유틸:

```javascript
function decrypt(encValue, key) {
  const decipher = crypto.createDecipher("aes-256-cbc", key);
  let decrypted = decipher.update(encValue, "base64", "utf8");
  return decrypted + decipher.final("utf8");
}
```

#### Vault 연동

```bash
vault kv get secret/app | jq '.data.data'
```

---

## 🟦 4. NestJS 환경

> NestJS는 ConfigModule + dotenv + crypto 조합으로
> 환경 변수 암호화/복호화를 수행한다.

#### 4.1 ConfigModule 전역 등록

```typescript
@Module({
  imports: [
    ConfigModule.forRoot({
      isGlobal: true,
      envFilePath: '.env',
    }),
  ],
})
export class AppModule {}
```

#### 4.2 암호화 유틸

```typescript
import * as crypto from 'crypto';

export const decrypt = (data: string, key: string) => {
  const decipher = crypto.createDecipher('aes-256-cbc', key);
  let decrypted = decipher.update(data, 'base64', 'utf8');
  decrypted += decipher.final('utf8');
  return decrypted;
};
```

#### 4.3 Jasypt 유사 구조 활용

```
DB_USER=ENC(YmFzZTY0RW5jcnlwdGVk)
DB_PASS=ENC(YWJjZGVmZw==)
```

복호화 시 `ConfigService` 내에서 처리:

```typescript
const pass = decrypt(process.env.DB_PASS, process.env.SECRET_KEY);
```

---

## 🔐 5. 운영 보안 전략 (공통)

| 항목                  | 설명                        | 권장 도구                      |
| ------------------- | ------------------------- | -------------------------- |
| **비밀 관리**           | 외부 저장소로 관리                | Vault, AWS Secrets Manager |
| **환경 변수 암호화**       | Jasypt / crypto / Fernet  | 언어별                        |
| **키 회전 (Rotation)** | 주기적 키 교체                  | Vault Lease, Cron          |
| **정책 적용**           | 최소 권한(Least Privilege) 원칙 | IAM Policy                 |
| **감사 로그**           | 접근 이벤트 기록                 | Loki / Sentry              |
| **자동화 점검**          | 종속성 보안 스캔                 | Trivy / npm audit / Bandit |

---

##  6. Jasypt vs dotenv vs Vault 비교

| 항목     | Spring Boot (Jasypt) | Python (dotenv + Fernet) | Node/Nest (crypto + dotenv) |
| ------ | -------------------- | ------------------------ | --------------------------- |
| 암호화 방식 | 대칭키 기반               | Fernet (AES128 GCM)      | AES-256-CBC                 |
| 키 관리   | 환경변수 / Vault         | 환경변수                     | dotenv / ConfigModule       |
| 통합도    | Spring Security와 연동  | 수동 관리                    | ConfigService 자동화           |
| 회전 관리  | Vault 연계 가능          | Manual                   | Manual / Cron               |
| 운영 난이도 | 낮음 (자동복호화 지원)        | 중간                       | 중간                          |

---

