---
title: "Prisma ORM 구성 및 사용"
date: 2025-10-24
---

**version**  
Prisma 6.x / Node.js 22.x / Express 5.x

---

### 요약  
Prisma는 명시적인 스키마 기반 설계와 타입 안전한 쿼리 생성을 제공하는 ORM이다.
Express 환경에서 서비스 계층을 통해 Prisma Client를 호출하면
코드의 명확성과 안정성을 동시에 확보할 수 있다.
마이그레이션 자동화 및 트랜잭션 기능을 활용하면
운영 환경에서도 일관된 데이터베이스 접근 구조를 유지할 수 있다. 

핵심 내용은 다음과 같다.  
- Prisma 설치 및 초기화  
- `schema.prisma` 파일 구성  
- 마이그레이션 및 데이터베이스 연결 설정  
- Prisma Client 사용 예시  
- Express 서비스 계층과의 통합 구조  

Prisma는 명확한 데이터 스키마, 자동 타입 추론, 직관적인 쿼리 구조로  
TypeScript 기반 백엔드 개발에서 가장 널리 사용되는 ORM 중 하나이다.

---

##### 참고자료  
- [Prisma 공식 문서](https://www.prisma.io/docs)  
- [Prisma Schema Reference](https://www.prisma.io/docs/reference/api-reference/prisma-schema-reference)  
- [Prisma Client API](https://www.prisma.io/docs/reference/api-reference/prisma-client-reference)  

---

#### 1. Prisma 설치 및 초기화  

Prisma CLI를 설치하고, 프로젝트 루트에 Prisma 디렉터리를 생성한다.

```bash
pnpm add prisma @prisma/client
npx prisma init
```

초기화 후 다음과 같은 구조가 생성된다.

```
project-root/
 ├── prisma/
 │   └── schema.prisma
 ├── src/
 │   └── services/
 │       └── user.service.ts
 ├── .env
 └── package.json
```

`.env` 파일에 데이터베이스 연결 문자열을 설정한다.

```bash
DATABASE_URL="postgresql://user:password@localhost:5432/mydb?schema=public"
```

---

#### 2. Prisma 스키마 정의

Prisma는 `schema.prisma` 파일을 통해 모델을 정의한다.
모델은 데이터베이스의 테이블 구조를 의미하며, Prisma Client가 이를 기반으로 타입을 생성한다.

```prisma
// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  name      String?
  createdAt DateTime @default(now())
  posts     Post[]
}

model Post {
  id        Int      @id @default(autoincrement())
  title     String
  content   String?
  published Boolean  @default(false)
  authorId  Int
  author    User     @relation(fields: [authorId], references: [id])
}
```

---

#### 3. 마이그레이션 실행

모델을 정의한 후, 데이터베이스에 반영하기 위해 마이그레이션을 수행한다.

```bash
npx prisma migrate dev --name init
```

명령 실행 시 Prisma는 다음 작업을 수행한다.

1. 데이터베이스 연결 확인
2. 마이그레이션 SQL 생성
3. 스키마 동기화 및 적용
4. Prisma Client 자동 생성

운영 환경에서는 `npx prisma migrate deploy` 명령을 사용한다.

---

#### 4. Prisma Client 사용 예시

Prisma Client는 자동 생성된 타입 안전한 데이터 접근 API이다.
다음은 Express 서비스 계층에서 Prisma를 사용하는 예시이다.

```typescript
// src/services/user.service.ts
import { PrismaClient } from "@prisma/client";
const prisma = new PrismaClient();

export const UserService = {
  async getAll() {
    return await prisma.user.findMany();
  },

  async create(data: { email: string; name?: string }) {
    return await prisma.user.create({ data });
  },

  async findByEmail(email: string) {
    return await prisma.user.findUnique({ where: { email } });
  },
};
```

Controller 계층에서는 `UserService`를 호출하여 사용자 데이터를 조회한다.

```typescript
// src/controllers/user.controller.ts
import { Request, Response } from "express";
import { UserService } from "../services/user.service";

export const getUsers = async (req: Request, res: Response) => {
  const users = await UserService.getAll();
  res.json(users);
};
```

---

#### 5. 트랜잭션 처리

여러 작업을 하나의 트랜잭션으로 묶어야 하는 경우,
`prisma.$transaction()` 메서드를 사용할 수 있다.

```typescript
await prisma.$transaction(async (tx) => {
  const user = await tx.user.create({
    data: { email: "new@example.com" },
  });
  await tx.post.create({
    data: { title: "First Post", authorId: user.id },
  });
});
```

트랜잭션 내에서 예외가 발생하면 모든 변경이 자동으로 롤백된다.

---

#### 6. Express 통합 구조

```mermaid
%%{init: {"theme": "default", "themeVariables": {"fontSize": "14px"}}}%%
flowchart TD
    A["Express Controller"] --> B["Service Layer"]
    B --> C["Prisma Client"]
    C --> D["Database"]
```

Prisma는 `Service Layer`에서만 호출되며,
Controller에서는 직접 데이터베이스 접근 로직을 포함하지 않는다.
이 구조는 코드의 테스트 가능성과 유지보수성을 높인다.

---

#### 7. 마이그레이션 자동화 (CI/CD 연동)

배포 시 Prisma 마이그레이션을 자동으로 적용하기 위해
CI 파이프라인에서 다음 명령을 실행한다.

```bash
npx prisma migrate deploy
npx prisma generate
```

Prisma Client는 모델이 변경될 때마다 자동으로 재생성되어
최신 스키마를 반영한다.

---
