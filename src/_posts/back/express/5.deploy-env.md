---
title: "환경 변수 및 설정 관리 모범 사례"
date: 2025-10-24
---

**version**  
Node.js 22.x / Express 5.x / dotenv 16.x / Docker Compose v2 / AWS Parameter Store

---

### 요약  
환경 변수(Environment Variables)는 환경별로 다른 설정(개발, 스테이징, 운영)을 안전하게 분리하기 위한 표준 방법이다.  
하드코딩된 설정은 배포 환경에 따라 변경하기 어렵고 보안 취약점을 초래할 수 있다.  


환경 변수 관리는 코드 보안과 배포 유연성을 모두 만족시키는 핵심 구성 요소이다.
`.env` 파일은 로컬 개발에만 사용하고, 프로덕션에서는 Secret Manager를 통해 안전하게 관리한다.
`dotenv`로 환경별 설정을 자동 로드하고, `zod` 등으로 검증을 추가하면 구성 오류를 예방할 수 있다.
Docker나 CI/CD 환경에서는 런타임 주입 방식을 적용해 보안과 일관성을 유지해야 한다.


핵심 내용은 다음과 같다.  
- `.env` 파일의 구조 및 관리 방식  
- 환경별 설정(dev/staging/prod) 분리  
- dotenv 및 process.env 사용 규칙  
- 보안 키 관리 전략 (KMS, Vault, Parameter Store)  
- 설정 검증(Validation) 및 오류 방지  

#### 환경 변수 관리 다이어그램

```mermaid
%%{init: {"theme": "default", "themeVariables": {"fontSize":"14px"}}}%%
flowchart LR
    A[".env (개발)"] --> B["dotenv 로드"]
    C["CI/CD Secrets"] --> B
    D["AWS Parameter Store / Vault"] --> B
    B --> E["process.env"]
    E --> F["Express Config Module"]
    F --> G["Application Runtime"]
```

---

##### 참고자료  
- [Node.js dotenv Docs](https://github.com/motdotla/dotenv)  
- [Twelve-Factor App – Config](https://12factor.net/config)  
- [AWS Systems Manager Parameter Store](https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-parameter-store.html)  
- [HashiCorp Vault Documentation](https://developer.hashicorp.com/vault/docs)  

---

#### 1. 환경 변수 관리의 원칙  

| 항목 | 원칙 |
|------|------|
| **1. 코드와 설정 분리** | 코드 내부에 비밀번호, 토큰, 포트를 하드코딩하지 않는다. |
| **2. 환경에 따라 값 분리** | 개발·테스트·운영 환경을 `.env.dev`, `.env.prod` 등으로 나눈다. |
| **3. 비밀은 코드 저장소에 포함하지 않는다.** | `.env`는 `.gitignore`에 반드시 추가한다. |
| **4. 환경 변수는 런타임에 주입한다.** | Docker, CI/CD, Cloud Secret Manager를 통해 전달한다. |

---

#### 2. 환경 변수 구조 예시  

`.env.dev` 예시:
```

NODE_ENV=development
PORT=3000
DATABASE_URL=postgres://user:pass@localhost:5432/app_dev
JWT_SECRET=dev_secret_key
LOG_LEVEL=debug

```

`.env.prod` 예시:
```

NODE_ENV=production
PORT=8080
DATABASE_URL=postgres://user:pass@db:5432/app_prod
JWT_SECRET=${PROD_JWT_SECRET}
LOG_LEVEL=info

````

---

#### 3. dotenv 설정  

```bash
pnpm add dotenv
````

```typescript
// src/config/env.ts
import dotenv from "dotenv";
import path from "path";

const envFile = process.env.NODE_ENV === "production" ? ".env.prod" : ".env.dev";
dotenv.config({ path: path.resolve(process.cwd(), envFile) });

export const config = {
  nodeEnv: process.env.NODE_ENV ?? "development",
  port: Number(process.env.PORT ?? 3000),
  dbUrl: process.env.DATABASE_URL ?? "",
  jwtSecret: process.env.JWT_SECRET ?? "",
  logLevel: process.env.LOG_LEVEL ?? "info",
};
```

이제 어느 환경에서 실행하든 동일한 코드를 유지하면서 `.env` 파일만 교체하면 된다.

---

#### 4. 환경별 폴더 구조

```plaintext
src/
├── config/
│   ├── env.ts
│   ├── logger.ts
│   └── database.ts
├── environments/
│   ├── .env.dev
│   ├── .env.stage
│   └── .env.prod
```

환경별로 `.env`를 구분 저장하고, 배포 시 필요한 파일만 컨테이너에 주입한다.

---

#### 5. 환경 변수 검증 (Validation)

실행 시 필수 환경 변수가 누락되면 서비스가 비정상 동작할 수 있다.
이를 방지하기 위해 검증 스크립트를 추가한다.

```bash
pnpm add zod
```

```typescript
// src/config/validateEnv.ts
import { z } from "zod";

const schema = z.object({
  NODE_ENV: z.enum(["development", "staging", "production"]),
  PORT: z.string().regex(/^\d+$/),
  DATABASE_URL: z.string().url(),
  JWT_SECRET: z.string().min(8),
});

export function validateEnv() {
  const parsed = schema.safeParse(process.env);
  if (!parsed.success) {
    console.error("❌ Invalid environment variables:", parsed.error.flatten().fieldErrors);
    process.exit(1);
  }
}
```

```typescript
// server.ts
import { validateEnv } from "./config/validateEnv";
validateEnv();
```

---

#### 6. Docker 환경 변수 주입

Dockerfile 또는 Compose 파일에서 `ENV` 또는 `.env` 참조 방식으로 전달한다.

```yaml
# docker-compose.yml
services:
  api:
    build: .
    environment:
      - NODE_ENV=production
      - DATABASE_URL=${DATABASE_URL}
      - JWT_SECRET=${JWT_SECRET}
    env_file:
      - .env.prod
```

CI/CD 파이프라인에서는 환경 변수를 직접 주입하도록 설정한다.

예시 (GitHub Actions):

```yaml
- name: Run container
  run: docker run -e NODE_ENV=production -e JWT_SECRET=${{ secrets.JWT_SECRET }} my-app
```

---

#### 7. 비밀정보 관리 전략

| 환경        | 권장 보안 관리 방식                                     |
| --------- | ----------------------------------------------- |
| **로컬**    | `.env` 파일, `.gitignore` 필수                      |
| **스테이징**  | `.env.stage` + Compose `env_file`               |
| **프로덕션**  | AWS Parameter Store / Vault / Kubernetes Secret |
| **CI/CD** | Secret Variables (GitHub, GitLab, Jenkins 등)    |

**AWS SSM Parameter Store 예시:**

```bash
aws ssm put-parameter \
  --name "/app/prod/jwt_secret" \
  --value "prod_key_1234" \
  --type SecureString
```

Express에서 로드:

```typescript
import { SSMClient, GetParameterCommand } from "@aws-sdk/client-ssm";
const ssm = new SSMClient({ region: "ap-northeast-2" });
const secret = await ssm.send(new GetParameterCommand({ Name: "/app/prod/jwt_secret", WithDecryption: true }));
```

---

#### 8. 환경 변수 로딩 시점

* **초기 로딩**: 앱 시작 시 `.env` 파일에서 불러오기
* **동적 로딩**: 런타임에 Secret API 호출 (AWS/GCP/Vault)
* **우선순위**

  1. CI/CD 런타임 변수
  2. 시스템 환경 변수
  3. `.env` 파일
  4. 코드 내 기본값 (fallback)

---

