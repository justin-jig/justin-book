---
title: "Express í†µí•© í…ŒìŠ¤íŠ¸(Integration Test) êµ¬ì„± ê°€ì´ë“œ"
date: 2025-10-24
---

**version**  
Node.js 22.x / Express 5.x / Jest 29.x / Supertest 7.x / TypeScript 5.x

---

### ìš”ì•½  
í†µí•© í…ŒìŠ¤íŠ¸(Integration Test)ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸(ë¼ìš°í„°, ë¯¸ë“¤ì›¨ì–´, DB, ì„œë¹„ìŠ¤)ê°€  
ì‹¤ì œ ìš”ì²­ íë¦„ì„ í†µí•´ ì˜¬ë°”ë¥´ê²Œ ì—°ë™ë˜ëŠ”ì§€ ê²€ì¦í•˜ëŠ” ê³¼ì •ì´ë‹¤.  
ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ê°€ ê°œë³„ í•¨ìˆ˜ ê²€ì¦ì´ë¼ë©´, í†µí•© í…ŒìŠ¤íŠ¸ëŠ” **ì—”ë“œí¬ì¸íŠ¸ ë‹¨ìœ„ ì‹œë‚˜ë¦¬ì˜¤ ê²€ì¦**ì„ ëª©í‘œë¡œ í•œë‹¤.  

í†µí•© í…ŒìŠ¤íŠ¸ëŠ” ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ì˜ í™•ì¥ìœ¼ë¡œ, Express ì„œë²„ ì „ì²´ì˜ API íë¦„ì„ ì‹¤ì œ ìš”ì²­ìœ¼ë¡œ ê²€ì¦í•œë‹¤.
Supertestë¥¼ ì´ìš©í•˜ë©´ ì„œë²„ í¬íŠ¸ë¥¼ ì—´ì§€ ì•Šê³  ìš”ì²­ì„ ì‹œë®¬ë ˆì´ì…˜í•  ìˆ˜ ìˆìœ¼ë©°,
JWT ì¸ì¦, DB ì—°ë™, ë¯¸ë“¤ì›¨ì–´ ê²€ì¦ê¹Œì§€ í¬í•¨í•˜ì—¬ ì™„ì „í•œ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.
í…ŒìŠ¤íŠ¸ ìë™í™” íŒŒì´í”„ë¼ì¸ì— í¬í•¨ì‹œí‚¤ë©´, ì½”ë“œ ë³€ê²½ ì‹œ íšŒê·€ ì˜¤ë¥˜ë¥¼ ì‚¬ì „ì— ì°¨ë‹¨í•  ìˆ˜ ìˆë‹¤.


í•µì‹¬ ë‚´ìš©ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.  
- Supertest í™˜ê²½ êµ¬ì„± ë° Express ì¸ìŠ¤í„´ìŠ¤ ì£¼ì…  
- ë¼ìš°í„°/ë¯¸ë“¤ì›¨ì–´/DB ì—°ë™ í…ŒìŠ¤íŠ¸  
- Jest í™˜ê²½ ê²©ë¦¬ (setup/teardown)  
- ì¸ì¦ í† í°Â·ì„¸ì…˜ ê¸°ë°˜ í…ŒìŠ¤íŠ¸ íŒ¨í„´  
- Mock DB ë˜ëŠ” SQLite ì„ì‹œ DB í™œìš©  

#### í†µí•© í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë‹¤ì´ì–´ê·¸ë¨

```mermaid
%%{init: {"theme": "default", "themeVariables": {"fontSize":"14px"}}}%%
flowchart LR
    A["Supertest (Request)"] --> B["Express App Instance"]
    B --> C["Middleware / Router"]
    C --> D["Service / Repository"]
    D --> E["Test Database (SQLite / Mock Prisma)"]
    E --> F["Response ê²€ì¦ (Assertions)"]
```

##### ì°¸ê³ ìë£Œ  
- [Supertest GitHub](https://github.com/visionmedia/supertest)  
- [Jest Setup & Teardown](https://jestjs.io/docs/setup-teardown)  
- [Express Testing Patterns](https://expressjs.com/en/advanced/best-practice-performance.html#testing)  

---

#### 1. í†µí•© í…ŒìŠ¤íŠ¸ì˜ ëª©ì   

| êµ¬ë¶„ | ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ | í†µí•© í…ŒìŠ¤íŠ¸ |
|------|--------------|-------------|
| **í…ŒìŠ¤íŠ¸ ë‹¨ìœ„** | í•¨ìˆ˜ / ë©”ì„œë“œ | ì „ì²´ ì—”ë“œí¬ì¸íŠ¸ |
| **ëª©í‘œ** | ë¡œì§ ì •í™•ì„± ê²€ì¦ | ì‹¤ì œ API íë¦„ ê²€ì¦ |
| **ì†ë„** | ë¹ ë¦„ (ms ë‹¨ìœ„) | ì¤‘ê°„ (ì´ˆ ë‹¨ìœ„) |
| **í™˜ê²½** | Mock / Stub | ì‹¤ì œ ì„œë²„ / ë¼ìš°í„° / DB |
| **ëŒ€í‘œ ë„êµ¬** | Jest | Supertest + Jest |

---

#### 2. Supertest í™˜ê²½ êµ¬ì„±  

```bash
pnpm add -D supertest jest ts-jest @types/jest @types/supertest
```

`jest.config.js` (ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ì™€ ë™ì¼):

```js
export default {
  preset: "ts-jest",
  testEnvironment: "node",
  roots: ["<rootDir>/tests"],
};
```

---

#### 3. Express ì„œë²„ ì„ì‹œ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±

```typescript
// src/app.ts
import express from "express";
import userRouter from "./routes/user.route";
const app = express();
app.use(express.json());
app.use("/api/v1/users", userRouter);
export default app;
```

í…ŒìŠ¤íŠ¸ ì‹œ ì„œë²„ í¬íŠ¸ë¥¼ ì—´ì§€ ì•Šê³  `app` ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì§ì ‘ í˜¸ì¶œí•œë‹¤.

---

#### 4. ê¸°ë³¸ í…ŒìŠ¤íŠ¸ ì˜ˆì‹œ

```typescript
// tests/integration/user.integration.test.ts
import request from "supertest";
import app from "../../src/app";

describe("User API Integration", () => {
  test("GET /api/v1/users â†’ 200 OK", async () => {
    const res = await request(app).get("/api/v1/users");
    expect(res.status).toBe(200);
    expect(res.body).toHaveProperty("success", true);
    expect(Array.isArray(res.body.data)).toBe(true);
  });
});
```

`supertest(app)`ì€ ì‹¤ì œ ì„œë²„ë¥¼ êµ¬ë™í•˜ì§€ ì•Šê³  Express í•¸ë“¤ëŸ¬ë¥¼ ì§ì ‘ í˜¸ì¶œí•œë‹¤.

---

#### 5. POST ìš”ì²­ í…ŒìŠ¤íŠ¸

```typescript
test("POST /api/v1/users â†’ 201 Created", async () => {
  const payload = { name: "Ingeun", email: "user@example.com" };
  const res = await request(app).post("/api/v1/users").send(payload);
  expect(res.status).toBe(201);
  expect(res.body.data.name).toBe("Ingeun");
});
```

ì‘ë‹µ ê²€ì¦ ì‹œ ìƒíƒœ ì½”ë“œ, JSON êµ¬ì¡°, í•„ìˆ˜ í•„ë“œë¥¼ í•¨ê»˜ ì²´í¬í•œë‹¤.

---

#### 6. ì¸ì¦ í† í° ê¸°ë°˜ í…ŒìŠ¤íŠ¸

ë¡œê·¸ì¸ â†’ JWT ë°œê¸‰ â†’ ì¸ì¦ í—¤ë” í…ŒìŠ¤íŠ¸ íŒ¨í„´ ì˜ˆì‹œ:

```typescript
let token: string;

beforeAll(async () => {
  const res = await request(app)
    .post("/api/v1/auth/login")
    .send({ email: "user@example.com", password: "1234" });
  token = res.body.token;
});

test("GET /api/v1/profile (with token)", async () => {
  const res = await request(app)
    .get("/api/v1/profile")
    .set("Authorization", `Bearer ${token}`);
  expect(res.status).toBe(200);
  expect(res.body.data).toHaveProperty("email");
});
```

---

#### 7. DB ì—°ë™ í…ŒìŠ¤íŠ¸ (In-memory SQLite ì˜ˆì‹œ)

í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œëŠ” ì‹¤ì œ DB ëŒ€ì‹  ì„ì‹œ SQLite ë©”ëª¨ë¦¬ DBë¥¼ ì‚¬ìš©í•œë‹¤.

```typescript
// src/config/test-database.ts
import { PrismaClient } from "@prisma/client";
export const prisma = new PrismaClient({
  datasources: { db: { url: "file:./test.db?mode=memory&cache=shared" } },
});
```

í…ŒìŠ¤íŠ¸ ì‹œì‘ ì‹œ ë§ˆì´ê·¸ë ˆì´ì…˜ ë° ì´ˆê¸°í™” ìˆ˜í–‰:

```bash
npx prisma migrate deploy
```

---

#### 8. Setup / Teardown

í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì „í›„ì— ê³µí†µ ì„¤ì •ì„ ì ìš©í•œë‹¤.

```typescript
// tests/setup.ts
beforeAll(async () => {
  console.log("ğŸš€ Integration tests starting...");
});

afterAll(async () => {
  console.log("ğŸ§¹ Integration tests completed.");
});
```

`package.json`ì— ì§€ì •:

```json
"jest": {
  "globalSetup": "./tests/setup.ts"
}
```

---

#### 9. ì»¤ë²„ë¦¬ì§€ í™•ì¸

```bash
pnpm jest --coverage
```

í†µí•© í…ŒìŠ¤íŠ¸ëŠ” ë³´í†µ **ë¹„ì¦ˆë‹ˆìŠ¤ í”Œë¡œìš° ì¤‘ì‹¬ ì»¤ë²„ë¦¬ì§€**ë¥¼ ì¸¡ì •í•œë‹¤.
API ì£¼ìš” ì‹œë‚˜ë¦¬ì˜¤(ë“±ë¡ â†’ ì¡°íšŒ â†’ ìˆ˜ì • â†’ ì‚­ì œ)ë¥¼ ìµœì†Œ 1íšŒì”© ê²€ì¦í•´ì•¼ í•œë‹¤.

---

