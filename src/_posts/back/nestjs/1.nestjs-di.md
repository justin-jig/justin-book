---
title: "NestJS Dependency Injection System"
date: 2025-10-25
---

**version: NestJS v10.x / Node.js v20 LTS 기준**

#### 요약

NestJS는 **DI(Dependency Injection)** 컨테이너 기반으로 동작하며,  
클래스 간의 의존 관계를 자동 관리한다.  
이 시스템은 **Provider**, **Scope**, **Token**을 중심으로 작동하며,  
테스트, 확장, 모듈 간 통합을 단순화한다.

NestJS의 DI는 **모듈 간 결합도를 낮추고, 유지보수성을 높이는 핵심 아키텍처 요소**이다.
Provider–Scope–Token–Factory 구조를 통해 유연하고 테스트 가능한 설계를 구현할 수 있다.

##### DI 컨테이너 흐름 요약

```mermaid
flowchart LR
  A["@Module"] --> B["Provider 등록"]
  B --> C["DI Container"]
  C --> D["Constructor Injection"]
  D --> E["Service 실행"]
```

> NestJS는 모든 클래스 인스턴스를 DI 컨테이너에서 관리하며,
> 직접 객체를 생성하지 않아도 의존성이 자동 해결된다.

---

##### 참고자료
- [NestJS Fundamentals — Providers](https://docs.nestjs.com/fundamentals/custom-providers)
- [Dependency Injection in NestJS](https://docs.nestjs.com/fundamentals/dependency-injection)

---

### 1. 기본 개념

```typescript
@Injectable()
export class UserService {
  constructor(private readonly userRepo: UserRepository) {}
}
```

| 개념                      | 설명                     |
| ----------------------- | ---------------------- |
| **@Injectable()**       | 클래스를 DI 컨테이너에 등록       |
| **constructor()**       | 의존성 자동 주입              |
| **Reflection Metadata** | 런타임 타입 정보를 기반으로 의존성 탐색 |

---

### 2. Provider의 구성 요소

| 속성           | 역할          | 예시                      |
| ------------ | ----------- | ----------------------- |
| `provide`    | 토큰명 지정      | `'DATABASE_CONNECTION'` |
| `useClass`   | 클래스 주입      | `DatabaseService`       |
| `useValue`   | 상수 주입       | `'localhost'`           |
| `useFactory` | 동적 객체 생성    | 환경별 설정                  |
| `inject`     | 의존 주입 대상 지정 | `[ConfigService]`       |

**예시**

```typescript
@Module({
  providers: [
    {
      provide: 'CONFIG_PATH',
      useFactory: () => process.env.NODE_ENV === 'prod' ? '/etc/app/config' : './.env',
    },
  ],
})
export class ConfigModule {}
```

---

### 3. Provider Scope

| Scope       | 설명               | 사용 예시           |
| ----------- | ---------------- | --------------- |
| `DEFAULT`   | 앱 전체에서 단일 인스턴스   | 대부분의 서비스        |
| `REQUEST`   | 요청 단위로 새 인스턴스 생성 | RequestContext  |
| `TRANSIENT` | 매번 새 객체 생성       | Helper, Utility |

```typescript
@Injectable({ scope: Scope.REQUEST })
export class AuditService {}
```

---

### 4. 커스텀 Provider Token

```typescript
export const LOGGER = 'LOGGER';

@Module({
  providers: [
    {
      provide: LOGGER,
      useFactory: () => new LoggerService('AppLogger'),
    },
  ],
  exports: [LOGGER],
})
export class LoggerModule {}
```

```typescript
@Injectable()
export class UserService {
  constructor(@Inject(LOGGER) private readonly logger: LoggerService) {}
}
```

---
