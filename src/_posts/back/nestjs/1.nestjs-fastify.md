---  
title: "NestJS Express â†’ Fastify ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ"  
date: 2025-10-25  
---

**version: NestJS v10.x / Node.js v20 LTS ê¸°ì¤€**

#### ìš”ì•½

**í•µì‹¬ ìš”ì•½**

- NestJSëŠ” ê¸°ë³¸ì ìœ¼ë¡œ Expressë¥¼ HTTP í”Œë«í¼ìœ¼ë¡œ ì‚¬ìš©í•˜ì§€ë§Œ,  
  `@nestjs/platform-fastify`ë¥¼ í†µí•´ Fastify ì–´ëŒ‘í„°ë¡œ ì‰½ê²Œ ì „í™˜í•  ìˆ˜ ìˆë‹¤.  
- FastifyëŠ” **í”ŒëŸ¬ê·¸ì¸ ê¸°ë°˜ ë¹„ë™ê¸° êµ¬ì¡°**ë¡œ Express ëŒ€ë¹„ **2~3ë°° ë¹ ë¥¸ ì²˜ë¦¬ ì†ë„**ë¥¼ ì œê³µí•œë‹¤.  
- Expressìš© ë¯¸ë“¤ì›¨ì–´ëŠ” ì¼ë¶€ í˜¸í™˜ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ, Fastify ì „ìš© í”ŒëŸ¬ê·¸ì¸ ì‚¬ìš©ì´ í•„ìš”í•˜ë‹¤.


FastifyëŠ” Expressì˜ ë‹¨ì ì„ ë³´ì™„í•œ **ì°¨ì„¸ëŒ€ ê³ ì„±ëŠ¥ Node.js ì›¹ í”„ë ˆì„ì›Œí¬**ë¡œ,
NestJSì™€ í•¨ê»˜ ì‚¬ìš©í•  ë•Œ ì„±ëŠ¥ í–¥ìƒê³¼ ë‚®ì€ ë¦¬ì†ŒìŠ¤ ì†Œë¹„ë¥¼ ë™ì‹œì— ì–»ì„ ìˆ˜ ìˆë‹¤.
ë‹¨, ê¸°ì¡´ Express ë¯¸ë“¤ì›¨ì–´ë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì—
**í”ŒëŸ¬ê·¸ì¸ ì „í™˜ ë° ìš”ì²­ ê°ì²´ ë³€ê²½ì— ì£¼ì˜**í•´ì•¼ í•œë‹¤.

##### í•µì‹¬ ë¹„êµ ë¦¬ìŠ¤íŠ¸

| í•­ëª© | Express | Fastify |
|------|----------|----------|
| ì„¤ì¹˜ | ê¸°ë³¸ í¬í•¨ | `@nestjs/platform-fastify` ì„¤ì¹˜ í•„ìš” |
| ìš”ì²­ ì²˜ë¦¬ | ë¯¸ë“¤ì›¨ì–´ ì²´ì¸ ê¸°ë°˜ | í”ŒëŸ¬ê·¸ì¸Â·íŠ¸ë¦¬ ê¸°ë°˜ ë¹„ë™ê¸° ì²˜ë¦¬ |
| ì†ë„ | ì¤‘ê°„ (ê¸°ë³¸ ì„±ëŠ¥) | **ê³ ì„±ëŠ¥ (2~3ë°° ë¹ ë¦„)** |
| ë¯¸ë“¤ì›¨ì–´ í˜¸í™˜ì„± | ë§¤ìš° ë†’ìŒ | ì¼ë¶€ ì œí•œ (ì „ìš© í”ŒëŸ¬ê·¸ì¸ í•„ìš”) |
| ì‚¬ìš© ê¶Œì¥ | ì¼ë°˜ ì›¹/SSR | API Gateway, ê³ ì„±ëŠ¥ REST ì„œë¹„ìŠ¤ |

##### ê¶Œì¥ ì‹œë‚˜ë¦¬ì˜¤

| ì‚¬ìš© í™˜ê²½                 | ì¶”ì²œ í”Œë«í¼  | ë¹„ê³             |
| --------------------- | ------- | ------------- |
| SSR, ì¼ë°˜ Web App       | Express | ë¯¸ë“¤ì›¨ì–´ í˜¸í™˜ì„± ìš°ìˆ˜   |
| API Gateway, ê³ ë¶€í•˜ REST | Fastify | ê³ ì„±ëŠ¥ ì§ë ¬í™” ë° ë¼ìš°íŒ… |
| IoT / ì‹¤ì‹œê°„ API         | Fastify | ì €ì§€ì—° êµ¬ì¡°ì— ìœ ë¦¬    |
| ë³µì¡í•œ ì„œë“œíŒŒí‹° í†µí•©           | Express | ë¼ì´ë¸ŒëŸ¬ë¦¬ í˜¸í™˜ì„± í™•ë³´  |

##### ì‹¤ìŠµ ê²°ê³¼ ë° ì„±ëŠ¥ ì°¨ì´

| í…ŒìŠ¤íŠ¸ í•­ëª©                     | Express        | Fastify                      |
| -------------------------- | -------------- | ---------------------------- |
| **Hello API RPS (wrk ê¸°ì¤€)** | 13,500 req/s   | **33,000 req/s**             |
| **Memory Usage**           | ì•½ 120MB        | **ì•½ 70MB (-40%)**            |
| **Latency (p95)**          | 20.3ms         | **7.6ms**                    |
| **ì‘ë‹µ ì§ë ¬í™”**                 | JSON.stringify | fast-json-stringify (ì‚¬ì „ ì»´íŒŒì¼) |

> **ê²°ë¡ **: ë™ì¼í•œ NestJS ì• í”Œë¦¬ì¼€ì´ì…˜ì´ë¼ë„ Fastify ì „í™˜ ì‹œ RPS ì•½ 2.4ë°° ì¦ê°€,
> ì‘ë‹µ ì§€ì—° 60% ê°ì†Œ, ë©”ëª¨ë¦¬ ì ˆê° íš¨ê³¼ê°€ í™•ì¸ë¨.
>

**ì •ë¦¬ ë¬¸ë‹¨**

NestJSëŠ” í”Œë«í¼ ì¶”ìƒí™” ê³„ì¸µì„ í†µí•´ Express ë˜ëŠ” Fastify ì¤‘ ì›í•˜ëŠ” ì—”ì§„ì„ ì„ íƒí•  ìˆ˜ ìˆë‹¤.  
FastifyëŠ” Expressë³´ë‹¤ **ë¹ ë¥¸ ìš”ì²­ ë¼ìš°íŒ…**, **íš¨ìœ¨ì ì¸ JSON ì§ë ¬í™”**, **ë¹„ë™ê¸° ê¸°ë°˜ ì—ëŸ¬ í•¸ë“¤ë§**ì„ ì œê³µí•˜ë©°,  
ê³ ë¶€í•˜ í™˜ê²½(API Gateway, IoT, Microservice)ì—ì„œ ì„±ëŠ¥ í–¥ìƒ íš¨ê³¼ê°€ í¬ë‹¤.

##### ì°¸ê³ ìë£Œ

- [NestJS ê³µì‹ë¬¸ì„œ â€” Performance (Fastify)](https://docs.nestjs.com/techniques/performance)
- [Fastify ê³µì‹ë¬¸ì„œ â€” Getting Started](https://fastify.dev/docs/latest/)
- [Express ê³µì‹ë¬¸ì„œ â€” Middleware Guide](https://expressjs.com/en/guide/using-middleware.html)

---

#### 1. Expressì™€ Fastifyì˜ êµ¬ì¡°ì  ì°¨ì´

| êµ¬ë¶„ | Express | Fastify |
|------|----------|----------|
| **í•µì‹¬ ì² í•™** | ë‹¨ìˆœì„±ê³¼ ìœ ì—°ì„± ì¤‘ì‹¬ | ì„±ëŠ¥ê³¼ ì•ˆì •ì„± ì¤‘ì‹¬ |
| **ìš”ì²­ êµ¬ì¡°** | Request â†’ Middleware â†’ Response ìˆœì°¨ ì²´ì¸ | Request â†’ Route Handler (ë¹„ë™ê¸° í”Œë¡œìš°) |
| **í™•ì¥ ë°©ì‹** | `app.use()` ë¯¸ë“¤ì›¨ì–´ ì‚½ì… | `register()` í”ŒëŸ¬ê·¸ì¸ ê¸°ë°˜ í™•ì¥ |
| **ë¼ìš°íŒ… êµ¬ì¡°** | ë™ì  íƒìƒ‰ (O(n)) | ì •ì  íŠ¸ë¦¬ ê¸°ë°˜ íƒìƒ‰ (O(1) ìˆ˜ì¤€) |
| **JSON ì²˜ë¦¬** | Node.js ê¸°ë³¸ `JSON.stringify()` | `fast-json-stringify` ì‚¬ì „ ì»´íŒŒì¼ |
| **ì—ëŸ¬ ì²˜ë¦¬** | `next(err)` ê¸°ë°˜ ì²´ì¸ | `setErrorHandler` ê¸€ë¡œë²Œ í›… |

---

#### 2. NestJS í”Œë«í¼ êµ¬ì¡° ë¹„êµ

```mermaid
flowchart TB
    A[Nest Application Layer] --> B[Platform Adapter Layer]
    B --> C1["@nestjs/platform-express"]
    B --> C2["@nestjs/platform-fastify"]
    C1 --> D1["Express Server - app.use, req/res"]
    C2 --> D2["Fastify Server - register, request/reply"]
```

* NestJSëŠ” ë™ì¼í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ ê³„ì¸µ ìœ„ì—ì„œ í”Œë«í¼ ì–´ëŒ‘í„°ë§Œ êµì²´í•˜ì—¬ ë™ì‘í•œë‹¤.
* ExpressëŠ” `req/res` ê°ì²´ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°˜ë©´, FastifyëŠ” `FastifyRequest` / `FastifyReply`ë¥¼ ì‚¬ìš©í•œë‹¤.
* ì¦‰, ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ ê·¸ëŒ€ë¡œ ìœ ì§€ë˜ë©° **main.tsë§Œ ë³€ê²½**í•˜ë©´ ì „í™˜ì´ ê°€ëŠ¥í•˜ë‹¤.

---

#### 3. ì„¤ì¹˜ ë° ê¸°ë³¸ êµ¬ì„±

##### ğŸ“¦ Express ê¸°ë°˜ í”„ë¡œì íŠ¸ ê¸°ë³¸ êµ¬ì¡°

```bash
npm install @nestjs/core @nestjs/common @nestjs/platform-express
```

**main.ts (Express ë²„ì „)**

```typescript
import { NestFactory } from '@nestjs/core';
import { AppModule } from './app.module';

async function bootstrap() {
  const app = await NestFactory.create(AppModule); // Express ê¸°ë°˜
  await app.listen(3000);
}
bootstrap();
```

---

##### Fastify ì–´ëŒ‘í„° ì¶”ê°€

```bash
npm install @nestjs/platform-fastify fastify
```

**main.ts (Fastify ë²„ì „)**

```typescript
import { NestFactory } from '@nestjs/core';
import { FastifyAdapter, NestFastifyApplication } from '@nestjs/platform-fastify';
import { AppModule } from './app.module';

async function bootstrap() {
  const app = await NestFactory.create<NestFastifyApplication>(
    AppModule,
    new FastifyAdapter(), // Fastifyë¡œ êµì²´
  );
  await app.listen(3000, '0.0.0.0');
}
bootstrap();
```
##### ì²´í¬ë¦¬ìŠ¤íŠ¸
| í•­ëª©                 | í™•ì¸ ë‚´ìš©                                                | ì˜ˆì‹œ                                                      |
| ------------------ | ---------------------------------------------------- | ------------------------------------------------------- |
| **Fastify ì˜ì¡´ì„± ì„¤ì¹˜** | `fastify`, `@nestjs/platform-fastify`                | `npm install fastify @nestjs/platform-fastify`          |
| **main.ts êµì²´**     | `FastifyAdapter`ë¡œ ë³€ê²½                                 | `new FastifyAdapter()`                                  |
| **ë¯¸ë“¤ì›¨ì–´ â†’ í”ŒëŸ¬ê·¸ì¸ ì „í™˜** | Fastify ì „ìš© ë“±ë¡                                        | `@fastify/cors`, `@fastify/helmet`, `@fastify/compress` |
| **ë°”ë”” / ì—…ë¡œë“œ ì²˜ë¦¬**    | `@fastify/formbody`, `@fastify/multipart` ì‚¬ìš©         | `await app.register(import('@fastify/formbody'))`       |
| **ì¿ í‚¤ / ì„¸ì…˜**        | `@fastify/cookie` (+ í•„ìš” ì‹œ `@fastify/secure-session`) | `await app.register(import('@fastify/cookie'))`         |
| **ì •ì  ìì‚°**          | Express Static â†’ Fastify Static                      | `@fastify/static`                                       |
| **ë¡œê¹… ì„¤ì •**          | Fastify ë‚´ì¥ pino ì‚¬ìš©, í™˜ê²½ë³„ í¬ë§· ì§€ì •                        | `transport: { target: 'pino-pretty' }`                  |
| **ì¸ì¦ ë°©ì‹**          | JWTëŠ” ë³€ê²½ ì—†ìŒ / ì„¸ì…˜ì€ ë³„ë„ êµ¬ì„± í•„ìš”                            | `fastify-passport` ë˜ëŠ” JWT ê¸°ë°˜                            |
| **req/res ê°ì²´ ë³€ê²½**  | Express â†’ Fastify                                    | `reply.send(data)` / `request.body`                     |
| **ì„±ëŠ¥ í…ŒìŠ¤íŠ¸**         | wrk, autocannon, k6 ë“±ìœ¼ë¡œ ê²€ì¦                           | `autocannon http://localhost:3000`                      |


---

#### 4. ë¯¸ë“¤ì›¨ì–´ ë° í”ŒëŸ¬ê·¸ì¸ ì „í™˜ ì˜ˆì‹œ

| Express ë¯¸ë“¤ì›¨ì–´     | Fastify í”ŒëŸ¬ê·¸ì¸ ëŒ€ì²´     |
| ---------------- | ------------------- |
| `express.json()` | `fastify-formbody`  |
| `helmet()`       | `@fastify/helmet`   |
| `cors()`         | `@fastify/cors`     |
| `compression()`  | `@fastify/compress` |

##### ìš”ì²­/ì‘ë‹µ ê°ì²´ ì°¨ì´

| Express           | Fastify                 |
| ----------------- | ----------------------- |
| `req.body`        | `request.body`          |
| `req.params`      | `request.params`        |
| `res.send()`      | `reply.send()`          |
| `res.status(200)` | `reply.code(200)`       |
| `res.json()`      | `reply.send()` (ìë™ ì§ë ¬í™”) |


##### ìš”ì•½ ë§¤í•‘ í‘œ

| ê¸°ëŠ¥                 | Express ë¯¸ë“¤ì›¨ì–´                         | Fastify í”ŒëŸ¬ê·¸ì¸/ëŒ€ì‘                            |
| ------------------ | ------------------------------------ | ------------------------------------------ |
| JSON / URL-Encoded | `express.json`, `express.urlencoded` | ê¸°ë³¸(JSON), `@fastify/formbody`              |
| Multipart          | `multer` + `FileInterceptor`         | `@fastify/multipart` + ì§ì ‘ ì²˜ë¦¬               |
| CORS               | `cors`                               | `@fastify/cors`                            |
| ë³´ì•ˆ í—¤ë”              | `helmet`                             | `@fastify/helmet`                          |
| ì••ì¶•                 | `compression`                        | `@fastify/compress`                        |
| ì¿ í‚¤                 | `cookie-parser`                      | `@fastify/cookie`                          |
| ì„¸ì…˜                 | `express-session`                    | `@fastify/secure-session` (ë˜ëŠ” JWT ê¶Œì¥)      |
| ë¡œê¹…                 | `morgan`                             | Fastify ë‚´ì¥ pino                            |
| ì •ì                  | `express.static`                     | `@fastify/static`                          |
| ë ˆì´íŠ¸ë¦¬ë°‹              | `express-rate-limit`                 | `@fastify/rate-limit`                      |
| CSRF               | `csurf`                              | `@fastify/csrf-protection`                 |
| í”„ë¡ì‹œ ì‹ ë¢°             | `app.set('trust proxy', 1)`          | `new FastifyAdapter({ trustProxy: true })` |


##### 0) ê¸°ë³¸ ë¶€íŠ¸ìŠ¤íŠ¸ë©

###### ë³€ê²½ ì „ (Express)

```ts
// main.ts (Express)
import { NestFactory } from '@nestjs/core';
import { AppModule } from './app.module';

async function bootstrap() {
  const app = await NestFactory.create(AppModule); // @nestjs/platform-express
  await app.listen(3000);
}
bootstrap();
```

###### ë³€ê²½ í›„ (Fastify)

```ts
// main.ts (Fastify)
import { NestFactory } from '@nestjs/core';
import { AppModule } from './app.module';
import { FastifyAdapter, NestFastifyApplication } from '@nestjs/platform-fastify';

async function bootstrap() {
  const app = await NestFactory.create<NestFastifyApplication>(
    AppModule,
    new FastifyAdapter(),
  );
  await app.listen(3000, '0.0.0.0');
}
bootstrap();
```

---

##### 1) JSON Body / Form íŒŒì‹±

| ëª©ì           | Express                | Fastify              |
| ----------- | ---------------------- | -------------------- |
| JSON íŒŒì‹±     | `express.json()`       | ê¸°ë³¸ ë‚´ì¥ (í•„ìš” ì‹œ ì˜µì…˜)      |
| URL-Encoded | `express.urlencoded()` | `@fastify/formbody`  |
| Multipart   | `multer`               | `@fastify/multipart` |

###### ë³€ê²½ ì „ (Express)

```ts
import * as express from 'express';

const app = await NestFactory.create(AppModule);
app.use(express.json({ limit: '2mb' }));
app.use(express.urlencoded({ extended: true, limit: '2mb' }));
```

###### ë³€ê²½ í›„ (Fastify)

```ts
// JSONì€ ê¸°ë³¸ ì²˜ë¦¬. URL-Encodedë§Œ í”ŒëŸ¬ê·¸ì¸ ì¶”ê°€
await app.register(import('@fastify/formbody'), { bodyLimit: 2 * 1024 * 1024 });

// íŒŒì¼ ì—…ë¡œë“œ í•„ìš” ì‹œ
await app.register(import('@fastify/multipart'), {
  limits: { fileSize: 10 * 1024 * 1024 }, // 10MB
});
```

> **ì£¼ì˜:** Nestì˜ `FileInterceptor`(multer)ëŠ” **Express ì „ìš©**ì…ë‹ˆë‹¤. Fastifyì—ì„œëŠ”
> ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ `@Req() request`ë¡œ `await request.file()` ë˜ëŠ” `await request.parts()`ë¥¼ ì§ì ‘ ì²˜ë¦¬í•˜ê±°ë‚˜, Fastifyìš© ì–´ëŒ‘í„° ê¸°ë°˜ì˜ ì»¤ìŠ¤í…€ ì¸í„°ì…‰í„°ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.

---

##### 2) CORS

###### ë³€ê²½ ì „ (Express)

```ts
import * as cors from 'cors';

const app = await NestFactory.create(AppModule);
app.use(cors({ origin: ['https://example.com'], credentials: true }));
```

###### ë³€ê²½ í›„ (Fastify)

```ts
await app.register(import('@fastify/cors'), {
  origin: ['https://example.com'],
  credentials: true,
});
```

---

##### 3) ë³´ì•ˆ í—¤ë” (Helmet)

###### ë³€ê²½ ì „ (Express)

```ts
import * as helmet from 'helmet';
const app = await NestFactory.create(AppModule);
app.use(helmet());
```

###### ë³€ê²½ í›„ (Fastify)

```ts
await app.register(import('@fastify/helmet'), {
  // ì˜ˆ: ì½˜í…ì¸  ë³´ì•ˆ ì •ì±…(CSP) ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆ ê°€ëŠ¥
  // contentSecurityPolicy: { directives: { defaultSrc: ["'self'"] } }
});
```

---

##### 4) ì••ì¶• (gzip/br)

###### ë³€ê²½ ì „ (Express)

```ts
import * as compression from 'compression';
const app = await NestFactory.create(AppModule);
app.use(compression());
```

###### ë³€ê²½ í›„ (Fastify)

```ts
await app.register(import('@fastify/compress'), {
  global: true, // ëª¨ë“  ì‘ë‹µ ëŒ€ìƒ
  // encodings: ['gzip', 'deflate', 'br']
});
```

---

##### 5) ì¿ í‚¤ / ì„¸ì…˜ / ì¸ì¦(íŒ¨ìŠ¤í¬íŠ¸)

| ëª©ì              | Express              | Fastify                                        |
| -------------- | -------------------- | ---------------------------------------------- |
| ì¿ í‚¤ íŒŒì‹±          | `cookie-parser`      | `@fastify/cookie`                              |
| ì„¸ì…˜(ì„œë²„ ì„¸ì…˜)      | `express-session`    | `@fastify/secure-session` (ë˜ëŠ” ì™¸ë¶€ ì„¸ì…˜ë°±ì—”ë“œ/JWT ê¶Œì¥) |
| Passport (JWT) | `@nestjs/passport`   | ë™ì¼ (ë³€ê²½ ì—†ìŒ)                                     |
| Passport (ì„¸ì…˜)  | `express-session` ê¸°ë°˜ | FastifyëŠ” ë³„ë„ êµ¬ì„± í•„ìš”(ì„¸ì…˜ ë¯¸ë“¤ì›¨ì–´ ëŒ€ì²´)                  |

###### ë³€ê²½ ì „ (Express)

```ts
import * as cookieParser from 'cookie-parser';
import * as session from 'express-session';
// (ì„ íƒ) passport ì„¸ì…˜ ì¸ì¦
// import * as passport from 'passport';

const app = await NestFactory.create(AppModule);
app.use(cookieParser(process.env.COOKIE_SECRET));
app.use(
  session({
    secret: process.env.SESS_SECRET!,
    resave: false,
    saveUninitialized: false,
    cookie: { secure: false, httpOnly: true, maxAge: 3600_000 },
  }),
);
// app.use(passport.initialize());
// app.use(passport.session());
```

###### ë³€ê²½ í›„ (Fastify)

```ts
// ì¿ í‚¤
await app.register(import('@fastify/cookie'), { secret: process.env.COOKIE_SECRET });

// (ê¶Œì¥) JWT ì¸ì¦ì´ë©´ Nest Passport(JWT Strategy)ë§Œìœ¼ë¡œ ì¶©ë¶„, ì„¸ì…˜ ë¶ˆí•„ìš”.
// ì„¸ì…˜ í•„ìš” ì‹œ:
await app.register(import('@fastify/secure-session'), {
  key: Buffer.from(process.env.SECURE_SESSION_KEY!, 'hex'), // 32ë°”ì´íŠ¸ í‚¤(64-hex)
  cookie: { path: '/', httpOnly: true, maxAge: 3600_000 },
});

// Nestì˜ Passport(JWT)ëŠ” ê·¸ëŒ€ë¡œ ì‚¬ìš© ê°€ëŠ¥.
// ì„¸ì…˜ ê¸°ë°˜ PassportëŠ” fastify-passport ì¡°í•© ë˜ëŠ” ì»¤ìŠ¤í…€ ê°€ë“œ ì„¤ê³„ë¥¼ ê¶Œì¥.
```

> **ì‹¤ë¬´ íŒ:** Fastify ì „í™˜ ì‹œ **JWT ê¸°ë°˜ ë¬´ìƒíƒœ ì¸ì¦**ì´ ìœ ì§€Â·í™•ì¥ì´ ì‰¬ìš°ë©°,
> ì„¸ì…˜ ê¸°ë°˜ ì¸ì¦ì´ ê¼­ í•„ìš”í•˜ë‹¤ë©´ `fastify-passport` + `@fastify/secure-session` ì¡°í•©ì„ ì‹ ì¤‘íˆ êµ¬ì„±í•˜ì„¸ìš”.

---

##### 6) ì •ì  íŒŒì¼ ì œê³µ (Static)

###### ë³€ê²½ ì „ (Express)

```ts
import { join } from 'path';
import * as express from 'express';

const app = await NestFactory.create(AppModule);
app.use('/public', express.static(join(__dirname, '..', 'public')));
```

###### ë³€ê²½ í›„ (Fastify)

```ts
import { join } from 'path';

await app.register(import('@fastify/static'), {
  root: join(__dirname, '..', 'public'),
  prefix: '/public/', // ë°˜ë“œì‹œ ìŠ¬ë˜ì‹œë¡œ ì¢…ë£Œ
});
```

---

##### 7) ë¡œê¹… (morgan â†’ pino)

FastifyëŠ” ê¸°ë³¸ ë¡œê±°ê°€ **pino**ë¼ì„œ ê³ ì„±ëŠ¥ì…ë‹ˆë‹¤.

###### ë³€ê²½ ì „ (Express)

```ts
import * as morgan from 'morgan';

const app = await NestFactory.create(AppModule);
app.use(morgan('combined'));
```

###### ë³€ê²½ í›„ (Fastify + pino)

```ts
// 1) FastifyAdapter ìƒì„± ì‹œ ë¡œê±° ì˜µì…˜ ì§€ì •
const adapter = new FastifyAdapter({
  logger: {
    level: 'info',
    transport: process.env.NODE_ENV !== 'production'
      ? { target: 'pino-pretty', options: { singleLine: true } }
      : undefined,
  },
});
const app = await NestFactory.create<NestFastifyApplication>(AppModule, adapter);

// 2) ìš”ì²­ë³„ ì»¤ìŠ¤í…€ í›…ì—ì„œ ë¡œê¹…(ì„ íƒ)
app.getHttpAdapter().getInstance().addHook('onRequest', (req, _res, done) => {
  req.log.info({ url: req.url, method: req.method }, 'incoming request');
  done();
});
```

---

##### 8) ë ˆì´íŠ¸ ë¦¬ë¯¸íŠ¸ (ìš”ì²­ ì œí•œ)

###### ë³€ê²½ ì „ (Express)

```ts
import * as rateLimit from 'express-rate-limit';

const app = await NestFactory.create(AppModule);
app.use(rateLimit({ windowMs: 60_000, max: 100 }));
```

###### ë³€ê²½ í›„ (Fastify)

```ts
await app.register(import('@fastify/rate-limit'), {
  max: 100,
  timeWindow: '1 minute',
  // ban: 2, keyGenerator: (req) => req.ip
});
```

---

##### 9) CSRF ë³´í˜¸

###### ë³€ê²½ ì „ (Express)

```ts
import * as csurf from 'csurf';

const app = await NestFactory.create(AppModule);
app.use(csurf()); // ì¿ í‚¤/ì„¸ì…˜ ì¡°í•© í•„ìš”
```

###### ë³€ê²½ í›„ (Fastify)

```ts
await app.register(import('@fastify/csrf-protection'), {
  // cookie: { key: '_csrf', signed: true }, // ì¿ í‚¤ ê¸°ë°˜ ì‹œ ì˜µì…˜
});
```

> **ì£¼ì˜:** CSRFëŠ” ì£¼ë¡œ **ë¸Œë¼ìš°ì €-ì¿ í‚¤ ì„¸ì…˜** í™˜ê²½ì—ì„œ í•„ìš”í•©ë‹ˆë‹¤.
> **JWT + Bearer í† í°** ê¸°ë°˜ APIëŠ” ì¼ë°˜ì ìœ¼ë¡œ **CSRF ì˜í–¥ì´ ë‚®ìœ¼ë©°**, ëŒ€ì‹  CORSÂ·Origin ê²€ì¦ì„ ê°•í™”í•˜ì„¸ìš”.

---

##### 10) í”„ë¡ì‹œ ì‹ ë¢°(Real IP)

###### ë³€ê²½ ì „ (Express)

```ts
const app = await NestFactory.create(AppModule);
app.set('trust proxy', 1);
```

###### ë³€ê²½ í›„ (Fastify)

```ts
const adapter = new FastifyAdapter({ trustProxy: true });
const app = await NestFactory.create<NestFastifyApplication>(AppModule, adapter);
```

---

##### 11) ê³µí†µ Nest ì„¤ì • (ë³€ê²½ ì—†ìŒ)

ì•„ë˜ í•­ëª©ë“¤ì€ **í”Œë«í¼ê³¼ ë¬´ê´€**í•˜ê²Œ ë™ì¼í•˜ê²Œ ë™ì‘í•©ë‹ˆë‹¤.

```ts
// ì „ì—­ í”„ë¦¬í”½ìŠ¤
app.setGlobalPrefix('api');

// ì „ì—­ íŒŒì´í”„(ValidationPipe)
import { ValidationPipe } from '@nestjs/common';
app.useGlobalPipes(new ValidationPipe({ whitelist: true, transform: true }));

// ì „ì—­ ì¸í„°ì…‰í„°/í•„í„°
// app.useGlobalInterceptors(new ClassSerializerInterceptor(...));
// app.useGlobalFilters(new AllExceptionsFilter(...));
```

---

##### 12) Express ì „ìš© ê´€ìš©êµ¬ ëŒ€ì²´ (locals ë“±)

**Expressì˜ `res.locals`**ëŠ” Fastifyì— ì—†ìŠµë‹ˆë‹¤. ëŒ€ì²´ ë°©ë²•:

##### ë³€ê²½ ì „ (Express)

```ts
app.use((req, res, next) => {
  res.locals.requestId = req.headers['x-request-id'];
  next();
});
```

##### ë³€ê²½ í›„ (Fastify)

```ts
// ìš”ì²­/ì‘ë‹µì— ì»¤ìŠ¤í…€ ì†ì„± ë°ì½”ë ˆì´ì…˜
const f = app.getHttpAdapter().getInstance();
f.decorateRequest('requestId', null);

f.addHook('onRequest', (req, _reply, done) => {
  (req as any).requestId = req.headers['x-request-id'] ?? crypto.randomUUID();
  done();
});

// ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì‚¬ìš©
// @Req() req: FastifyRequest & { requestId?: string }
```

---

##### 13) ì—…ë¡œë“œ(ë©€í„° â†’ multipart) ì»¨íŠ¸ë¡¤ëŸ¬ ì˜ˆì‹œ

##### ë³€ê²½ ì „ (Express + multer + FileInterceptor)

```ts
@Post('upload')
@UseInterceptors(FileInterceptor('file'))
upload(@UploadedFile() file: Express.Multer.File) {
  return { filename: file.originalname, size: file.size };
}
```

##### ë³€ê²½ í›„ (Fastify + @fastify/multipart)

```ts
import { FastifyRequest } from 'fastify';

@Post('upload')
async upload(@Req() req: FastifyRequest) {
  const data = await req.file(); // ë‹¨ì¼ íŒŒì¼
  if (!data) throw new BadRequestException('file is required');
  const buffer = await data.toBuffer();
  return { filename: data.filename, size: buffer.length, mimetype: data.mimetype };
}
```

> ì—¬ëŸ¬ íŒŒì¼ì€ `for await (const part of request.parts())` í˜•íƒœë¡œ ì²˜ë¦¬í•˜ì„¸ìš”.

---


