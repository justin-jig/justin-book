---
title: "React v18 정리"
date: 2025-10-16
---

## React 18 주요 변경사항 정리 

####  요약 표

| 범주         | 주요 변경점                                     | 관련 API / 특징              |
| ---------- | ------------------------------------------ | ------------------------ |
| 렌더링        | **Concurrent Rendering**                   | interruptible render     |
| 성능         | **Automatic Batching**                     | fewer re-renders         |
| 서버         | **Streaming SSR, Selective Hydration**     | `renderToPipeableStream` |
| 신규 훅       | **useId, useTransition, useDeferredValue** | Suspense와 연계             |
| DOM API    | `createRoot`, `hydrateRoot`                | 기존 render 제거             |
| StrictMode | 마운트 2회 실행                                  | side effect 검증           |

---


### 1️⃣ Automatic Batching (자동 배칭)

* React 18 이전: 이벤트 핸들러 내부에서만 배칭 (예: `onClick`, `onChange`)
* React 18 이후: **Promise, setTimeout, native event 등 비동기 컨텍스트에서도 자동 배칭 적용**
* `ReactDOM.flushSync()`를 사용하면 배칭을 **강제로 해제 가능**

```js
flushSync(() => setCount(c => c + 1)); // 즉시 렌더링
```
---

### 2️⃣ Concurrent Rendering (동시성 렌더링)

> 🔹 React 18의 “핵심 개념”

* React는 이제 **Concurrent Mode**를 **기본 포함**함 (별도의 모드 스위치 없이)
* 이전에는 “blocking render” 방식 → 이제는 “interruptible rendering”
* React가 “UI 업데이트 우선순위”를 스스로 조절 가능
  (예: 긴 렌더 중간에 유저 입력 이벤트가 오면 그걸 먼저 처리함)

📘 관련 API:

* `startTransition()`, `useTransition()` : 낮은 우선순위 업데이트 처리
* `useDeferredValue()` : 비동기 데이터 지연 처리
* `useSyncExternalStore()` : 외부 상태와 동기화

---

### 3️⃣ Suspense on the Server (서버 사이드 스트리밍)

>  React 18에서 **Streaming SSR**과 **Selective Hydration**이 도입

#### 📦 주요 변화

* **Streaming HTML**: 데이터 준비된 컴포넌트부터 순차적으로 전송
* **Selective Hydration**: JS 로딩이 끝난 컴포넌트부터 점진적으로 활성화
* React DOM 서버 API 변경:

  ```js
  import { renderToPipeableStream } from 'react-dom/server';
  ```

  (기존 `renderToString`보다 스트리밍 기반)

---

### 4️⃣ 새로운 Hooks / API

| API                      | 설명                                      |
| ------------------------ | --------------------------------------- |
| **startTransition**      | 긴 렌더링 작업을 낮은 우선순위로 실행                   |
| **useTransition**        | 비동기 상태 업데이트를 트리거하고 로딩 상태 관리             |
| **useDeferredValue**     | 입력 값 업데이트를 지연시켜 렌더 성능 향상                |
| **useId**                | 서버/클라이언트 일관된 고유 ID 생성 (Hydration 오류 방지) |
| **useSyncExternalStore** | 외부 store와 안전하게 동기화 (예: Redux, Zustand)  |
| **useInsertionEffect**   | CSS-in-JS 라이브러리용 새로운 훅 (렌더 전 DOM 삽입용)   |

---

### 5️⃣ React DOM API 변경

| 기존                      | 변경 후                  |
| ----------------------- | --------------------- |
| `ReactDOM.render()`     | ❌ 제거됨                 |
| `ReactDOM.createRoot()` | ✅ 신규 도입               |
| `ReactDOM.hydrate()`    | → `hydrateRoot()`로 변경 |

---

### 6️⃣ Strict Mode 개선

* React 18의 `StrictMode`는 **컴포넌트 마운트/언마운트를 2번 수행**
* 이유: “side-effect 없는 컴포넌트” 검증 (Concurrent Render 대응)

---

### 7️⃣ 기타: Transition + Suspense 통합

* Suspense와 `startTransition()` 조합으로
  “로딩 중 UI”와 “완료 후 UI”를 자연스럽게 전환 가능.

```js
const [isPending, startTransition] = useTransition();

function handleInputChange(e) {
  startTransition(() => setQuery(e.target.value));
}
```

---