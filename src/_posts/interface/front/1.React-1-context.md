---
title: "React context api"
date: 2025-10-16
---



# 1) Context API í•µì‹¬ ì •ë¦¬

ì»´í¬ë„ŒíŠ¸ íŠ¸ë¦¬ ì „ì²´ì— ê±¸ì³ ì „ì—­ì ì¸ ë°ì´í„°ë¥¼ ê³µìœ í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ê¸°ëŠ¥ì„
 prop drilling ë¬¸ì œë¥¼ í•´ì†Œí•  ìˆ˜ ìˆìŒ.

* **ë¬´ì—‡?** ì»´í¬ë„ŒíŠ¸ íŠ¸ë¦¬ ì „ì²´ì— ê±¸ì³ ì „ì—­ ë°ì´í„°(ìƒíƒœ/ì•¡ì…˜)ë¥¼ **prop drilling ì—†ì´** ì „ë‹¬í•˜ëŠ” ë©”ì»¤ë‹ˆì¦˜.
* **ì™œ?** í•˜ìœ„ ë‹¨ê³„ê°€ ê¹Šì–´ì§ˆìˆ˜ë¡ props ì „ë‹¬ì´ ë³µì¡í•´ì§€ëŠ” ë¬¸ì œ(prop drilling)ë¥¼ í•´ê²°.
* **ì–´ë–»ê²Œ?**

  1. `createContext`ë¡œ ì»¨í…ìŠ¤íŠ¸ ìƒì„±
  2. `Provider`ì—ì„œ ê°’(value) ê³µê¸‰
  3. í•˜ìœ„ì—ì„œ `useContext`ë¡œ ì†Œë¹„


### prop drilling 
Reactì—ì„œ ë°ì´í„°ë¥¼ ì—¬ë¡œ ì»´í¬ë„ŒíŠ¸ ê³„ì¸µì„ í†µí•´ ì „ë‹¬í•˜ëŠ” ê³¼ì •ì„ ì˜ë¯¸
(í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ê°€ ë§ì•„ì§ˆìˆ˜ë¡ ë°ì´í„°ë¥¼ ì „ë‹¬í•˜ëŠ” ì½”ë“œê°€ ë³µì¡ í•´ì ¸ì„œ ë³µì¡ì„±ì´ ì¦ê°€í•¨)

##### Flow
Context ìƒì„±: createContext í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ contextë¥¼ ìƒì„±.
Provider: ìƒì„±í•œ contextì˜ Provider ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ë“¤ì—ê²Œ ë°ì´í„°ë¥¼ ì „ë‹¬.
Consumer: Consumer ì»´í¬ë„ŒíŠ¸ ë˜ëŠ” useContext í›…ì„ ì‚¬ìš©í•˜ì—¬ contextì˜ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜´. 

### State Reducer
   Reactì—ì„œ ìƒíƒœ ê´€ë¦¬ ë¡œì§ì´ ë³µì¡í•´ì§ˆ ë•Œ ìœ ìš©í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë„êµ¬
   Stateë¥¼ ì—…ë°ì´íŠ¸ í•˜ëŠ” ëª¨ë“  ë¡œì§ì„ reducerë¥¼ ì‚¬ìš©í•˜ì—¬ ì»´í¬ë„ŒíŠ¸ ì™¸ë¶€ ë‹¨ì¼ í•¨ìˆ˜ë¡œ í†µí•©í•´ ê´€ë¦¬ê°€ ê°€ëŠ¥í•˜ë‹¤.
 
##### Flow
Reducer í•¨ìˆ˜: í˜„ì¬ ìƒíƒœì™€ ì•¡ì…˜ ê°ì²´ë¥¼ ë°›ì•„ ìƒˆë¡œìš´ ìƒíƒœë¥¼ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ 
Action ê°ì²´: ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•˜ê¸° ìœ„í•œ ì •ë³´ë¥¼ ë‹´ê³  ìˆëŠ” ê°ì²´. 
Dispatch í•¨ìˆ˜: ì•¡ì…˜ ê°ì²´ë¥¼ ë¦¬ë“€ì„œ í•¨ìˆ˜ì— ì „ë‹¬í•˜ëŠ” í•¨ìˆ˜.


---

# 2) êµ¬í˜„ Data Flow & í´ë” êµ¬ì¡°

```
src/
â”œâ”€â”€ datafetchs/                  # âœ… HTTP í†µì‹ (API í˜¸ì¶œ) ëª¨ë“ˆ
â”‚   â””â”€â”€ daemonsets.api.ts
â”œâ”€â”€ store/                       # âœ… ì „ì—­/ìµœìƒìœ„ ìƒíƒœê´€ë¦¬
â”‚   â”œâ”€â”€ contexts/
â”‚   â”‚   â”œâ”€â”€ monitoring/
â”‚   â”‚   â”‚   â”œâ”€â”€ daemonsets.context.tsx   # Context + Provider
â”‚   â”‚   â”‚   â””â”€â”€ daemonsets.reducer.ts    # Reducer + Action ì •ì˜
â”‚   â””â”€â”€ hooks/
â”‚       â””â”€â”€ useDaemonSets.ts            # Custom Hook (selector/ì•¡ì…˜ ë˜í•‘)
â”œâ”€â”€ pages/
â”‚   â””â”€â”€ monitoring/
â”‚       â”œâ”€â”€ DaemonSetsPage.tsx          # ë¦¬ìŠ¤íŠ¸ í™”ë©´ (Control Props ì§€ì›)
â”‚       â””â”€â”€ DaemonSetsPodPage.tsx       # ìƒì„¸/Pod í™”ë©´
â””â”€â”€ app/
    â””â”€â”€ routes.tsx                      # ë¼ìš°íŒ…(Provider ë°°ì¹˜, Outlet)
```

**ë°ì´í„° íë¦„(Flux-like ë‹¨ë°©í–¥)**
`Component(Event) â†’ dispatch(Action) â†’ reducer(State ë³€ê²½) â†’ Context value ì—…ë°ì´íŠ¸ â†’ UI ë Œë”`

---

# 3) êµ¬í˜„ ì˜ˆì‹œ

## 3-1. datafetchs (API í˜¸ì¶œ)

```ts
// src/datafetchs/daemonsets.api.ts
import axios from "axios";

export interface DaemonSetItem {
  Name: string;
  Namespace: string;
  // ...í•„ìš” í•„ë“œë“¤
}

export const getAllDaemonSets = async (): Promise<DaemonSetItem[]> => {
  const { data } = await axios.get("/api/daemonsets");
  return data;
};

export const downloadDaemonSet = async (ns: string, name: string) => {
  const { data } = await axios.get(`/api/daemonsets/${ns}/${name}/download`, {
    responseType: "blob",
  });
  return data;
};

export const deleteDaemonSet = async (ns: string, name: string) => {
  await axios.delete(`/api/daemonsets/${ns}/${name}`);
};
```

---

## 3-2. Reducer + Actions

```ts
// src/store/contexts/monitoring/daemonsets.reducer.ts
import { DaemonSetItem } from "@/datafetchs/daemonsets.api";

export type DaemonSetsState = {
  list: DaemonSetItem[];
  loading: boolean;
  error?: string | null;
};

export const initialDaemonSetsState: DaemonSetsState = {
  list: [],
  loading: false,
  error: null,
};

export type DaemonSetsAction =
  | { type: "GET_ALL_REQUEST" }
  | { type: "GET_ALL_SUCCESS"; payload: DaemonSetItem[] }
  | { type: "GET_ALL_FAILURE"; payload: string }
  | { type: "DELETE_SUCCESS"; payload: { Namespace: string; Name: string } };

export function daemonSetsReducer(
  state: DaemonSetsState,
  action: DaemonSetsAction
): DaemonSetsState {
  switch (action.type) {
    case "GET_ALL_REQUEST":
      return { ...state, loading: true, error: null };
    case "GET_ALL_SUCCESS":
      return { ...state, loading: false, list: action.payload };
    case "GET_ALL_FAILURE":
      return { ...state, loading: false, error: action.payload };
    case "DELETE_SUCCESS": {
      const { Namespace, Name } = action.payload;
      return {
        ...state,
        list: state.list.filter(
          (d) => !(d.Namespace === Namespace && d.Name === Name)
        ),
      };
    }
    default:
      return state;
  }
}
```

---

## 3-3. Context + Provider (State Reducer + Context API)

```tsx
// src/store/contexts/monitoring/daemonsets.context.tsx
import {
  createContext,
  useContext,
  useEffect,
  useReducer,
  ReactNode,
  useCallback,
} from "react";
import {
  daemonSetsReducer,
  initialDaemonSetsState,
  DaemonSetsAction,
  DaemonSetsState,
} from "./daemonsets.reducer";
import {
  getAllDaemonSets,
  deleteDaemonSet,
  downloadDaemonSet,
} from "@/datafetchs/daemonsets.api";

type DaemonSetsContextValue = {
  state: DaemonSetsState;
  dispatch: React.Dispatch<DaemonSetsAction>;
  actions: {
    refresh: () => Promise<void>;
    download: (ns: string, name: string) => Promise<void>;
    remove: (ns: string, name: string) => Promise<void>;
  };
};

const DaemonSetsContext = createContext<DaemonSetsContextValue | null>(null);

export const DaemonSetsProvider = ({ children }: { children: ReactNode }) => {
  const [state, dispatch] = useReducer(daemonSetsReducer, initialDaemonSetsState);

  const refresh = useCallback(async () => {
    dispatch({ type: "GET_ALL_REQUEST" });
    try {
      const list = await getAllDaemonSets();
      dispatch({ type: "GET_ALL_SUCCESS", payload: list });
    } catch (e: any) {
      dispatch({ type: "GET_ALL_FAILURE", payload: e?.message ?? "error" });
    }
  }, []);

  const download = useCallback(async (ns: string, name: string) => {
    await downloadDaemonSet(ns, name);
    // í•„ìš”ì‹œ íŒŒì¼ ì €ì¥ ì²˜ë¦¬(FileSaver ë“±)
  }, []);

  const remove = useCallback(async (ns: string, name: string) => {
    await deleteDaemonSet(ns, name);
    dispatch({ type: "DELETE_SUCCESS", payload: { Namespace: ns, Name: name } });
  }, []);

  useEffect(() => {
    // ì²« ë Œë” ì‹œ ì „ì²´ ì¡°íšŒ
    refresh();
  }, [refresh]);

  return (
    <DaemonSetsContext.Provider
      value={{ state, dispatch, actions: { refresh, download, remove } }}
    >
      {children}
    </DaemonSetsContext.Provider>
  );
};

export const useDaemonSetsContext = () => {
  const ctx = useContext(DaemonSetsContext);
  if (!ctx) throw new Error("useDaemonSetsContext must be used within Provider");
  return ctx;
};
```

---

## 3-4. Custom Hook (Selector/ì•¡ì…˜ ë¬¶ê¸°)

```ts
// src/store/hooks/useDaemonSets.ts
import { useMemo } from "react";
import { useDaemonSetsContext } from "../contexts/monitoring/daemonsets.context";

export const useDaemonSets = () => {
  const { state, actions } = useDaemonSetsContext();
  const { list, loading, error } = state;

  const namespaceMap = useMemo(() => {
    const m = new Map<string, number>();
    list.forEach((d) => m.set(d.Namespace, (m.get(d.Namespace) ?? 0) + 1));
    return m;
  }, [list]);

  return { list, loading, error, namespaceMap, ...actions };
};
```

---

## 3-5. Page ì»´í¬ë„ŒíŠ¸ (Control Props + Context ì†Œë¹„)

> **Control Props**: ë¶€ëª¨ê°€ `namespace`, `daemonSet` ë“±ì„ **ì™¸ë¶€ì—ì„œ ì œì–´**í•  ìˆ˜ë„ ìˆê³ , ì „ë‹¬ì´ ì—†ìœ¼ë©´ **ë‚´ë¶€ ìƒíƒœ/ì»¨í…ìŠ¤íŠ¸**ë¡œ ë™ì‘.

```tsx
// src/pages/monitoring/DaemonSetsPage.tsx
import { useMemo, useState } from "react";
import { useDaemonSets } from "@/store/hooks/useDaemonSets";

type Props = {
  namespace?: string;              // ğŸ”¸ ì™¸ë¶€ ì œì–´(Controlled) ê°€ëŠ¥
  onSelectChange?: (ns: string) => void; // ğŸ”¸ ì™¸ë¶€ ì œì–´ ì½œë°±
};

export default function DaemonSetsPage({ namespace, onSelectChange }: Props) {
  const { list, loading, error, remove, download } = useDaemonSets();

  // ë‚´ë¶€ ìƒíƒœ(ì–¸ì»¨íŠ¸ë¡¤ë“œ). ì™¸ë¶€ propsê°€ ì˜¤ë©´ ê·¸ ê°’ì„ ìš°ì„  ì‚¬ìš©.
  const [innerNs, setInnerNs] = useState<string>("default");
  const effectiveNs = namespace ?? innerNs;

  const filtered = useMemo(
    () => list.filter((d) => (effectiveNs ? d.Namespace === effectiveNs : true)),
    [list, effectiveNs]
  );

  const handleChangeNs = (ns: string) => {
    if (onSelectChange) onSelectChange(ns);
    else setInnerNs(ns);
  };

  if (loading) return <div>Loadingâ€¦</div>;
  if (error) return <div style={{ color: "red" }}>{error}</div>;

  return (
    <div>
      <h2>DaemonSets ({effectiveNs || "All"})</h2>

      <select
        value={effectiveNs}
        onChange={(e) => handleChangeNs(e.target.value)}
      >
        <option value="default">default</option>
        <option value="kube-system">kube-system</option>
        {/* í•„ìš”ì‹œ ë™ì  namespace ëª©ë¡ìœ¼ë¡œ ëŒ€ì²´ */}
      </select>

      <ul style={{ marginTop: 12 }}>
        {filtered.map((d) => (
          <li key={`${d.Namespace}:${d.Name}`}>
            {d.Namespace}/{d.Name}
            <button onClick={() => download(d.Namespace, d.Name)}>download</button>
            <button onClick={() => remove(d.Namespace, d.Name)}>delete</button>
          </li>
        ))}
      </ul>
    </div>
  );
}
```

---

## 3-6. ë¼ìš°íŒ… + Provider ë°°ì¹˜ (Outlet íŒ¨í„´)

```tsx
// src/app/routes.tsx
import { Outlet } from "react-router-dom";
import { DaemonSetsProvider } from "@/store/contexts/monitoring/daemonsets.context";
import AdminLayout from "@/layouts/AdminLayout";

export default function ProtectedAdmin() {
  return (
    <DaemonSetsProvider>
      <AdminLayout>
        <Outlet />
      </AdminLayout>
    </DaemonSetsProvider>
  );
}
```

---

## 3-7. ë¼ìš°íŠ¸ íŒŒë¼ë¯¸í„°ë¥¼ Control Propsë¡œ ì£¼ì…

```tsx
// src/pages/monitoring/DaemonSetsPageWithContext.tsx
import { useParams } from "react-router-dom";
import DaemonSetsPage from "./DaemonSetsPage";
import DaemonSetsPodPage from "./DaemonSetsPodPage";

export default function DaemonSetsPageWithContext() {
  const { namespace, daemonSet } = useParams(); // /:namespace?/:daemonSet?

  if (daemonSet) {
    // ğŸ”¸ ìƒì„¸ í™”ë©´ (Pod í˜ì´ì§€)
    return (
      <DaemonSetsPodPage
        namespace={namespace!}
        daemonSet={daemonSet}
      />
    );
  }

  // ğŸ”¸ ë¦¬ìŠ¤íŠ¸ í™”ë©´ (namespaceë¥¼ Control Propsë¡œ ì£¼ì…)
  return <DaemonSetsPage namespace={namespace} />;
}
```

---

# 4) ì¡°í•© ì „ëµ: **Control Props + (State Reducer + Context API + Custom Hook)**

* **State Reducer**: ìƒíƒœ ì „í™˜/ì—…ë°ì´íŠ¸ ë¡œì§ì„ í•œê³³(reducer)ìœ¼ë¡œ ëª¨ì•„ **ì˜ˆì¸¡ ê°€ëŠ¥**í•˜ê³  **í…ŒìŠ¤íŠ¸ ê°€ëŠ¥í•œ** ìƒíƒœ ê´€ë¦¬
* **Context API**: í•´ë‹¹ reducerì˜ ìƒíƒœì™€ ì•¡ì…˜ì„ **íŠ¸ë¦¬ ì „ì²´ì— ê³µê¸‰**
* **Custom Hook**: `useDaemonSets`ë¡œ **ì„ íƒì/ì•¡ì…˜**ì„ ìº¡ìŠí™” â†’ ì»´í¬ë„ŒíŠ¸ëŠ” ê¹”ë”í•´ì§
* **Control Props**: ë¼ìš°íŠ¸/ìƒìœ„ í™”ë©´ì—ì„œ `namespace`, `daemonSet` ë“± **ì™¸ë¶€ ì œì–´**ê°€ í•„ìš”í•  ë•Œ propsë¡œ ì£¼ì…, ì—†ìœ¼ë©´ ë‚´ë¶€ ìƒíƒœë¡œ ë™ì‘(ì–‘ëª¨ë“œ ì§€ì›)

> ê²°ê³¼ì ìœ¼ë¡œ, **í˜ì´ì§€ ì¬ì‚¬ìš©ì„±**(Control Props) + **ìƒíƒœ ì¼ê´€ì„±**(Reducer/Context) + **ì½”ë“œ ì‘ì§‘ë„**(Custom Hook) ë¥¼ ë™ì‹œì— ë‹¬ì„±í•©ë‹ˆë‹¤.

---

## ì¶”ê°€ íŒ (í˜„ì¬ ì½”ë“œì— ë°”ë¡œ ë°˜ì˜í•˜ê¸° ì¢‹ì€ ê²ƒë“¤)

* `dispatch({ type: "GET_ALL_DAEMONSETS" })` ê°™ì€ í•˜ë“œì½”ë”© ë¬¸ìì—´ â†’ **Action íƒ€ì… ìƒìˆ˜/ìœ ë‹ˆì˜¨**ìœ¼ë¡œ ì „í™˜ (ìœ„ ì˜ˆì‹œì²˜ëŸ¼)
* ë¼ìš°íŠ¸ ë¶„ê¸°(`DaemonSetsPage` vs `DaemonSetsPodPage`)ëŠ” **`useParams`ë¥¼ Control Propsì— ì—°ê²°**í•˜ëŠ” ë°©ì‹ì´ ê°€ì¥ ê¹”ë”
* ì‚­ì œ/ë‹¤ìš´ë¡œë“œ ì•¡ì…˜ì€ **Providerì— ëª¨ì•„ë‘ê³ ** ì»´í¬ë„ŒíŠ¸ì—ì„œëŠ” `actions.remove / actions.download`ë§Œ í˜¸ì¶œ
* ë¹„ë™ê¸° ì¤‘ë³µ í˜¸ì¶œ ë°©ì§€: `refresh` í˜¸ì¶œ ìœ„ì¹˜(ë§ˆìš´íŠ¸ 1íšŒ)ì™€ ë²„íŠ¼ ì¬ìš”ì²­ í”Œë˜ê·¸(ì„ íƒ)ë¥¼ êµ¬ë¶„
---
