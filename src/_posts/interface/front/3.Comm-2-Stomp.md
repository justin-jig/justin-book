---
title: "Communication  stomp"
date: 2025-10-16
---

# STOMP (Simple Text Oriented Messaging Protocol)

## 1. 개요

**STOMP**는 *Simple Text Oriented Messaging Protocol*의 약자로,
**클라이언트와 서버 간 메시지를 효율적으로 교환하기 위한 텍스트 기반 메시징 프로토콜**이다.

웹소켓(WebSocket)과 함께 사용하여, **pub/sub(발행/구독)** 구조의 실시간 통신을 간단하게 구현할 수 있다.

---

## 2. 주요 특징


![alt text](/justin-book/images/front/2stomp.png)


| 구분          | 설명                                           |
| ----------- | -------------------------------------------- |
| **프로토콜 성격** | 텍스트 기반 프로토콜 (메시지를 텍스트 형태로만 전송)               |
| **통신 방식**   | Publish / Subscribe 기반                       |
| **구조**      | 발행자(Publisher), 구독자(Subscriber), 브로커(Broker) |
| **표준성**     | 메시지 형식과 처리 규칙을 명확히 정의 (명령어 기반)               |
| **효율성**     | WebSocket 위에서 동작하여 실시간 양방향 통신 가능             |
| **유연성**     | 특정 사용자 또는 특정 Topic에 메시지를 전송 가능               |

> 💬 **즉**, WebSocket은 “통로”, STOMP는 “메시지 규칙”이라 보면 이해하기 쉽다.
> STOMP는 WebSocket 위에서 메시지의 형식과 라우팅 방식을 정의한다.

---

## 3. STOMP 메시지 구조

STOMP 메시지는 세 부분으로 구성된다.

```
COMMAND
header1:value1
header2:value2

Body^@
```

| 구성요소          | 설명                                                  |
| ------------- | --------------------------------------------------- |
| **COMMAND**   | 수행할 명령 (예: CONNECT, SEND, SUBSCRIBE, UNSUBSCRIBE 등) |
| **Headers**   | key:value 형태의 부가 정보 (라우팅, 인증 등)                     |
| **Body**      | 실제 전송할 메시지 내용 (텍스트 형식)                              |
| **^@ (NULL)** | 메시지의 끝을 나타내는 제어 문자                                  |

---

## 4. 주요 STOMP 명령어

| 명령어                         | 역할                           |
| --------------------------- | ---------------------------- |
| **CONNECT / DISCONNECT**    | 서버와의 연결/종료                   |
| **SEND**                    | 메시지 발행 (Publisher → Broker)  |
| **SUBSCRIBE / UNSUBSCRIBE** | 특정 Topic(큐)에 구독/해제           |
| **MESSAGE**                 | Broker가 Subscriber에게 보내는 메시지 |
| **ERROR**                   | 오류 발생 시 서버에서 클라이언트로 전송       |

---

## 5. STOMP 구현 예제 (Node.js + JavaScript)

### 📦 라이브러리 설치

```bash
npm install @stomp/stompjs
```

---

### ✅ STOMP 클라이언트 생성

```javascript
import * as StompJs from '@stomp/stompjs';

// STOMP 클라이언트 객체 생성
const client = new StompJs.Client({
  brokerURL: 'ws://localhost:15674/ws', // STOMP 서버 URL (예: RabbitMQ WebSocket)
  connectHeaders: {
    login: 'user',          // 로그인 ID
    passcode: 'password',   // 로그인 PW
  },
  reconnectDelay: 5000,       // 재연결 시도 간격(ms)
  heartbeatIncoming: 4000,    // 서버 → 클라이언트 heartbeat 주기
  heartbeatOutgoing: 4000,    // 클라이언트 → 서버 heartbeat 주기
});

// 연결 성공 시 콜백
client.onConnect = function (frame) {
  console.log('✅ STOMP 연결 성공:', frame);
};

// 오류 발생 시 콜백
client.onStompError = function (frame) {
  console.error('❌ STOMP 에러:', frame.headers['message']);
  console.error('세부 내용:', frame.body);
};

// 연결 시작
client.activate();
```

---

### ✉️ 메시지 발행 (Publish)

```javascript
client.publish({
  destination: '/topic/general',   // 메시지를 보낼 대상(topic 또는 queue)
  body: 'Hello world!',            // 메시지 본문
  headers: { priority: '9' },      // 추가 헤더 설정
  skipContentLengthHeader: true    // Content-Length 헤더 생략 옵션
});
```

---

### 📩 메시지 구독 (Subscribe)

```javascript
// 특정 Queue 또는 Topic 구독
const subscription = client.subscribe('/queue/test', (message) => {
  console.log('📨 받은 메시지:', message.body);
});
```

> 구독 후에는 서버에서 `/queue/test` 또는 `/topic/test`로 발행된 메시지를 실시간으로 수신할 수 있다.

---

### 🔌 연결 종료

```javascript
client.deactivate();
console.log('🔴 STOMP 연결 해제 완료');
```

---

## 6. STOMP 통신 구조 요약

```text
┌────────────┐      ┌────────────┐      ┌──────────────┐
│ Publisher  │ ---> │  Broker    │ ---> │  Subscriber  │
│ (Client)   │      │ (Server)   │      │ (Client)     │
└────────────┘      └────────────┘      └──────────────┘
         ▲                  │
         └── WebSocket/STOMP 프로토콜 기반 ────┘
```

* **Broker**: 메시지를 전달 중개 (RabbitMQ, ActiveMQ 등)
* **Publisher**: 메시지 발행 (`SEND`)
* **Subscriber**: 메시지 구독 (`SUBSCRIBE`)
* **통신 프로토콜**: WebSocket + STOMP 조합으로 실시간 메시징 처리

---

---

## 7. WebSocket과의 비교

| 항목          | **WebSocket**                | **STOMP (on WebSocket)**         |
| ----------- | ---------------------------- | -------------------------------- |
| **역할**      | 네트워크 통신 채널 (Transport Layer) | 메시지 규격/형식 정의 (Application Layer) |
| **기반 계층**   | TCP 기반 (HTTP Upgrade로 전환)    | WebSocket 기반 (프로토콜 상위)           |
| **메시지 형식**  | 이진 또는 텍스트 자유형식               | Command + Header + Body 구조       |
| **통신 방식**   | 단순 양방향 통신                    | Pub/Sub 구조 (Topic 기반)            |
| **메시지 라우팅** | 직접 송수신                       | Broker를 통한 분배                    |
| **사용 목적**   | 실시간 데이터 스트림 (게임, 채팅 등)       | 메시징 시스템 (알림, 채팅, IoT)            |
| **예시 포트**   | ws:// (80), wss:// (443)     | ws:// + Broker 포트 (예: 15674)     |

> ✅ **요약**
>
> * WebSocket은 "통로"
> * STOMP는 "그 통로 위의 메시지 형식"
> * 즉, STOMP는 WebSocket을 활용해 **메시지 구조화 + 라우팅 기능**을 제공한다.

---

## ✅ 요약 정리

| 구분           | 내용                                              |
| ------------ | ----------------------------------------------- |
| **이름**       | STOMP (Simple Text Oriented Messaging Protocol) |
| **기반**       | WebSocket 기반 텍스트 메시징 프로토콜                       |
| **특징**       | PUB/SUB 구조, 텍스트 전송, 메시지 브로커 기반                  |
| **핵심 명령어**   | CONNECT, SEND, SUBSCRIBE, MESSAGE, ERROR        |
| **주요 라이브러리** | @stomp/stompjs (JavaScript/Node.js)             |
| **사용 사례**    | 실시간 알림, 채팅, 센서 데이터, IoT 메시징, 대시보드 업데이트 등        |

---
