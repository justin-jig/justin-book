---
title: "websocket"
date: 2025-10-16
---

### 다음은 **Socket 통신과 WebSocket**을 한눈에 이해할 수 있도록 정리한 내용입니다.
(기초 개념 → 동작 원리 → 비교 → 실습 예제 순서로 구성됨)

## ✅ 요약

| 구분     | Socket            | WebSocket                  |
| ------ | ----------------- | -------------------------- |
| 계층     | 전송 계층 (TCP/UDP)   | 애플리케이션 계층                  |
| 연결 방식  | TCP/UDP 기반        | HTTP 기반 (Upgrade로 전환)      |
| 통신 형태  | 1:1 통신 중심         | 양방향 실시간 통신                 |
| 특징     | 신뢰성(TCP), 속도(UDP) | 지속 연결, 이벤트 기반 통신           |
| 주요 사용처 | 파일전송, 스트리밍, IoT   | 채팅, 알림, 게임, 주식시세, 실시간 모니터링 |

---


# Socket 통신 & WebSocket 정리

## 1. Socket 통신 개요

**소켓(Socket)** 은 네트워크 상에서 **두 프로그램 간의 양방향 통신을 가능하게 하는 기술**이다.
클라이언트와 서버가 **IP 주소 + 포트 번호**를 통해 연결되어, **실시간 데이터 송수신**을 수행한다.


### 🔹 주요 특징

* 양방향 통신 (Full Duplex)
* IP와 Port를 결합한 유일한 식별자 사용
* TCP / UDP 기반의 네트워크 통신
* 연결이 유지되는 동안 지속적인 데이터 교환 가능

| 구분       | 설명                             |
| -------- | ------------------------------ |
| **IP**   | 네트워크 상의 장치를 식별하는 고유 주소         |
| **PORT** | 한 장치 내에서 실행 중인 애플리케이션을 구분하는 번호 |

#### 포트 번호 구분

| 구분       | 범위          | 예시                                     |
| -------- | ----------- | -------------------------------------- |
| 잘 알려진 포트 | 0~1023      | HTTP(80), HTTPS(443), SSH(22), FTP(21) |
| 등록된 포트   | 1024~49151  | 특정 애플리케이션 전용                           |
| 동적/사설 포트 | 49152~65535 | 임시 포트 (주로 클라이언트 측 사용)                  |

---

## 2. Socket의 종류

| 종류                       | 설명                      | 사용 사례            |
| ------------------------ | ----------------------- | ---------------- |
| **TCP(Socket Stream)**   | 연결 지향, 신뢰성 보장, 순서 보장    | HTTP, 이메일, 파일 전송 |
| **UDP(Datagram Socket)** | 비연결형, 손실 가능, 순서 미보장, 빠름 | 스트리밍, 게임, VoIP   |

| 비교 항목 | TCP       | UDP          |
| ----- | --------- | ------------ |
| 연결 방식 | 연결 지향형    | 비연결형         |
| 신뢰성   | 높음        | 낮음           |
| 순서 보장 | 있음        | 없음           |
| 속도    | 느림        | 빠름           |
| 대표 사례 | HTTP, FTP | 실시간 스트리밍, 게임 |

---

## 3. Socket 통신 동작 원리

![alt text](/justin-book/images/front/1websocket.png)

1. **소켓 생성 (`socket()`)**
   → 네트워크 통신의 종단점 생성

2. **바인딩 (`bind()`)**
   → 서버 소켓을 특정 IP/포트에 연결

3. **대기 (`listen()`)**
   → 클라이언트의 연결 요청을 기다림

4. **연결 수락 (`accept()`)**
   → 클라이언트 요청을 받아 새로운 소켓 생성

5. **연결 요청 (`connect()`)**
   → 클라이언트가 서버에 연결 요청

6. **데이터 송수신 (`send()`, `recv()`)**
   → 연결된 소켓을 통해 데이터 주고받기

7. **연결 종료 (`close()`)**
   → 소켓을 닫고 통신 종료

---

## 4. WebSocket 개요

**WebSocket**은 **하나의 TCP 연결**을 통해 **전이중(Full-Duplex) 통신 채널**을 제공하는 프로토콜이다.
HTTP 프로토콜 위에서 작동하며, **실시간 양방향 통신**을 위해 설계되었다.

### 🔹 주요 특징

* 실시간 양방향 통신 (Full Duplex)
* HTTP/HTTPS 기반으로 동작 (ws://, wss://)
* 초기 Handshake 이후 지속 연결 유지
* 메시지 단위 전송 (UTF-8 인코딩)
* 서버와 클라이언트가 이벤트 기반 통신

---

## 5. WebSocket 동작 과정

### ① **핸드쉐이킹 (Opening Handshake)**

**요청 예시 (Client → Server)**

```http
GET /chat HTTP/1.1   연결 수립
Host: localhost:8080  웹 서버 주소
Upgrade: websocket   프로토콜 전환을 위한 헤더, 헤더가 없으면 cross-protocol attack 간주함.
Connection: Upgrade  요청 완료 후 네트워크 접속 유지 여부 (해당 헤더가 없거나 다른 값일 경우 중지)
Sec-WebSocket-Key: x3JJHMbDL1EzLkh9GBhXDw==   클라이언트와 서버 간 인증
Sec-WebSocket-Protocol: chat, superchat 
 클라이언트가 요청하는 프로토콜들로, 하나 이상의 웹 소켓 프로토콜들을 지정 
Sec-WebSocket-Version: 13   버전
Origin: http://localhost:8001  클라이언트 주소 (없으면 거부 될 수 있음 (CORS정책))

```

**응답 예시 (Server → Client)**

```http
HTTP/1.1 101 Switching Protocols   웹 소켓 연결
Upgrade: websocket 
Connection: Upgrade 
Sec-WebSocket-Accept: HSmrc0sMlYUkAGmm5OPpG2HaGWk= 
 Sec-WebSocket-Key 값을 unique id 값을 더해 SHA-1로 해싱한 값
Sec-WebSocket-Protocol: chat

```

> 👉 `Sec-WebSocket-Accept`는 `Sec-WebSocket-Key` + 고정 문자열을 SHA-1로 해싱 후 Base64 인코딩한 값으로 인증 역할을 수행한다.

---

### ② **데이터 전송 (Data Transfer)**

* 프로토콜이 **HTTP → WS**로 전환됨
* 포트는 HTTP와 동일하게 사용 (`ws:80`, `wss:443`)
* 데이터는 **Message 단위**로 주고받으며 여러 **Frame**으로 구성
* UTF-8 인코딩 사용
* `send()` / `onmessage()` 이벤트로 송수신 처리

---

### ③ **연결 종료 (Close Handshake)**

* 어느 한쪽이 `Close Frame` 전송 시 종료
* 상대가 응답 `Close Frame`을 보내면 연결 종료
* `close()` 메서드로 종료 수행

---

## 6. Socket vs WebSocket 비교

| 항목      | **WebSocket** | **TCP Socket** | **UDP Socket** |
| ------- | ------------- | -------------- | -------------- |
| 프로토콜 계층 | 애플리케이션 계층     | 전송 계층          | 전송 계층          |
| 연결 방식   | 지속적인 양방향 통신   | 연결 지향          | 비연결형           |
| 신뢰성     | 중간            | 높음             | 낮음             |
| 순서 보장   | 보장            | 보장             | 보장 안됨          |
| 속도      | 빠름            | 중간             | 매우 빠름          |
| 대표 사례   | 실시간 채팅, 게임    | HTTP, 이메일      | 실시간 스트리밍, 게임   |

---

## 7. WebSocket 예제 (JavaScript & Node.js)

### 📱 Client (JavaScript)

```javascript
// WebSocket 연결 생성
const socket = new WebSocket("ws://localhost:8080");

// 연결 성공 시
socket.addEventListener("open", (event) => {
    console.log("WebSocket 연결이 열렸습니다.");
    socket.send("Hello Server!");
});

// 서버로부터 메시지 수신
socket.addEventListener("message", (event) => {
    console.log("서버로부터 받은 메시지:", event.data);
});

// 연결 종료 시
socket.addEventListener("close", (event) => {
    console.log("WebSocket 연결이 닫혔습니다.");
});

// 에러 발생 시
socket.addEventListener("error", (event) => {
    console.error("WebSocket 에러:", event);
});
```

---

### 💻 Server (Node.js)

```javascript
const WebSocket = require('ws');

// WebSocket 서버 생성
const wss = new WebSocket.Server({ port: 8080 });

wss.on('connection', (ws) => {
    console.log('클라이언트가 연결되었습니다.');

    // 메시지 수신 시
    ws.on('message', (message) => {
        console.log('클라이언트로부터 받은 메시지:', message);
        ws.send('Hello Client!');
    });

    // 연결 종료 시
    ws.on('close', () => {
        console.log('클라이언트 연결이 닫혔습니다.');
    });

    // 에러 발생 시
    ws.on('error', (err) => {
        console.error('WebSocket 에러:', err);
    });
});
```

---

