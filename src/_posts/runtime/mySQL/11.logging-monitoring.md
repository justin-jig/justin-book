---
title: "MySQL 로깅 및 모니터링 관리 (Logging & Monitoring Management)"
date: 2025-10-26
---

**version: 8.0.x**

---

#### 요약

- MySQL의 안정적인 운영을 위해서는 **로그 수집과 성능 모니터링 체계**가 필수적이다.  
- 본 문서는 에러 로그, 일반 쿼리 로그, 슬로우 쿼리 로그, Performance Schema 등을 활용하여  
  MySQL의 **이상 징후 탐지, 성능 진단, 장애 대응** 절차를 설명한다.  

> MySQL 로깅과 모니터링은 단순 기록이 아니라 **운영 품질 관리의 핵심 지표**이다.
> “로그는 장애의 히스토리, 모니터링은 장애의 예방”이라는 원칙 아래
> error.log → slow.log → performance schema의 3단계 구조로 체계를 구축하면,
> 서비스 중단 없는 안정적인 DB 운영이 가능하다.

**핵심 포인트**
1. MySQL 로그 유형 및 활성화 방법  
2. 에러 로그(`error.log`) 점검  
3. 일반 쿼리 로그(`general_log`) 활성화  
4. 슬로우 쿼리 로그(`slow_query_log`) 튜닝  
5. Performance Schema / sys 스키마를 통한 성능 분석  

---

##### 참고자료  
- [공식 문서: MySQL Server Logs](https://dev.mysql.com/doc/refman/8.0/en/server-logs.html)  
- 내부 문서:
  - `02-practice-and-debug/05-performance-tips.md` — 성능 튜닝 연계  
  - `03-tools-and-management/05-security-hardening.md` — 보안 감사 로그  

---

#### 1. 로그 유형 요약

| 로그 종류 | 파일 예시 | 기능 | 기본값 |
|------------|------------|------|--------|
| 에러 로그 (Error Log) | `/var/log/mysql/error.log` | 서버 오류 및 비정상 종료 기록 | 활성 |
| 일반 로그 (General Log) | `/var/lib/mysql/mysql.log` | 모든 쿼리 기록 | 비활성 |
| 슬로우 쿼리 로그 (Slow Query Log) | `/var/lib/mysql/slow.log` | 느린 쿼리 분석 | 비활성 |
| 바이너리 로그 (Binary Log) | `/var/lib/mysql/mysql-bin.000001` | 복제 / 증분 백업 | 비활성 |
| 감사 로그 (Audit Log) | 커뮤니티 플러그인 | 접속 및 보안 이벤트 | 선택 |

---

#### 2. 로그 활성화 방법

`/etc/mysql/mysql.conf.d/mysqld.cnf` 설정 파일 수정:

```ini
[mysqld]
general_log = 1
general_log_file = /var/lib/mysql/mysql.log

slow_query_log = 1
slow_query_log_file = /var/lib/mysql/slow.log
long_query_time = 1

log_error = /var/log/mysql/error.log
```

적용 후 재시작:

```bash
sudo systemctl restart mysql
```

---

#### 3. 에러 로그 점검

```bash
sudo tail -n 50 /var/log/mysql/error.log
```

예시 출력:

```
2025-10-26T04:03:12.702830Z 0 [ERROR] [MY-010274] [Server] Can't start server: Bind on TCP/IP port: Address already in use
2025-10-26T04:03:12.702874Z 0 [ERROR] [MY-010119] [Server] Aborting
```

> ⚠️ 포트 충돌(3306)이나 설정 오류 시 가장 먼저 확인해야 할 로그다.
> 에러 로그는 **장애 대응의 1차 진단 도구**로 활용된다.

---

#### 4. 일반 쿼리 로그 (General Log)

모든 SQL 명령을 기록한다.

```sql
set global general_log = 1;
set global general_log_file = '/var/lib/mysql/general.log';
```

확인:

```sql
show variables like 'general_log%';
```

> 💡 개발 환경에서만 활성화 권장 (운영 환경에서는 디스크 과다 사용 위험).

---

#### 5. 슬로우 쿼리 로그 (Slow Query Log)

```sql
set global slow_query_log = 1;
set global slow_query_log_file = '/var/lib/mysql/slow.log';
set global long_query_time = 2;  -- 2초 초과 시 로그 기록
```

로그 출력 예시:

```
# Time: 2025-10-26T04:07:44.021538Z
# Query_time: 3.248  Rows_examined: 100000
select * from tb where sales > 100;
```

> ⚙️ `Rows_examined` 값이 높다면 인덱스 미활용 가능성이 크다.

---

#### 6. 슬로우 쿼리 분석 (mysqldumpslow)

```bash
mysqldumpslow -s t /var/lib/mysql/slow.log | head
```

| 옵션      | 설명           |
| ------- | ------------ |
| `-s t`  | 실행 시간 순 정렬   |
| `-s c`  | 호출 횟수 순 정렬   |
| `-t 10` | 상위 10개 쿼리 출력 |

> 💡 슬로우 쿼리는 튜닝의 우선순위를 결정하는 핵심 지표다.

---

#### 7. Performance Schema 활성화

MySQL 8.0 이상에서는 기본 활성화되어 있으며, 쿼리 단위 성능 측정 가능:

```sql
select * from performance_schema.events_statements_summary_by_digest
order by avg_timer_wait desc
limit 10;
```

| 컬럼               | 설명       |
| ---------------- | -------- |
| `DIGEST_TEXT`    | SQL 패턴   |
| `COUNT_STAR`     | 실행 횟수    |
| `AVG_TIMER_WAIT` | 평균 실행 시간 |

> ⚙️ Performance Schema는 고정된 샘플링 기반으로, 실제 쿼리 병목을 파악하는 데 유용하다.

---

#### 8. sys 스키마 (System Schema)

```sql
use sys;
select * from sys.user_summary limit 5;
```

| 테이블                                    | 설명            |
| -------------------------------------- | ------------- |
| `sys.statements_with_full_table_scans` | 전체 스캔 쿼리 목록   |
| `sys.schema_table_statistics`          | 테이블 단위 접근 통계  |
| `sys.user_summary`                     | 사용자별 쿼리 통계 요약 |

> 💡 Performance Schema의 데이터를 사람이 읽기 쉬운 형태로 가공해주는 시스템 뷰이다.

---

#### 9. 모니터링 대시보드 연동 (옵션)

| 도구                   | 설명              | 연동 방식                   |
| -------------------- | --------------- | ----------------------- |
| **Grafana**          | 대시보드 시각화        | Prometheus Exporter로 수집 |
| **Percona PMM**      | 전문 DB 모니터링 툴    | Performance Schema 기반   |
| **Zabbix / Netdata** | 서버 및 쿼리 상태 모니터링 | Plugin 기반 수집            |

Prometheus Exporter 예시:

```bash
docker run -d -p 9104:9104 \
  -e DATA_SOURCE_NAME="root:password@(host:3306)/" \
  prom/mysqld-exporter
```

---

#### 10. 로그 관리 및 보존 정책

| 항목    | 권장 설정                                |
| ----- | ------------------------------------ |
| 보존 기간 | 30일                                  |
| 로테이션  | `logrotate` 또는 cron 자동화              |
| 로그 백업 | `/var/log/mysql/archive/YYYY-MM-DD/` |
| 보안    | root 전용 권한(600)                      |

> ⚙️ 오래된 로그는 압축(`gzip`) 후 별도 보관하여
> 장애 이력 추적 및 감사 로그 용도로 활용한다.

---

#### 11. 로깅·모니터링 절차 (Mermaid)

```mermaid
flowchart LR
  A[MySQL 실행] --> B[로그 수집 (Error, Slow, General)]
  B --> C[Performance Schema 기록]
  C --> D[sys 스키마 요약 뷰]
  D --> E[Grafana / PMM 대시보드 시각화]
  E --> F[운영자 모니터링 및 튜닝]
```

---

#### 12. 주기 점검 명령 세트

```bash
sudo systemctl status mysql
mysql -e "show global status like 'Threads_running';"
mysql -e "show variables like 'slow_query_log';"
sudo tail -n 50 /var/log/mysql/error.log
```

> ✅ 이 4개의 명령어로 대부분의 장애 탐지가 가능하다.

---
