---
title: "Prisma ORM — 현대적 Node.js 데이터베이스 통합 전략"
date: 2025-10-24
---

#### 요약
> Prisma는 타입 안정성과 개발 생산성을 동시에 제공하는 **차세대 Node.js ORM(Object-Relational Mapping)** 이다.  
> 데이터 모델 정의, 마이그레이션, 타입 생성, 쿼리 최적화를 통합 지원하여 기존 Sequelize보다 안정적이고 직관적이다.

- Prisma = **스키마 기반 ORM + 타입 세이프 쿼리 엔진**
- `schema.prisma` 파일을 통해 모델·관계·DB 연결 설정
- 자동 타입 생성 및 IntelliSense 지원
- PostgreSQL, MySQL, SQLite, MongoDB 등 멀티 DB 지원

> **요약:**
> Prisma는 “ORM의 단순화”를 넘어,
> **Node.js 데이터 계층의 표준화된 접근 방식**을 제시한다.


##### 참고자료
- [Prisma 공식 문서](https://www.prisma.io/docs)
- [Prisma Schema Reference](https://www.prisma.io/docs/reference/api-reference/prisma-schema-reference)

---

#### 1. Prisma란?

Prisma는 Node.js 환경에서 DB 모델을 코드로 선언하고,  
타입 세이프(Type-safe)한 쿼리를 실행할 수 있게 하는 ORM이다.  

기존 Sequelize가 런타임 기반 모델 정의를 사용하는 반면,  
Prisma는 **컴파일 타임에 데이터 모델을 검증**한다.

| 항목 | Sequelize | Prisma |
|------|------------|--------|
| 모델 정의 | 코드(JS) 기반 | 스키마 파일(`schema.prisma`) |
| 타입 지원 | 부분적 (TS 호환) | 완전 (자동 생성 타입) |
| 마이그레이션 | CLI 명령 별도 관리 | 통합 CLI |
| 쿼리 | 문자열 기반 | 객체 기반 + 자동 완성 |
| 퍼포먼스 | 중간 | 우수 (Rust 엔진 기반) |

---

#### 2. 설치 및 초기화

##### 1) 패키지 설치
```bash
$ npm install prisma --save-dev
$ npm install @prisma/client
```

##### 2) Prisma 초기화

```bash
$ npx prisma init
```

✅ 실행 결과: `.env` 와 `prisma/schema.prisma` 파일 생성됨

```bash
project/
 ├── prisma/
 │    └── schema.prisma
 ├── src/
 │    └── index.ts
 └── .env
```

##### .env 예시

```bash
DATABASE_URL="mysql://user:password@localhost:3306/mydb"
```

---

#### 3. Prisma 스키마 구조

`schema.prisma`는 **데이터 모델, DB 연결, 생성 전략**을 모두 정의한다.

```prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  createdAt DateTime @default(now())
  posts     Post[]
}

model Post {
  id        Int      @id @default(autoincrement())
  title     String
  content   String?
  author    User?    @relation(fields: [authorId], references: [id])
  authorId  Int?
}
```

> **요약:**
>
> * `generator` : Prisma Client 생성 설정
> * `datasource` : 데이터베이스 연결 정보
> * `model` : 테이블 및 관계 정의

---

#### 4. 마이그레이션 및 Client 생성

##### 마이그레이션 생성

```bash
$ npx prisma migrate dev --name init
```

##### Prisma Client 생성

```bash
$ npx prisma generate
```

> Prisma Client는 TypeScript 타입이 자동 포함된 DB 클라이언트 코드이다.
> `node_modules/@prisma/client` 경로에 생성된다.

---

#### 5. Prisma Client 사용 예시

##### 1) 기본 CRUD

```ts
import { PrismaClient } from '@prisma/client';
const prisma = new PrismaClient();

async function main() {
  // Create
  const user = await prisma.user.create({
    data: { name: 'Ingeun', email: 'test@example.com' },
  });

  // Read
  const users = await prisma.user.findMany();

  // Update
  await prisma.user.update({
    where: { id: user.id },
    data: { email: 'new@example.com' },
  });

  // Delete
  await prisma.user.delete({ where: { id: user.id } });
}
main().finally(() => prisma.$disconnect());
```

---

#### 6. 관계 쿼리 (Join / Relation)

##### 예시: 사용자와 게시글 1:N 관계

```ts
const userWithPosts = await prisma.user.findUnique({
  where: { id: 1 },
  include: { posts: true },
});
```

##### 관계 생성

```ts
await prisma.post.create({
  data: {
    title: 'Prisma Guide',
    author: { connect: { id: 1 } },
  },
});
```

> Prisma의 관계 정의는 SQL JOIN을 자동 처리하며,
> 데이터 모델에서 명시된 관계를 기반으로 안전하게 쿼리한다.

---

#### 7. 트랜잭션 관리

Prisma는 다중 쿼리를 하나의 트랜잭션으로 묶을 수 있다.

```ts
await prisma.$transaction([
  prisma.user.create({ data: { name: 'Alice' } }),
  prisma.post.create({ data: { title: 'Welcome', authorId: 1 } }),
]);
```

> `prisma.$transaction()`은 DB 일관성을 유지하며,
> 모든 작업이 성공해야 커밋되고 실패 시 전체 롤백된다.

---

#### 8. 확장 기능 (Middleware & Extensions)

##### 1) Prisma Middleware

```ts
prisma.$use(async (params, next) => {
  const before = Date.now();
  const result = await next(params);
  console.log(`Query ${params.model}.${params.action} took ${Date.now() - before}ms`);
  return result;
});
```

##### 2) Prisma Extensions

```ts
const extended = prisma.$extends({
  model: {
    user: {
      findActive() {
        return this.findMany({ where: { active: true } });
      },
    },
  },
});
```

> Middleware는 쿼리 전후 로직을 삽입할 수 있고,
> Extensions는 모델별 사용자 정의 함수 추가를 지원한다.

---

#### 9. Prisma Studio

Prisma는 GUI 형태의 DB 관리 툴 **Prisma Studio**를 내장한다.

```bash
$ npx prisma studio
```

브라우저(`http://localhost:5555`)에서 데이터 CRUD를 시각적으로 확인할 수 있다.

---

#### 10. Prisma와 다른 ORM 비교

| 항목      | Sequelize | Prisma | TypeORM  |
| ------- | --------- | ------ | -------- |
| 정의 방식   | 코드 기반     | 스키마 기반 | 데코레이터 기반 |
| 타입 세이프티 | 낮음        | 매우 높음  | 중간       |
| 마이그레이션  | 별도        | 통합 CLI | 통합       |
| 쿼리 작성   | SQL 유사    | 객체형    | SQL 유사   |
| 퍼포먼스    | 중간        | 우수     | 중간       |

---

#### 11. Prisma + Express/Fastify 통합 예시

##### Express

```ts
import express from 'express';
import { PrismaClient } from '@prisma/client';
const prisma = new PrismaClient();
const app = express();

app.get('/users', async (req, res) => {
  const users = await prisma.user.findMany();
  res.json(users);
});

app.listen(3000);
```

##### Fastify

```ts
import Fastify from 'fastify';
import { PrismaClient } from '@prisma/client';
const prisma = new PrismaClient();
const app = Fastify();

app.get('/users', async () => await prisma.user.findMany());
app.listen({ port: 3000 });
```

---

#### 12. 결론

Prisma는 Node.js 생태계에서 **가장 현대적인 ORM**으로 평가된다.
정적 스키마 기반 설계, 타입 세이프 쿼리, 강력한 개발자 도구(Studio, CLI)를 통해
DB 작업의 안정성과 생산성을 모두 개선한다.
