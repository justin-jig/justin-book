---
title: "타입 선언 파일 작성 및 관리 (Declaration Files & Augmentation)"
date: 2025-10-27
---

#### 요약
- `.d.ts` 파일(Declaration File)은 TypeScript에서 **타입 정보만 정의하는 전용 파일**이다.  
- 라이브러리, 전역 객체, 외부 모듈의 타입을 보강하거나 새로운 타입을 정의할 때 사용된다.  
- 본 문서는 `.d.ts` 파일의 작성 규칙, 전역 확장(`declare global`), 모듈 보강(`declare module`),  
  그리고 실무에서 자주 사용되는 패턴을 포함한다.  

**핵심 요약**
1. `.d.ts` 파일은 코드 실행이 아닌 **타입만 포함**한다.  
2. `declare module`은 외부 라이브러리 보강에 사용된다.  
3. `declare global`은 전역 스코프 확장에 사용된다.  
4. `typeRoots` / `include` 설정으로 타입 파일의 인식 범위를 조정할 수 있다.  
5. DefinitelyTyped(`@types/*`) 패키지는 외부 선언의 표준 저장소다.  

##### 참고자료
- [TypeScript Handbook – Declaration Files](https://www.typescriptlang.org/docs/handbook/declaration-files/by-example.html)
- [Defining Global Types](https://www.typescriptlang.org/docs/handbook/declaration-files/templates/global-modifying-module-d-ts.html)
- [DefinitelyTyped Repository](https://github.com/DefinitelyTyped/DefinitelyTyped)

| 항목                      | 요약          |
| ----------------------- | ----------- |
| **declare module**      | 외부 라이브러리 보강 |
| **declare global**      | 전역 확장       |
| **typeRoots**           | 타입 탐색 경로    |
| **@types/**             | 외부 선언 패키지   |
| **emitDeclarationOnly** | 선언 파일만 출력   |
| **declaration merging** | 타입 병합 기능    |

> 선언 파일은 TypeScript 생태계의 “타입 계약서(Contract)”이다.
> 런타임에는 존재하지 않지만, 컴파일 타임에 **코드와 개발자 간의 신뢰**를 보장한다.
> 즉, `.d.ts`는 **타입 시스템의 문서이자 언어의 인터페이스**다.

---

#### 1. 선언 파일(Declaration File)이란

> `.d.ts` 파일은 JavaScript 코드의 **타입 인터페이스를 정의**하기 위한 TypeScript 문서이다.

- 실행 코드는 포함되지 않는다. (`console.log`, `function` 구현 등 불가)
- 타입, 인터페이스, 네임스페이스, 모듈만 선언 가능하다.
- 런타임 시점에는 제거되고, 오직 컴파일 단계에서만 사용된다.

```ts
// types/math.d.ts
declare module "math-lib" {
  export function add(a: number, b: number): number;
  export const version: string;
}
```

> 💡 TypeScript는 `.d.ts` 파일을 통해 JS 라이브러리의 타입을 추론할 수 있다.

---

#### 2. 기본 규칙

| 규칙         | 설명                           | 예시                          |
| ---------- | ---------------------------- | --------------------------- |
| 파일 확장자     | `.d.ts`                      | `index.d.ts`, `global.d.ts` |
| 실행 코드 금지   | `declare` 문만 허용              | ❌ `console.log()`           |
| 타입 전용 내보내기 | `export` 문법 사용               | ✅ `export interface ...`    |
| 타입 인식 경로   | `typeRoots` / `include` 로 지정 | `tsconfig.json` 에 설정        |

---

#### 3. 전역 타입 선언 (`declare global`)

> 애플리케이션 전역에 영향을 주는 타입은 `declare global` 블록 안에서 선언한다.

```ts
// types/global.d.ts
export {};

declare global {
  interface Window {
    APP_VERSION: string;
  }

  namespace NodeJS {
    interface ProcessEnv {
      NODE_ENV: "development" | "production";
      PORT?: string;
    }
  }
}
```

| 항목               | 설명                           |
| ---------------- | ---------------------------- |
| `declare global` | 전역 스코프 확장                    |
| `export {}`      | 모듈로 인식시키기 위한 선언              |
| `namespace`      | NodeJS, Express 등의 전역 타입 그룹화 |

> ⚙️ 전역 확장은 **한 곳에서만 선언**해야 하며, 중복 시 컴파일 충돌 발생 가능.

---

#### 4. 모듈 보강 (`declare module`)

> 외부 라이브러리의 타입을 수정하거나 확장할 때 사용한다.

```ts
// types/axios.d.ts
import "axios";

declare module "axios" {
  export interface AxiosRequestConfig {
    retry?: number;
    cache?: boolean;
  }
}
```

| 특징               | 설명               |
| ---------------- | ---------------- |
| `declare module` | 기존 모듈의 타입 보강     |
| 중복 허용            | 동일 이름 모듈 병합 가능   |
| import 필요        | 원본 모듈을 먼저 가져와야 함 |

> 💡 실무에서는 `Express`, `Axios`, `React` 등 타입 확장이 가장 빈번하다.

---

#### 5. 외부 모듈 정의 (`declare module "모듈명"`)

> npm 패키지에 타입 정의가 존재하지 않을 경우 직접 정의할 수 있다.

```ts
// types/custom-lib.d.ts
declare module "custom-lib" {
  export function initialize(config: object): void;
  export const VERSION: string;
}
```

```ts
import { initialize } from "custom-lib";
initialize({ debug: true });
```

| 항목        | 설명               |
| --------- | ---------------- |
| 미지원 라이브러리 | @types 패키지 없음    |
| 임시 타입 정의  | 라이브러리 추가 전 사용 가능 |
| 점진적 개선    | 실제 코드에 맞춰 점진적 수정 |

> ⚙️ 오픈소스 라이브러리 사용 시 `@types/*` 패키지가 없을 경우 필수적인 패턴.

---

#### 6. 네임스페이스 선언 (`declare namespace`)

> 라이브러리가 전역 변수 형태로 로드될 때 사용하는 구조이다.

```ts
// types/legacy.d.ts
declare namespace LegacyApp {
  function start(): void;
  const version: string;
}
```

```ts
LegacyApp.start();
```

| 특징       | 설명                        |
| -------- | ------------------------- |
| 전역 객체 선언 | `window.LegacyApp` 형태로 존재 |
| 모듈 아님    | import 없이 접근 가능           |
| 과거 스타일   | ES Module 이전의 구조에서 주로 사용  |

> ⚠️ 새로운 코드에서는 모듈(`export`) 기반 선언을 권장한다.

---

#### 7. 타입 인식 경로 설정 (tsconfig)

```jsonc
// tsconfig.json
{
  "compilerOptions": {
    "typeRoots": ["./types", "./node_modules/@types"],
    "skipLibCheck": true
  },
  "include": ["src", "types"]
}
```

| 항목             | 설명                |
| -------------- | ----------------- |
| `typeRoots`    | 타입 탐색 경로 지정       |
| `include`      | 프로젝트 빌드에 포함할 경로   |
| `skipLibCheck` | 외부 라이브러리 타입 검사 생략 |

> ⚙️ **`typeRoots` 미설정 시** TypeScript는 `node_modules/@types`를 기본 경로로 인식한다.

---

#### 8. `@types/*` 패키지 (DefinitelyTyped)

> TypeScript 커뮤니티에서 유지하는 **외부 선언 파일 저장소**

```bash
npm install --save-dev @types/express @types/node
```

| 특징     | 설명                         |
| ------ | -------------------------- |
| 전역 저장소 | DefinitelyTyped GitHub에 저장 |
| 자동 인식  | 설치 시 자동 포함                 |
| 버전 관리  | 라이브러리 버전별 타입 대응            |
| PR 가능  | 직접 타입 보강 후 커밋 가능           |

> 💡 TypeScript 생태계의 신뢰성은 대부분 **@types 패키지 품질**에 달려 있다.

---

#### 9. 실무 예시 — Express 요청 객체 확장

```ts
// types/express.d.ts
import "express";

declare module "express-serve-static-core" {
  interface Request {
    user?: {
      id: number;
      role: string;
    };
  }
}
```

```ts
// middleware/auth.ts
app.use((req, _res, next) => {
  req.user = { id: 1, role: "admin" };
  next();
});
```

> ⚙️ 미들웨어에서 주입되는 속성(Request.user 등)을 타입 시스템에 반영할 수 있다.

---

#### 10. 선언 파일 배포 (라이브러리용)

> 외부 패키지로 배포 시 `.d.ts` 파일을 함께 포함해야 한다.

```jsonc
// package.json
{
  "main": "dist/index.js",
  "types": "dist/index.d.ts"
}
```

**tsconfig.build.json**

```jsonc
{
  "compilerOptions": {
    "declaration": true,
    "emitDeclarationOnly": true,
    "declarationDir": "dist"
  },
  "include": ["src"]
}
```

| 항목                    | 설명                |
| --------------------- | ----------------- |
| `declaration`         | 선언 파일 생성          |
| `emitDeclarationOnly` | JS 파일 출력 생략       |
| `types`               | npm 배포 시 참조 경로 지정 |

> 💡 라이브러리 배포 시 `.d.ts` 파일이 없다면
> 사용자 프로젝트에서는 `any`로 추론되어 타입 안정성이 무너진다.

---

#### 11. 선언 병합(Declaration Merging)

> 동일한 이름의 인터페이스 또는 네임스페이스가 자동 병합되는 기능

```ts
interface User {
  id: number;
}

interface User {
  name: string;
}

// 병합 결과
// { id: number; name: string; }
```

| 특징     | 설명             |
| ------ | -------------- |
| 인터페이스  | 자동 병합됨         |
| 네임스페이스 | 동일 이름일 경우 통합   |
| 주의     | 중복 시 모호한 충돌 가능 |

> ⚙️ “의도된 확장”에서는 유용하지만,
> 여러 파일에서 동일 이름을 사용할 경우 혼선이 생길 수 있다.

---

#### 12. 실무 체크리스트 ✅

* [x] `types/` 디렉토리를 루트에 생성
* [x] `global.d.ts`에는 **환경 관련 전역 변수**만 포함
* [x] 외부 라이브러리 확장은 `declare module` 사용
* [x] 타입 배포 시 `declaration: true` 활성화
* [x] 중복 타입 정의 방지 (`typeRoots` / `include` 명확히 지정)
* [x] `import type`으로 순환 의존성 차단

---
