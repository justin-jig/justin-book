---
title: "베이스 이미지 거버넌스 (2) – 자동 점검 및 리빌드 전략"
date: 2025-10-23
---

#### 요약  
베이스 이미지 관리의 핵심은 **자동 점검(Automated Audit)** 과 **리빌드(Rebuild) 전략**이다.  
CI 파이프라인을 통해 주기적으로 이미지 취약점 스캔, 의존성 점검, 서명 검증을 수행하고  
필요 시 자동으로 리빌드하도록 구성하면 관리 효율성을 극대화할 수 있다.  


* 자동 점검과 리빌드는 베이스 이미지 품질 유지의 핵심이다.
* Trivy/Cosign/SBOM 비교를 통해 안정성과 신뢰성을 확보한다.
* CI 스케줄 기반 관리로 인적 개입 없이 보안 대응이 가능하다.

**핵심 정리**
- Trivy/Grype 등으로 정기적 스캔 자동화  
- GitLab/GitHub Actions를 통한 스케줄 기반 리빌드  
- Cosign 서명 검증으로 무결성 보장  
- SBOM 비교를 통해 변경 이력 감시  

##### 참고자료
- [Trivy Scheduled Scan Example](https://github.com/aquasecurity/trivy-action)
- [Sigstore Cosign Verify](https://docs.sigstore.dev/cosign/verify/)
- [Docker Build Automation](https://docs.docker.com/build/ci/)

---

#### 1. 주기적 점검 워크플로우
```yaml
name: Base Image Audit
on:
  schedule:
    - cron: "0 3 * * 1"  # 매주 월요일 새벽 3시

jobs:
  scan:
    runs-on: ubuntu-latest
    steps:
      - name: Scan base image
        run: trivy image --exit-code 1 harbor.local/base/python:1.2.3
```

> 스케줄 기반으로 정기 보안 점검을 자동화한다.

---

#### 2. 리빌드 자동화

```yaml
- name: Auto Rebuild on CVE
  if: failure()
  run: |
    docker build -t harbor.local/base/python:1.2.4 .
    docker push harbor.local/base/python:1.2.4
```

> 취약점 탐지 시 자동으로 새 버전을 빌드 및 푸시한다.

---

#### 3. 서명 검증 자동화

```bash
cosign verify harbor.local/base/python:1.2.4 --key cosign.pub
```

> 리빌드 후 서명 검증을 수행해 위변조를 방지한다.

---

#### 4. SBOM 비교

```bash
syft harbor.local/base/python:1.2.3 -o json > sbom_old.json
syft harbor.local/base/python:1.2.4 -o json > sbom_new.json
diff sbom_old.json sbom_new.json
```

> 패키지 수준의 변경을 추적해 불필요한 리빌드를 방지한다.

---

#### 5. 관리 대시보드 구성

* **Harbor Webhook** 으로 이미지 변경 이벤트 감지
* **Grafana + Loki** 로 빌드 로그 시각화
* **Prometheus Exporter** 로 이미지 상태 메트릭 수집

---
