---
title: "Dockerfile 고급 예시와 멀티스테이지 빌드 (2)"
date: 2025-10-23
---

#### 요약  
멀티스테이지 빌드는 빌드 환경과 실행 환경을 분리하여  
**이미지 크기를 최소화**하고 **보안을 강화**하는 Dockerfile 설계 기법이다.  

* 멀티스테이지 빌드는 빌드 효율과 보안을 동시에 확보하는 기술이다.
* 불필요한 빌드 레이어를 제거해 경량화된 실행 이미지를 만든다.
* CI/CD 파이프라인에서 기본적으로 사용되는 필수 구조이다.

**핵심 정리**
- `AS` 키워드를 통해 여러 단계(Stage)를 정의한다.  
- 빌드 결과물만 실행 이미지에 포함시킨다.  
- 캐시 효율과 빌드 재현성이 높다.  

##### 참고자료
- [Docker Docs – Multi-stage builds](https://docs.docker.com/build/building/multi-stage/)
- [Dockerfile Best Practices – Official Guide](https://docs.docker.com/develop/develop-images/multistage-build/)

---

#### 1. 멀티스테이지 빌드 예시

```dockerfile
# 1단계: Build Stage
FROM node:20 AS builder
WORKDIR /app
COPY . .
RUN npm install && npm run build

# 2단계: Production Stage
FROM nginx:alpine
COPY --from=builder /app/dist /usr/share/nginx/html
```

> 첫 번째 스테이지에서 애플리케이션을 빌드하고,
> 두 번째 스테이지에서는 빌드 결과물만 복사한다.

---

#### 2. 장점 요약

| 항목        | 설명             |
| :-------- | :------------- |
| 이미지 크기 감소 | 빌드 도구 및 의존성 제외 |
| 보안 강화     | 불필요한 바이너리 제거   |
| 유지보수 용이   | 각 스테이지 역할 분리   |

---

#### 3. 빌드 타깃 지정

```bash
docker build -t webapp:prod --target builder .
docker build -t webapp:release .
```

> `--target` 옵션을 사용하면 특정 스테이지만 빌드 가능하다.

---

#### 4. 캐시 최적화

* 공통 의존성(`package.json`, `requirements.txt`)은 상단에 배치
* 변경이 잦은 코드(`COPY . .`)는 하단에 배치
* `--cache-from` 옵션으로 이전 빌드 캐시 재활용

---


