---
title: "Docker 빌드 최적화 전략 (Build Optimization)"
date: 2025-10-23
---

#### 요약  
Docker 빌드는 레이어 캐시를 활용하므로, 효율적인 순서와 구조가 빌드 속도와 이미지 크기에 직접적인 영향을 준다.  
최적화된 Dockerfile 작성은 배포 속도를 향상시키고 CI/CD 효율을 높인다.  

* Dockerfile 최적화는 CI/CD 속도 향상의 핵심이다.
* 캐시, .dockerignore, BuildKit을 적극 활용하면 빌드 효율이 극대화된다.
* 용량을 줄이면서 보안과 유지보수성도 향상된다.

**핵심 정리**
- **레이어 재사용**으로 불필요한 빌드 최소화  
- **.dockerignore**를 통한 불필요한 파일 제외  
- **BuildKit** 활성화로 보안·성능 개선  
- **Slim/Base Image** 사용으로 용량 감소  

##### 참고자료
- [Docker Build Performance Tuning](https://docs.docker.com/build/performance/)
- [BuildKit – Advanced Build Engine](https://docs.docker.com/build/buildkit/)
- [Best Practices for Image Size Reduction](https://docs.docker.com/develop/develop-images/dockerfile_best-practices/)

---

#### 1. 캐시 활용

Docker는 각 명령(`RUN`, `COPY`, `ADD`)을 레이어 단위로 캐싱한다.  
변경된 지점 이후만 재빌드되므로, **변경 빈도 순서대로 작성**하는 것이 중요하다.

```dockerfile
# 비효율적
COPY . .
RUN npm install

# 효율적
COPY package*.json ./
RUN npm install
COPY . .
```

---

#### 2. 빌드 환경 정리

| 방법                 | 설명                                |
| :----------------- | :-------------------------------- |
| `.dockerignore`    | 불필요한 파일 제외 (.git, node_modules 등) |
| `--no-cache`       | 캐시 무시하고 강제 전체 빌드                  |
| `--pull`           | 최신 베이스 이미지로 갱신                    |
| `--progress=plain` | 빌드 로그 자세히 보기                      |

---

#### 3. BuildKit 활용

BuildKit은 Docker의 고급 빌드 엔진으로, 속도와 보안이 강화된 빌드 환경을 제공한다.

```bash
export DOCKER_BUILDKIT=1
docker build -t myapp:latest .
```

> BuildKit은 멀티스테이지 빌드, 시크릿 관리(`--secret`), 병렬 빌드 등을 지원한다.

---

#### 4. 이미지 크기 감소

| 전략         | 예시                            |
| :--------- | :---------------------------- |
| 슬림 베이스 이미지 | `python:3.11-slim`, `alpine`  |
| 불필요한 캐시 제거 | `rm -rf /var/lib/apt/lists/*` |
| 빌드 결과물만 포함 | 멀티스테이지 빌드 사용                  |
| 런타임 전용 계정  | `USER appuser` 지정             |

---
