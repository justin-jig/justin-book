---
title: "Docker 데이터 백업 및 복구 전략 (Backup and Restore)"
date: 2025-10-23
---

#### 요약  
Docker 환경에서 중요한 데이터(예: 데이터베이스, 로그, 설정)는  
컨테이너 삭제나 재배포 시에도 유지되어야 한다.  
이를 위해 **볼륨 스냅샷, tar 아카이브, 외부 백업 도구** 등을 활용할 수 있다.  


* `tar` 기반 백업은 간단하고 이식성이 높다.
* NFS, rsync, S3 등 외부 스토리지 연계로 안전한 백업 가능.
* 정기적 자동화(cron)로 백업 주기를 운영에 맞게 조정한다.
* 복구 시 데이터 경로와 권한 설정을 반드시 확인한다.

**핵심 정리**
- `docker run --volumes-from` 으로 백업 컨테이너 생성 가능  
- `tar` 명령으로 볼륨 전체를 압축 백업 가능  
- 외부 스토리지(NFS, S3, rsync 등)를 통한 원격 백업이 안정적이다.  

##### 참고자료
- [Docker Docs – Backup, restore, or migrate data volumes](https://docs.docker.com/storage/volumes/#backup-restore-or-migrate-data-volumes)
- [Rsync + Docker tutorial](https://docs.docker.com/samples/)
- [AWS S3 CLI Reference](https://aws.amazon.com/cli/)

---

#### 1. 볼륨 백업 예시

```bash
docker run --rm \
  --volumes-from db \
  -v $(pwd):/backup \
  ubuntu tar cvf /backup/db_backup.tar /var/lib/postgresql/data
````

> 실행 중인 `db` 컨테이너의 데이터를 `/backup/db_backup.tar` 파일로 백업한다.

---

#### 2. 볼륨 복원 예시

```bash
docker run --rm \
  --volumes-from db \
  -v $(pwd):/backup \
  ubuntu bash -c "cd /var/lib/postgresql/data && tar xvf /backup/db_backup.tar --strip 1"
```

> 동일한 볼륨 경로로 압축을 풀면 데이터가 복구된다.

---

#### 3. 외부 스토리지 백업 (NFS 예시)

```bash
docker volume create \
  --driver local \
  --opt type=nfs \
  --opt o=addr=192.168.0.50,rw \
  --opt device=:/nfs/backup \
  backup_nfs
```

```bash
docker run --rm \
  -v mydata:/data \
  -v backup_nfs:/nfs_backup \
  ubuntu tar cvf /nfs_backup/mydata.tar /data
```

> 로컬 볼륨 데이터를 NFS 스토리지로 직접 백업할 수 있다.

---

#### 4. 자동 백업 스케줄 (cron 예시)

```bash
0 2 * * * docker run --rm \
  --volumes-from db \
  -v /opt/backup:/backup \
  ubuntu tar cvf /backup/db_$(date +\%F).tar /var/lib/postgresql/data
```

> 매일 새벽 2시에 DB 데이터를 자동 백업한다.

---

#### 5. 복원 절차 요약

1. 기존 컨테이너 중지

   ```bash
   docker stop db
   ```
2. 새로운 볼륨에 복구

   ```bash
   docker volume create db_restore
   docker run --rm -v db_restore:/data -v $(pwd):/backup ubuntu tar xvf /backup/db_backup.tar -C /data
   ```
3. 컨테이너 재시작

   ```bash
   docker run -d --name db --mount source=db_restore,target=/var/lib/postgresql/data postgres:15
   ```

---
