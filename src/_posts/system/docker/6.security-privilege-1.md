---
title: "권한 최소화 전략 (1) – USER와 Cap Drop"
date: 2025-10-23
---

#### 요약  
Docker 컨테이너는 기본적으로 root 권한으로 실행되지만,  
보안 사고를 방지하기 위해 **최소 권한 원칙(Least Privilege Principle)** 을 적용해야 한다.  
`USER` 지시어와 `--cap-drop` 옵션을 활용하면 불필요한 권한을 줄이고,  
컨테이너 탈출이나 시스템 침해를 예방할 수 있다.  

* root 대신 `USER` 지시어로 일반 사용자 계정을 반드시 설정한다.
* `--cap-drop=ALL` 정책을 기본값으로 두고 필요한 권한만 추가한다.
* 보안은 제거의 기술이며, 불필요한 권한은 항상 잠재적 위협이다.


**핵심 정리**
- 컨테이너 기본 실행 계정은 root이며, 반드시 일반 사용자로 변경해야 한다.  
- `USER` 지시어로 컨테이너 내부 실행 계정을 지정한다.  
- `--cap-drop` 옵션으로 리눅스 커널 기능(Capabilities)을 제한한다.  
- 최소 권한 설정은 DevSecOps의 핵심 보안 원칙이다.  

##### 참고자료
- [Docker Docs – Security best practices](https://docs.docker.com/develop/dev-best-practices/#use-a-non-root-user)
- [Linux Capabilities Overview](https://man7.org/linux/man-pages/man7/capabilities.7.html)
- [CIS Docker Benchmark v1.6+](https://www.cisecurity.org/benchmark/docker)

---

#### 1. USER 지시어 사용

```dockerfile
FROM python:3.11-slim
RUN useradd -m appuser
USER appuser
WORKDIR /app
COPY . .
CMD ["python", "main.py"]
```

> root 대신 `appuser`로 실행하면 컨테이너 탈출 위험이 크게 줄어든다.

---

#### 2. Capabilities 제한

리눅스 커널에는 다양한 기능(capabilities)이 있으며,
Docker는 이 중 일부를 기본적으로 컨테이너에 부여한다.

```bash
docker run -d --cap-drop=ALL --cap-add=NET_BIND_SERVICE nginx
```

> 모든 권한을 제거하고 필요한 네트워크 바인딩 권한만 추가한다.

| 옵션                                      | 설명                 |
| :-------------------------------------- | :----------------- |
| `--cap-drop=ALL`                        | 모든 Capabilities 제거 |
| `--cap-add=<NAME>`                      | 특정 Capabilities 추가 |
| `--security-opt=no-new-privileges:true` | 권한 상승 방지           |

---

#### 3. 보안 검증

```bash
docker inspect <컨테이너ID> | grep CapAdd
```

> CapAdd, CapDrop 설정을 통해 컨테이너 권한을 실시간 검증할 수 있다.

---
