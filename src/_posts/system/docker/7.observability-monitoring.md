---
title: "헬스체크와 상태 모니터링 (Health Check and Status)"
date: 2025-10-23
---

#### 요약  
컨테이너 내부 애플리케이션의 상태를 주기적으로 점검하기 위해  
Docker는 **HEALTHCHECK** 지시어를 지원한다.  
이 기능은 컨테이너가 "정상(healthy)" 또는 "비정상(unhealthy)" 상태인지를 표시하며,  
오케스트레이터(Kubernetes, Swarm 등)에서 자동 복구 트리거로 활용된다.  

* HEALTHCHECK는 컨테이너 애플리케이션의 가용성을 감시한다.
* Compose나 Swarm에서 자동 복구 트리거로 활용된다.
* 정기적 헬스체크는 운영 안정성을 보장한다.
  

**핵심 정리**
- HEALTHCHECK는 컨테이너의 동작 상태를 주기적으로 검사한다.  
- `healthy` / `unhealthy` 상태가 자동으로 표시된다.  
- `docker ps` 와 `docker inspect` 로 상태를 확인할 수 있다.  

##### 참고자료
- [Docker Docs – HEALTHCHECK instruction](https://docs.docker.com/engine/reference/builder/#healthcheck)
- [Container Health Status API](https://docs.docker.com/engine/api/v1.41/#tag/Container/operation/ContainerInspect)
- [Compose healthcheck reference](https://docs.docker.com/compose/compose-file/05-services/#healthcheck)

---

#### 1. Dockerfile 내 HEALTHCHECK 설정
```dockerfile
FROM nginx:latest
HEALTHCHECK --interval=30s --timeout=5s --retries=3 \
  CMD curl -f http://localhost/ || exit 1
```

> 컨테이너 내부의 웹 서버가 200 OK를 반환하지 않으면 `unhealthy` 상태가 된다.

---

#### 2. Compose 파일 예시

```yaml
services:
  web:
    image: nginx
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost || exit 1"]
      interval: 30s
      timeout: 5s
      retries: 3
```

> 헬스체크 결과는 `docker compose ps` 에서 확인할 수 있다.

---

#### 3. 상태 확인 명령

```bash
docker ps
docker inspect --format='{{json .State.Health}}' <container_id>
```

출력 예시:

```json
"Status": "healthy",
"FailingStreak": 0,
"Log": [
  { "Start": "2025-10-23T12:00", "ExitCode": 0 }
]
```

---

#### 4. 오케스트레이션 연동

* **Swarm**: unhealthy 상태 컨테이너 자동 재배포
* **Kubernetes**: `livenessProbe`, `readinessProbe` 로 동일 개념 사용

---
