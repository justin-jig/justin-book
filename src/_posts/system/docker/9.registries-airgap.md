---
title: "에어갭 환경에서의 이미지 배포 (Air-Gap Deployment)"
date: 2025-10-23
---

#### 요약  
망 분리(air-gap) 환경에서는 인터넷 접속이 불가능하므로  
이미지를 외부에서 **내보내기(export)** 하고 내부망으로 **가져오기(import)** 하는 절차가 필요하다.  
이 방식은 군·공공·보안기관 환경에서 자주 사용된다.  

* 에어갭 환경에서는 `save/load` 로 이미지 파일을 옮긴다.
* 오프라인 Harbor 서버로 내부망 배포를 자동화할 수 있다.
* 해시 검증 및 인증 절차를 추가하여 보안성을 확보한다.


**핵심 정리**
- `docker save` / `docker load` 명령으로 이미지 파일 단위 이동 가능.  
- TAR 파일 형태로 외부/내부 네트워크 간 안전하게 전달.  
- Harbor, Nexus Registry 등 오프라인 미러 서버 구성 시 효율적.  

##### 참고자료
- [Docker Docs – Save and Load Images](https://docs.docker.com/engine/reference/commandline/save/)
- [Harbor Offline Installer](https://goharbor.io/docs/2.10.0/install-config/installation-prereqs/)
- [Nexus Registry Deployment](https://help.sonatype.com/repomanager3)

---

#### 1. 이미지 내보내기 (Export)
```bash
docker save -o myapp_v1.tar user/myapp:1.0
````

> 이미지 레이어와 메타데이터가 하나의 TAR 파일로 저장된다.

---

#### 2. 파일 이동

* USB / NAS / SFTP 등 보안 채널을 통해 내부망으로 전달
* 파일 무결성을 확인하기 위해 SHA256 해시 검증 수행

```bash
sha256sum myapp_v1.tar
```

---

#### 3. 이미지 가져오기 (Import)

```bash
docker load -i myapp_v1.tar
docker images
```

> 로컬 Docker에 해당 이미지가 등록된다.

---

#### 4. 내부 레지스트리 업로드

```bash
docker tag user/myapp:1.0 harbor.local/myapp:1.0
docker push harbor.local/myapp:1.0
```

> 내부 Harbor 서버로 이미지를 전송한다.

---

#### 5. Harbor 오프라인 설치

Harbor는 오프라인 번들을 지원하므로, 인터넷 없이도 설치 가능하다.

```bash
wget https://github.com/goharbor/harbor/releases/download/v2.11.0/harbor-offline-installer.tgz
tar xzf harbor-offline-installer.tgz
cd harbor && ./install.sh
```
